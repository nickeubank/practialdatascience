<!DOCTYPE html> <meta charset=utf-8  /> <meta name=viewport  content="width=device-width, initial-scale=1.0" /><meta name=generator  content="Docutils 0.17.1: http://docutils.sourceforge.net/" /> <meta name=viewport  content="width=device-width,initial-scale=1"> <meta http-equiv=x-ua-compatible  content="ie=edge"> <meta name="lang:clipboard.copy" content="Copy to clipboard"> <meta name="lang:clipboard.copied" content="Copied to clipboard"> <meta name="lang:search.language" content=en > <meta name="lang:search.pipeline.stopwords" content=True > <meta name="lang:search.pipeline.trimmer" content=True > <meta name="lang:search.result.none" content="No matching documents"> <meta name="lang:search.result.one" content="1 matching document"> <meta name="lang:search.result.other" content="# matching documents"> <meta name="lang:search.tokenizer" content="[\s\-]+"> <link href="https://fonts.gstatic.com/" rel=preconnect  crossorigin> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel=stylesheet > <style> body, input { font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif } code, kbd, pre { font-family: "Roboto Mono", "Courier New", Courier, monospace } </style> <link rel=stylesheet  href="../_static/stylesheets/application.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-palette.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-fixes.css"/> <link rel=stylesheet  href="../_static/fonts/material-icons.css"/> <meta name=theme-color  content="#2196f3"> <script src="../_static/javascripts/modernizr.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-XX133829453-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-XX133829453-1'); </script> <title>Setting Up a Cluster on Azure for Data Science &#8212; Practical Data Science</title> <link rel=stylesheet  type="text/css" href="../_static/pygments.css" /> <link rel=stylesheet  type="text/css" href="../_static/material.css" /> <script data-url_root="../" id=documentation_options  src="../_static/documentation_options.js"></script> <script src="../_static/jquery.js"></script> <script src="../_static/underscore.js"></script> <script src="../_static/doctools.js"></script> <script crossorigin=anonymous  integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script> <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script> <script defer=defer  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <link rel="shortcut icon" href="../_static/mids_logo.svg"/> <link rel=index  title=Index  href="../genindex.html" /> <link rel=search  title=Search  href="../search.html" /> <body dir=ltr data-md-color-primary=blue-grey data-md-color-accent=blue> <svg class=md-svg > <defs data-children-count=0 > <svg xmlns="http://www.w3.org/2000/svg" width=416  height=448  viewBox="0 0 416 448" id=__github ><path fill=currentColor  d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle  data-md-toggle=drawer  type=checkbox  id=__drawer > <input class=md-toggle  data-md-toggle=search  type=checkbox  id=__search > <label class=md-overlay  data-md-component=overlay  for=__drawer ></label> <a href="#999_cloud/cloud_cluster_on_azure" tabindex=1  class=md-skip > Skip to content </a> <header class=md-header  data-md-component=header > <nav class="md-header-nav md-grid"> <div class="md-flex navheader"> <div class="md-flex__cell md-flex__cell--shrink"> <a href="../index.html" title="Practical Data Science" class="md-header-nav__button md-logo"> <img src="../_static/mids_logo.svg" height=26  alt="Practical Data Science logo"> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer ></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title > <span class=md-header-nav__topic >Practical Data Science</span> <span class=md-header-nav__topic > Setting Up a Cluster on Azure for Data Science </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search ></label> <div class=md-search  data-md-component=search  role=dialog > <label class=md-search__overlay  for=__search ></label> <div class=md-search__inner  role=search > <form class=md-search__form  action="../search.html" method=get  name=search > <input type=text  class=md-search__input  name=q  placeholder=""Search"" autocapitalize=off  autocomplete=off  spellcheck=false  data-md-component=query  data-md-state=active > <label class="md-icon md-search__icon" for=__search ></label> <button type=reset  class="md-icon md-search__icon" data-md-component=reset  tabindex=-1 > &#xE5CD; </button> </form> <div class=md-search__output > <div class=md-search__scrollwrap  data-md-scrollfix> <div class=md-search-result  data-md-component=result > <div class=md-search-result__meta > Type to start searching </div> <ol class=md-search-result__list ></ol> </div> </div> </div> </div> </div> </div> <script src="../_static/javascripts/version_dropdown.js"></script> <script> var json_loc = "../"versions.json"", target_loc = "../../", text = "Versions"; $( document ).ready( add_version_dropdown(json_loc, target_loc, text)); </script> </div> </nav> </header> <div class=md-container > <nav class=md-tabs  data-md-component=tabs > <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list > <li class=md-tabs__item ><a href="../index.html" class=md-tabs__link >Home</a> <li class=md-tabs__item ><a href="../class_schedule.html" class=md-tabs__link >Class Schedule</a> <li class=md-tabs__item ><a href="../topic_list.html" class=md-tabs__link >Topic List</a> <li class=md-tabs__item ><a href="https://www.nickeubank.com" class=md-tabs__link >About The Author</a> </ul> </div> </nav> <main class=md-main > <div class="md-main__inner md-grid" data-md-component=container > <div class="md-sidebar md-sidebar--primary" data-md-component=navigation > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--primary" data-md-level=0 > <label class="md-nav__title md-nav__title--site" for=__drawer > <a href="../index.html" title="Practical Data Science" class="md-nav__button md-logo"> <img src="../_static/mids_logo.svg" alt=" logo" width=48  height=48 > </a> <a href="../index.html" title="Practical Data Science">Practical Data Science</a> </label> <ul class=md-nav__list > <li class=md-nav__item > <a href="../class_schedule.html" class=md-nav__link >Class Schedule</a> <li class=md-nav__item > <a href="../autograder_guidelines.html" class=md-nav__link >Autograder Guidelines</a> <li class=md-nav__item > <a href="../not_a_mids_student.html" class=md-nav__link >Not a MIDS Student?</a> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >"Contents"</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#999-cloud-cloud-cluster-on-azure--page-root" class=md-nav__link >Setting Up a Cluster on Azure for Data Science</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Setup" class=md-nav__link >Setup</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Install-relevant-packages." class=md-nav__link >Install relevant packages.</a> <li class=md-nav__item ><a href="#Setup-Resources" class=md-nav__link >Setup Resources</a> </ul> </nav> <li class=md-nav__item ><a href="#Start-your-cluster!" class=md-nav__link >Start your cluster!</a> <li class=md-nav__item ><a href="#Connect-to-Your-Cluster" class=md-nav__link >Connect to Your Cluster</a> <li class=md-nav__item ><a href="#Scaling-Your-Cluster" class=md-nav__link >Scaling Your Cluster</a> <li class=md-nav__item ><a href="#Closing-your-Cluster" class=md-nav__link >Closing your Cluster</a> </ul> </nav> </ul> </nav> </div> </div> </div> <div class=md-content > <article class="md-content__inner md-typeset" role=main > <style> /* CSS for nbsphinx extension */ /* remove conflicting styling from Sphinx themes */ div.nbinput.container div.prompt *, div.nboutput.container div.prompt *, div.nbinput.container div.input_area pre, div.nboutput.container div.output_area pre, div.nbinput.container div.input_area .highlight, div.nboutput.container div.output_area .highlight { border: none; padding: 0; margin: 0; box-shadow: none; } div.nbinput.container > div[class*=highlight], div.nboutput.container > div[class*=highlight] { margin: 0; } div.nbinput.container div.prompt *, div.nboutput.container div.prompt * { background: none; } div.nboutput.container div.output_area .highlight, div.nboutput.container div.output_area pre { background: unset; } div.nboutput.container div.output_area div.highlight { color: unset; /* override Pygments text color */ } /* avoid gaps between output lines */ div.nboutput.container div[class*=highlight] pre { line-height: normal; } /* input/output containers */ div.nbinput.container, div.nboutput.container { display: -webkit-flex; display: flex; align-items: flex-start; margin: 0; width: 100%; } @media (max-width: 540px) { div.nbinput.container, div.nboutput.container { flex-direction: column; } } /* input container */ div.nbinput.container { padding-top: 5px; } /* last container */ div.nblast.container { padding-bottom: 5px; } /* input prompt */ div.nbinput.container div.prompt pre { color: #307FC1; } /* output prompt */ div.nboutput.container div.prompt pre { color: #BF5B3D; } /* all prompts */ div.nbinput.container div.prompt, div.nboutput.container div.prompt { width: 4.5ex; padding-top: 5px; position: relative; user-select: none; } div.nbinput.container div.prompt > div, div.nboutput.container div.prompt > div { position: absolute; right: 0; margin-right: 0.3ex; } @media (max-width: 540px) { div.nbinput.container div.prompt, div.nboutput.container div.prompt { width: unset; text-align: left; padding: 0.4em; } div.nboutput.container div.prompt.empty { padding: 0; } div.nbinput.container div.prompt > div, div.nboutput.container div.prompt > div { position: unset; } } /* disable scrollbars on prompts */ div.nbinput.container div.prompt pre, div.nboutput.container div.prompt pre { overflow: hidden; } /* input/output area */ div.nbinput.container div.input_area, div.nboutput.container div.output_area { -webkit-flex: 1; flex: 1; overflow: auto; } @media (max-width: 540px) { div.nbinput.container div.input_area, div.nboutput.container div.output_area { width: 100%; } } /* input area */ div.nbinput.container div.input_area { border: 1px solid #e0e0e0; border-radius: 2px; /*background: #f5f5f5;*/ } /* override MathJax center alignment in output cells */ div.nboutput.container div[class*=MathJax] { text-align: left !important; } /* override sphinx.ext.imgmath center alignment in output cells */ div.nboutput.container div.math p { text-align: left; } /* standard error */ div.nboutput.container div.output_area.stderr { background: #fdd; } /* ANSI colors */ .ansi-black-fg { color: #3E424D; } .ansi-black-bg { background-color: #3E424D; } .ansi-black-intense-fg { color: #282C36; } .ansi-black-intense-bg { background-color: #282C36; } .ansi-red-fg { color: #E75C58; } .ansi-red-bg { background-color: #E75C58; } .ansi-red-intense-fg { color: #B22B31; } .ansi-red-intense-bg { background-color: #B22B31; } .ansi-green-fg { color: #00A250; } .ansi-green-bg { background-color: #00A250; } .ansi-green-intense-fg { color: #007427; } .ansi-green-intense-bg { background-color: #007427; } .ansi-yellow-fg { color: #DDB62B; } .ansi-yellow-bg { background-color: #DDB62B; } .ansi-yellow-intense-fg { color: #B27D12; } .ansi-yellow-intense-bg { background-color: #B27D12; } .ansi-blue-fg { color: #208FFB; } .ansi-blue-bg { background-color: #208FFB; } .ansi-blue-intense-fg { color: #0065CA; } .ansi-blue-intense-bg { background-color: #0065CA; } .ansi-magenta-fg { color: #D160C4; } .ansi-magenta-bg { background-color: #D160C4; } .ansi-magenta-intense-fg { color: #A03196; } .ansi-magenta-intense-bg { background-color: #A03196; } .ansi-cyan-fg { color: #60C6C8; } .ansi-cyan-bg { background-color: #60C6C8; } .ansi-cyan-intense-fg { color: #258F8F; } .ansi-cyan-intense-bg { background-color: #258F8F; } .ansi-white-fg { color: #C5C1B4; } .ansi-white-bg { background-color: #C5C1B4; } .ansi-white-intense-fg { color: #A1A6B2; } .ansi-white-intense-bg { background-color: #A1A6B2; } .ansi-default-inverse-fg { color: #FFFFFF; } .ansi-default-inverse-bg { background-color: #000000; } .ansi-bold { font-weight: bold; } .ansi-underline { text-decoration: underline; } div.nbinput.container div.input_area div[class*=highlight] > pre, div.nboutput.container div.output_area div[class*=highlight] > pre, div.nboutput.container div.output_area div[class*=highlight].math, div.nboutput.container div.output_area.rendered_html, div.nboutput.container div.output_area > div.output_javascript, div.nboutput.container div.output_area:not(.rendered_html) > img{ padding: 5px; margin: 0; } /* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */ div.nbinput.container div.input_area > div[class^='highlight'], div.nboutput.container div.output_area > div[class^='highlight']{ overflow-y: hidden; } /* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */ .prompt .copybtn { display: none; } /* Some additional styling taken form the Jupyter notebook CSS */ .jp-RenderedHTMLCommon table, div.rendered_html table { border: none; border-collapse: collapse; border-spacing: 0; color: black; font-size: 12px; table-layout: fixed; } .jp-RenderedHTMLCommon thead, div.rendered_html thead { border-bottom: 1px solid black; vertical-align: bottom; } .jp-RenderedHTMLCommon tr, .jp-RenderedHTMLCommon th, .jp-RenderedHTMLCommon td, div.rendered_html tr, div.rendered_html th, div.rendered_html td { text-align: right; vertical-align: middle; padding: 0.5em 0.5em; line-height: normal; white-space: normal; max-width: none; border: none; } .jp-RenderedHTMLCommon th, div.rendered_html th { font-weight: bold; } .jp-RenderedHTMLCommon tbody tr:nth-child(odd), div.rendered_html tbody tr:nth-child(odd) { background: #f5f5f5; } .jp-RenderedHTMLCommon tbody tr:hover, div.rendered_html tbody tr:hover { background: rgba(66, 165, 245, 0.2); } </style> <section id=Setting-Up-a-Cluster-on-Azure-for-Data-Science > <h1 id=999-cloud-cloud-cluster-on-azure--page-root >Setting Up a Cluster on Azure for Data Science<a class=headerlink  href="#999-cloud-cloud-cluster-on-azure--page-root" title="Permalink to this headline">¶</a></h1> <p>As discussed in our <a class="reference internal" href=cloud_vm_on_azure.html ><span class=doc >last lesson</span></a>, getting a single large VM is <em>by far</em> the easiest way to move your work to the cluster, and it’s what I would do 99% of the time. But sometimes no single computer is big enough to do all the compute you want to accomplish. When that happens, we turn to using Virtual Machine Cluster, and in particular we’re gonna figure out how to set one up with <code class="docutils literal notranslate"><span class=pre >dask</span></code>.</p> <p>As this is one of the later reading in a series, I’ll assume you already know about the <a class="reference internal" href=cloud_what_is_it.html ><span class=doc >basics of what the cloud is</span></a> and how <a class="reference internal" href=cloud_storage_on_azure.html ><span class=doc >Azure Storage</span></a> works (and that you have an Azure account already!).</p> <section id=Setup > <h2 id=Setup >Setup<a class=headerlink  href="#Setup" title="Permalink to this headline">¶</a></h2> <p>Setting up a cluster is, unfortunately, a little more complicated than starting up a pre-configured VM. With that in mind, we’re going to move from setting resources up interactively on the Azure website to using the Azure Command Line Tool (CLI). So before we dive in, go <a class="reference external" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli">read this</a> and follow the directions for installing the tool. Once it’s installed, come on back!</p> <section id=Install-relevant-packages. > <h3 id=Install-relevant-packages. >Install relevant packages.<a class=headerlink  href="#Install-relevant-packages." title="Permalink to this headline">¶</a></h3> <p>First, run the following:</p> <div class="highlight-none notranslate"><div class=highlight ><pre><span></span>pip install "dask-cloudprovider[azure]"
pip install "dask-cloudprovider[azure]" --upgrade
pip install adlfs lz4 blosc
pip install dask --upgrade
pip install distributed --upgrade
</pre></div> </div> </section> <section id=Setup-Resources > <h3 id=Setup-Resources >Setup Resources<a class=headerlink  href="#Setup-Resources" title="Permalink to this headline">¶</a></h3> <p>Now we’ll talk through setting up all the resources you need for your cluster using the Azure commandline tool.</p> <ol class="arabic simple"> <li><p>Login to Azure.</p> </ol> <div class="highlight-bash notranslate"><div class=highlight ><pre><span></span>az<span class=w > </span>login
</pre></div> </div> <ol class="arabic simple" start=2 > <li><p>Create a new resource group.</p> </ol> <p>If you have an existing resource group you’re welcome to use it. However, when you create your cluster it’ll create all sorts of ancillary resources (mostly related to networking protocols) so if you put them all in a new resource group, it’s much easier to clean everything up when you’re done by just deleting the resource group.</p> <p>Note that location refers to which of Azure’s data centers you want to connect to. You can see a list of <a class="reference external" href="https://azure.microsoft.com/en-us/global-infrastructure/geographies/">available regions here</a>. If you’re at Duke, it’s probably best to use “eastus”.</p> <div class="highlight-bash notranslate"><div class=highlight ><pre><span></span>az<span class=w > </span>group<span class=w > </span>create<span class=w > </span>--location<span class=w > </span>&lt;location&gt;<span class=w > </span><span class=se >\</span>
<span class=w >                </span>--name<span class=w > </span>&lt;resource<span class=w > </span>group<span class=w > </span>name&gt;<span class=w > </span><span class=se >\</span>
<span class=w >                </span>--subscription<span class=w > </span>&lt;subscription&gt;
</pre></div> </div> <ol class="arabic simple" start=3 > <li><p>Create a virtual network.</p> </ol> <p>In order for the computers in your cluster to see one another, they have to be placed in a virtual network. Here’s a basic configuration recommended by the dask team. This will support up to 255 nodes.</p> <div class="highlight-bash notranslate"><div class=highlight ><pre><span></span>az<span class=w > </span>network<span class=w > </span>vnet<span class=w > </span>create<span class=w > </span>-g<span class=w > </span>&lt;resource<span class=w > </span>group<span class=w > </span>name&gt;<span class=w > </span><span class=se >\</span>
<span class=w >                       </span>-n<span class=w > </span>&lt;vnet<span class=w > </span>name&gt;<span class=w > </span><span class=se >\</span>
<span class=w >                       </span>--address-prefix<span class=w > </span><span class=m >10</span>.0.0.0/16<span class=w > </span><span class=se >\</span>
<span class=w >                       </span>--subnet-name<span class=w > </span>&lt;subnet<span class=w > </span>name&gt;<span class=w > </span><span class=se >\</span>
<span class=w >                       </span>--subnet-prefix<span class=w > </span><span class=m >10</span>.0.0.0/24
</pre></div> </div> <ol class="arabic simple" start=4 > <li><p>Create a security rule.</p> </ol> <p>By default, when you create a virtual network it’s locked down for security. So the first thing we have to do is create a security rule that allows you to connect to the virtual network from home. This requires creating a Network Security Group and new rule.</p> <div class="highlight-bash notranslate"><div class=highlight ><pre><span></span>az<span class=w > </span>network<span class=w > </span>nsg<span class=w > </span>create<span class=w > </span>-g<span class=w > </span>&lt;resource<span class=w > </span>group<span class=w > </span>name&gt;<span class=w > </span><span class=se >\</span>
<span class=w >                      </span>--name<span class=w > </span>&lt;security<span class=w > </span>group<span class=w > </span>name&gt;

az<span class=w > </span>network<span class=w > </span>nsg<span class=w > </span>rule<span class=w > </span>create<span class=w > </span>-g<span class=w > </span>&lt;resource<span class=w > </span>group<span class=w > </span>name&gt;<span class=w > </span><span class=se >\</span>
<span class=w >                           </span>--nsg-name<span class=w > </span>&lt;security<span class=w > </span>group<span class=w > </span>name&gt;<span class=w > </span><span class=se >\</span>
<span class=w >                           </span>-n<span class=w > </span>MyNsgRuleWithAsg<span class=w > </span><span class=se >\</span>
<span class=w >                           </span>--priority<span class=w > </span><span class=m >500</span><span class=w > </span><span class=se >\</span>
<span class=w >                           </span>--source-address-prefixes<span class=w > </span>Internet<span class=w > </span><span class=se >\</span>
<span class=w >                           </span>--destination-port-ranges<span class=w > </span><span class=m >8786</span><span class=w > </span><span class=m >8787</span><span class=w > </span><span class=se >\</span>
<span class=w >                           </span>--destination-address-prefixes<span class=w > </span><span class=s1 >'*'</span><span class=w > </span><span class=se >\</span>
<span class=w >                           </span>--access<span class=w > </span>Allow<span class=w > </span>--protocol<span class=w > </span>Tcp<span class=w > </span><span class=se >\</span>
<span class=w >                           </span>--description<span class=w > </span><span class=s2 >"Allow Internet to Dask on ports 8786,8787."</span>
</pre></div> </div> </section> </section> <section id="Start-your-cluster!"> <h2 id="Start-your-cluster!">Start your cluster!<a class=headerlink  href="#Start-your-cluster!" title="Permalink to this headline">¶</a></h2> <p>Now that we have all resources set up to support the cluster, all that’s left is to get it started! The following code will take a few minutes, but you should get a lot of regular notifications about progress.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[1]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=o >%</span><span class=k >load_ext</span> lab_black
<span class=kn >from</span> <span class=nn >dask_cloudprovider.azure</span> <span class=kn >import</span> <span class=n >AzureVMCluster</span>
</pre></div> </div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[2]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=c1 ># Start cluster</span>
<span class=n >cluster</span> <span class=o >=</span> <span class=n >AzureVMCluster</span><span class=p >(</span>
    <span class=n >resource_group</span><span class=o >=</span><span class=s2 >"nce8rg"</span><span class=p >,</span>
    <span class=n >vnet</span><span class=o >=</span><span class=s2 >"nce8vn"</span><span class=p >,</span>
    <span class=n >security_group</span><span class=o >=</span><span class=s2 >"nce8nsg"</span><span class=p >,</span>
    <span class=n >n_workers</span><span class=o >=</span><span class=mi >1</span><span class=p >,</span>
    <span class=n >location</span><span class=o >=</span><span class=s2 >"eastus"</span><span class=p >,</span>
<span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Creating scheduler instance
Assigned public IP
Network interface ready
Creating VM
Created VM dask-8eec3fa0-scheduler
Waiting for scheduler to run
Scheduler is running
Creating worker instance
</pre></div></div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area stderr docutils container"> <div class=highlight ><pre>
/Users/Nick/miniconda3/lib/python3.7/contextlib.py:119: UserWarning: Creating your cluster is taking a surprisingly long time. This is likely due to pending resources. Hang tight!
  next(self.gen)
</pre></div></div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Network interface ready
Creating VM
Created VM dask-8eec3fa0-worker-29ac2137
</pre></div></div> </div> </section> <section id=Connect-to-Your-Cluster > <h2 id=Connect-to-Your-Cluster >Connect to Your Cluster<a class=headerlink  href="#Connect-to-Your-Cluster" title="Permalink to this headline">¶</a></h2> <p>Finally, we need to connect our personal computer to the cluster so we can start assigning it work to do! Thankfully with dask this is <em>super</em> easy. (Not familiar with dask yet? <a class="reference external" href=distributed_computing.ipynb >Check out this intro here!</a>).</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[3]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >from</span> <span class=nn >dask.distributed</span> <span class=kn >import</span> <span class=n >Client</span>

<span class=n >client</span> <span class=o >=</span> <span class=n >Client</span><span class=p >(</span><span class=n >cluster</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area stderr docutils container"> <div class=highlight ><pre>
/Users/Nick/miniconda3/lib/python3.7/site-packages/distributed/client.py:1129: VersionMismatchWarning: Mismatched versions found

+---------+--------+-----------+---------+
| Package | client | scheduler | workers |
+---------+--------+-----------+---------+
| lz4     | 3.1.0  | 3.1.1     | None    |
+---------+--------+-----------+---------+
  warnings.warn(version_module.VersionMismatchWarning(msg[0]["warning"]))
</pre></div></div> </div> <p>And that’s it! Now you have a running <code class="docutils literal notranslate"><span class=pre >dask</span></code> cluster you’re connected to from home! Now you just use it like any other dask session. Want to see your dask Dashboard to see how your cluster is running? Just run <code class="docutils literal notranslate"><span class=pre >cluster.dashboard_link</span></code> and click the link!</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[4]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >cluster</span><span class=o >.</span><span class=n >dashboard_link</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[4]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
'http://52.151.219.69:8787/status'
</pre></div></div> </div> </section> <section id=Scaling-Your-Cluster > <h2 id=Scaling-Your-Cluster >Scaling Your Cluster<a class=headerlink  href="#Scaling-Your-Cluster" title="Permalink to this headline">¶</a></h2> <p>The great thing about Azure VM Clusters is that you can create a cluster that starts with, say, two computers (nodes), but then scale it up to 100 nodes when you’ve debugged your code and are ready to run a bit of computationally intensive code. Then when you’re done, those nodes will automatically shut down after they’ve been idle for a set period of time, and you’ll be back to the two nodes. And that means you only have to pay for the 100 nodes <em>when you are using them!</em>. Pretty amazing, honestly.</p> <p>To scale your cluster, use the <code class="docutils literal notranslate"><span class=pre >.scale()</span></code> method:</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[5]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span>cluster.scale<span class=o >?</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
<span class=ansi-red-fg >Signature:</span> cluster<span class=ansi-blue-fg >.</span>scale<span class=ansi-blue-fg >(</span>n<span class=ansi-blue-fg >=</span><span class=ansi-cyan-fg >0</span><span class=ansi-blue-fg >,</span> memory<span class=ansi-blue-fg >=</span><span class=ansi-green-fg >None</span><span class=ansi-blue-fg >,</span> cores<span class=ansi-blue-fg >=</span><span class=ansi-green-fg >None</span><span class=ansi-blue-fg >)</span>
<span class=ansi-red-fg >Docstring:</span>
Scale cluster to n workers

Parameters
----------
n: int
    Target number of workers

Examples
--------
&gt;&gt;&gt; cluster.scale(10)  # scale cluster to ten workers
<span class=ansi-red-fg >File:</span>      ~/miniconda3/lib/python3.7/site-packages/distributed/deploy/spec.py
<span class=ansi-red-fg >Type:</span>      method

</pre></div></div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[6]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=c1 ># Move from 1 worker to 2</span>
<span class=n >cluster</span><span class=o >.</span><span class=n >scale</span><span class=p >(</span><span class=mi >2</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Creating worker instance
</pre></div></div> </div> <p>Note that scaling is pretty fast, but not instant, so it may take a little time before you see your new works on your dask Dashboard.</p> </section> <section id=Closing-your-Cluster > <h2 id=Closing-your-Cluster >Closing your Cluster<a class=headerlink  href="#Closing-your-Cluster" title="Permalink to this headline">¶</a></h2> <p>It’s <strong>super</strong> important that when you’re done you close your cluster! Otherwise Azure will just keep billing you for it running. (Reminder: its good practice to set up billing alerts! See the last section <a class="reference internal" href=cloud_vm_on_azure.html ><span class=doc >here</span></a> for details.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[ ]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >cluster</span><span class=o >.</span><span class=n >close</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Network interface ready
Creating VM
Created VM dask-8eec3fa0-worker-99699f0c
Terminated VM dask-8eec3fa0-worker-29ac2137
Removed disks for VM dask-8eec3fa0-worker-29ac2137
Deleted network interface
Terminated VM dask-8eec3fa0-worker-99699f0c
Removed disks for VM dask-8eec3fa0-worker-99699f0c
Deleted network interface
</pre></div></div> </div> </section> </section> </article> </div> </div> </main> </div> <footer class=md-footer > <div class=md-footer-nav > <nav class="md-footer-nav__inner md-grid"> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright > <div class=md-footer-copyright__highlight > &#169; Copyright 2021, Nick Eubank. </div> Created using <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.5.0. and <a href="https://github.com/bashtage/sphinx-material/">Material for Sphinx</a> </div> </div> </div> </footer> <script src="../_static/javascripts/application.js"></script> <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>