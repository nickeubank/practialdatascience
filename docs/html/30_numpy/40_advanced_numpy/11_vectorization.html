<!DOCTYPE html> <meta charset=utf-8  /> <meta name=viewport  content="width=device-width, initial-scale=1.0" /><meta name=generator  content="Docutils 0.17.1: http://docutils.sourceforge.net/" /> <meta name=viewport  content="width=device-width,initial-scale=1"> <meta http-equiv=x-ua-compatible  content="ie=edge"> <meta name="lang:clipboard.copy" content="Copy to clipboard"> <meta name="lang:clipboard.copied" content="Copied to clipboard"> <meta name="lang:search.language" content=en > <meta name="lang:search.pipeline.stopwords" content=True > <meta name="lang:search.pipeline.trimmer" content=True > <meta name="lang:search.result.none" content="No matching documents"> <meta name="lang:search.result.one" content="1 matching document"> <meta name="lang:search.result.other" content="# matching documents"> <meta name="lang:search.tokenizer" content="[\s\-]+"> <link href="https://fonts.gstatic.com/" rel=preconnect  crossorigin> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel=stylesheet > <style> body, input { font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif } code, kbd, pre { font-family: "Roboto Mono", "Courier New", Courier, monospace } </style> <link rel=stylesheet  href="../../_static/stylesheets/application.css"/> <link rel=stylesheet  href="../../_static/stylesheets/application-palette.css"/> <link rel=stylesheet  href="../../_static/stylesheets/application-fixes.css"/> <link rel=stylesheet  href="../../_static/fonts/material-icons.css"/> <meta name=theme-color  content="#2196f3"> <script src="../../_static/javascripts/modernizr.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-XX133829453-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-XX133829453-1'); </script> <title>Vectorization in Python &#8212; Practical Data Science</title> <link rel=stylesheet  type="text/css" href="../../_static/pygments.css" /> <link rel=stylesheet  type="text/css" href="../../_static/material.css" /> <script data-url_root="../../" id=documentation_options  src="../../_static/documentation_options.js"></script> <script src="../../_static/jquery.js"></script> <script src="../../_static/underscore.js"></script> <script src="../../_static/doctools.js"></script> <script crossorigin=anonymous  integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script> <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script> <script defer=defer  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <link rel="shortcut icon" href="../../_static/mids_logo.svg"/> <link rel=index  title=Index  href="../../genindex.html" /> <link rel=search  title=Search  href="../../search.html" /> <body dir=ltr data-md-color-primary=blue-grey data-md-color-accent=blue> <svg class=md-svg > <defs data-children-count=0 > <svg xmlns="http://www.w3.org/2000/svg" width=416  height=448  viewBox="0 0 416 448" id=__github ><path fill=currentColor  d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle  data-md-toggle=drawer  type=checkbox  id=__drawer > <input class=md-toggle  data-md-toggle=search  type=checkbox  id=__search > <label class=md-overlay  data-md-component=overlay  for=__drawer ></label> <a href="#30_numpy/40_advanced_numpy/11_vectorization" tabindex=1  class=md-skip > Skip to content </a> <header class=md-header  data-md-component=header > <nav class="md-header-nav md-grid"> <div class="md-flex navheader"> <div class="md-flex__cell md-flex__cell--shrink"> <a href="../../index.html" title="Practical Data Science" class="md-header-nav__button md-logo"> <img src="../../_static/mids_logo.svg" height=26  alt="Practical Data Science logo"> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer ></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title > <span class=md-header-nav__topic >Practical Data Science</span> <span class=md-header-nav__topic > Vectorization in Python </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search ></label> <div class=md-search  data-md-component=search  role=dialog > <label class=md-search__overlay  for=__search ></label> <div class=md-search__inner  role=search > <form class=md-search__form  action="../../search.html" method=get  name=search > <input type=text  class=md-search__input  name=q  placeholder=Search  autocapitalize=off  autocomplete=off  spellcheck=false  data-md-component=query  data-md-state=active > <label class="md-icon md-search__icon" for=__search ></label> <button type=reset  class="md-icon md-search__icon" data-md-component=reset  tabindex=-1 > &#xE5CD; </button> </form> <div class=md-search__output > <div class=md-search__scrollwrap  data-md-scrollfix> <div class=md-search-result  data-md-component=result > <div class=md-search-result__meta > Type to start searching </div> <ol class=md-search-result__list ></ol> </div> </div> </div> </div> </div> </div> <script src="../../_static/javascripts/version_dropdown.js"></script> <script> var json_loc = "../../"versions.json"", target_loc = "../../../", text = "Versions"; $( document ).ready( add_version_dropdown(json_loc, target_loc, text)); </script> </div> </nav> </header> <div class=md-container > <nav class=md-tabs  data-md-component=tabs > <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list > <li class=md-tabs__item ><a href="../../index.html" class=md-tabs__link >Home</a> <li class=md-tabs__item ><a href="../../class_schedule.html" class=md-tabs__link >Class Schedule</a> <li class=md-tabs__item ><a href="../../topic_list.html" class=md-tabs__link >Topic List</a> <li class=md-tabs__item ><a href="https://www.nickeubank.com" class=md-tabs__link >About The Author</a> </ul> </div> </nav> <main class=md-main > <div class="md-main__inner md-grid" data-md-component=container > <div class="md-sidebar md-sidebar--primary" data-md-component=navigation > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--primary" data-md-level=0 > <label class="md-nav__title md-nav__title--site" for=__drawer > <a href="../../index.html" title="Practical Data Science" class="md-nav__button md-logo"> <img src="../../_static/mids_logo.svg" alt=" logo" width=48  height=48 > </a> <a href="../../index.html" title="Practical Data Science">Practical Data Science</a> </label> <ul class=md-nav__list > <li class=md-nav__item > <a href="../../class_schedule.html" class=md-nav__link >Class Schedule</a> <li class=md-nav__item > <a href="../../autograder_guidelines.html" class=md-nav__link >Autograder Guidelines</a> <li class=md-nav__item > <a href="../../not_a_mids_student.html" class=md-nav__link >Not a MIDS Student?</a> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >Contents</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#30-numpy-40-advanced-numpy-11-vectorization--page-root" class=md-nav__link >Vectorization in Python</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Performance-benefits-of-vectorization" class=md-nav__link >Performance benefits of vectorization</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Caution:-optimize-when-needed" class=md-nav__link >Caution: optimize when needed</a> </ul> </nav> <li class=md-nav__item ><a href="#Vectorization-syntax-parallels-much-of-the-math-of-data-science" class=md-nav__link >Vectorization syntax parallels much of the math of data science</a> <li class=md-nav__item ><a href="#Recap" class=md-nav__link >Recap</a> </ul> </nav> </ul> </nav> </div> </div> </div> <div class=md-content > <article class="md-content__inner md-typeset" role=main > <style> /* CSS for nbsphinx extension */ /* remove conflicting styling from Sphinx themes */ div.nbinput.container div.prompt *, div.nboutput.container div.prompt *, div.nbinput.container div.input_area pre, div.nboutput.container div.output_area pre, div.nbinput.container div.input_area .highlight, div.nboutput.container div.output_area .highlight { border: none; padding: 0; margin: 0; box-shadow: none; } div.nbinput.container > div[class*=highlight], div.nboutput.container > div[class*=highlight] { margin: 0; } div.nbinput.container div.prompt *, div.nboutput.container div.prompt * { background: none; } div.nboutput.container div.output_area .highlight, div.nboutput.container div.output_area pre { background: unset; } div.nboutput.container div.output_area div.highlight { color: unset; /* override Pygments text color */ } /* avoid gaps between output lines */ div.nboutput.container div[class*=highlight] pre { line-height: normal; } /* input/output containers */ div.nbinput.container, div.nboutput.container { display: -webkit-flex; display: flex; align-items: flex-start; margin: 0; width: 100%; } @media (max-width: 540px) { div.nbinput.container, div.nboutput.container { flex-direction: column; } } /* input container */ div.nbinput.container { padding-top: 5px; } /* last container */ div.nblast.container { padding-bottom: 5px; } /* input prompt */ div.nbinput.container div.prompt pre { color: #307FC1; } /* output prompt */ div.nboutput.container div.prompt pre { color: #BF5B3D; } /* all prompts */ div.nbinput.container div.prompt, div.nboutput.container div.prompt { width: 4.5ex; padding-top: 5px; position: relative; user-select: none; } div.nbinput.container div.prompt > div, div.nboutput.container div.prompt > div { position: absolute; right: 0; margin-right: 0.3ex; } @media (max-width: 540px) { div.nbinput.container div.prompt, div.nboutput.container div.prompt { width: unset; text-align: left; padding: 0.4em; } div.nboutput.container div.prompt.empty { padding: 0; } div.nbinput.container div.prompt > div, div.nboutput.container div.prompt > div { position: unset; } } /* disable scrollbars on prompts */ div.nbinput.container div.prompt pre, div.nboutput.container div.prompt pre { overflow: hidden; } /* input/output area */ div.nbinput.container div.input_area, div.nboutput.container div.output_area { -webkit-flex: 1; flex: 1; overflow: auto; } @media (max-width: 540px) { div.nbinput.container div.input_area, div.nboutput.container div.output_area { width: 100%; } } /* input area */ div.nbinput.container div.input_area { border: 1px solid #e0e0e0; border-radius: 2px; /*background: #f5f5f5;*/ } /* override MathJax center alignment in output cells */ div.nboutput.container div[class*=MathJax] { text-align: left !important; } /* override sphinx.ext.imgmath center alignment in output cells */ div.nboutput.container div.math p { text-align: left; } /* standard error */ div.nboutput.container div.output_area.stderr { background: #fdd; } /* ANSI colors */ .ansi-black-fg { color: #3E424D; } .ansi-black-bg { background-color: #3E424D; } .ansi-black-intense-fg { color: #282C36; } .ansi-black-intense-bg { background-color: #282C36; } .ansi-red-fg { color: #E75C58; } .ansi-red-bg { background-color: #E75C58; } .ansi-red-intense-fg { color: #B22B31; } .ansi-red-intense-bg { background-color: #B22B31; } .ansi-green-fg { color: #00A250; } .ansi-green-bg { background-color: #00A250; } .ansi-green-intense-fg { color: #007427; } .ansi-green-intense-bg { background-color: #007427; } .ansi-yellow-fg { color: #DDB62B; } .ansi-yellow-bg { background-color: #DDB62B; } .ansi-yellow-intense-fg { color: #B27D12; } .ansi-yellow-intense-bg { background-color: #B27D12; } .ansi-blue-fg { color: #208FFB; } .ansi-blue-bg { background-color: #208FFB; } .ansi-blue-intense-fg { color: #0065CA; } .ansi-blue-intense-bg { background-color: #0065CA; } .ansi-magenta-fg { color: #D160C4; } .ansi-magenta-bg { background-color: #D160C4; } .ansi-magenta-intense-fg { color: #A03196; } .ansi-magenta-intense-bg { background-color: #A03196; } .ansi-cyan-fg { color: #60C6C8; } .ansi-cyan-bg { background-color: #60C6C8; } .ansi-cyan-intense-fg { color: #258F8F; } .ansi-cyan-intense-bg { background-color: #258F8F; } .ansi-white-fg { color: #C5C1B4; } .ansi-white-bg { background-color: #C5C1B4; } .ansi-white-intense-fg { color: #A1A6B2; } .ansi-white-intense-bg { background-color: #A1A6B2; } .ansi-default-inverse-fg { color: #FFFFFF; } .ansi-default-inverse-bg { background-color: #000000; } .ansi-bold { font-weight: bold; } .ansi-underline { text-decoration: underline; } div.nbinput.container div.input_area div[class*=highlight] > pre, div.nboutput.container div.output_area div[class*=highlight] > pre, div.nboutput.container div.output_area div[class*=highlight].math, div.nboutput.container div.output_area.rendered_html, div.nboutput.container div.output_area > div.output_javascript, div.nboutput.container div.output_area:not(.rendered_html) > img{ padding: 5px; margin: 0; } /* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */ div.nbinput.container div.input_area > div[class^='highlight'], div.nboutput.container div.output_area > div[class^='highlight']{ overflow-y: hidden; } /* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */ .prompt .copybtn { display: none; } /* Some additional styling taken form the Jupyter notebook CSS */ .jp-RenderedHTMLCommon table, div.rendered_html table { border: none; border-collapse: collapse; border-spacing: 0; color: black; font-size: 12px; table-layout: fixed; } .jp-RenderedHTMLCommon thead, div.rendered_html thead { border-bottom: 1px solid black; vertical-align: bottom; } .jp-RenderedHTMLCommon tr, .jp-RenderedHTMLCommon th, .jp-RenderedHTMLCommon td, div.rendered_html tr, div.rendered_html th, div.rendered_html td { text-align: right; vertical-align: middle; padding: 0.5em 0.5em; line-height: normal; white-space: normal; max-width: none; border: none; } .jp-RenderedHTMLCommon th, div.rendered_html th { font-weight: bold; } .jp-RenderedHTMLCommon tbody tr:nth-child(odd), div.rendered_html tbody tr:nth-child(odd) { background: #f5f5f5; } .jp-RenderedHTMLCommon tbody tr:hover, div.rendered_html tbody tr:hover { background: rgba(66, 165, 245, 0.2); } </style> <section id=Vectorization-in-Python > <h1 id=30-numpy-40-advanced-numpy-11-vectorization--page-root >Vectorization in Python<a class=headerlink  href="#30-numpy-40-advanced-numpy-11-vectorization--page-root" title="Permalink to this headline">¶</a></h1> <p>Vectorizing code is a technique that will typically enable you to create faster and more readable code. Vectorization is the process of performing computation on a set of values at once instead of explicitly looping through individual elements one at a time. The difference can be readily seen in a simple example. Let’s say we want to add together each element of two arrays, <span class="math notranslate nohighlight">\(a = [a_0, a_1, a_2]\)</span> and <span class="math notranslate nohighlight">\(b = [b_0, b_1, b_2]\)</span> such that we create a new array <span class="math notranslate nohighlight">\(c = [a_0 + b_0, a_1 + b_1, a_2 + b_2]\)</span>. Let’s show how this is done in a non-vectorized way (using loops) and using vectorization.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[2]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >import</span> <span class=nn >numpy</span> <span class=k >as</span> <span class=nn >np</span>

<span class=c1 ># create our data</span>
<span class=n >a</span> <span class=o >=</span> <span class=n >np</span><span class=o >.</span><span class=n >array</span><span class=p >([</span><span class=mi >1</span><span class=p >,</span> <span class=mi >2</span><span class=p >,</span> <span class=mi >3</span><span class=p >])</span>
<span class=n >b</span> <span class=o >=</span> <span class=n >np</span><span class=o >.</span><span class=n >array</span><span class=p >([</span><span class=mi >2</span><span class=p >,</span> <span class=mi >3</span><span class=p >,</span> <span class=mi >4</span><span class=p >])</span>
</pre></div> </div> </div> <p>Let’s first complete this using a non-vectorized approach that uses a for loop…</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[3]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=c1 ># nonvectorized approach</span>
<span class=n >c</span> <span class=o >=</span> <span class=p >[]</span> <span class=c1 ># Start with an empty array that we will populate in the loop</span>
<span class=k >for</span> <span class=n >i</span> <span class=ow >in</span> <span class=nb >range</span><span class=p >(</span><span class=nb >len</span><span class=p >(</span><span class=n >a</span><span class=p >)):</span>
    <span class=n >c</span><span class=o >.</span><span class=n >append</span><span class=p >(</span><span class=n >a</span><span class=p >[</span><span class=n >i</span><span class=p >]</span> <span class=o >+</span> <span class=n >b</span><span class=p >[</span><span class=n >i</span><span class=p >])</span>

<span class=nb >print</span><span class=p >(</span><span class=s1 >'Nonvectorized approach -&gt;'</span><span class=p >,</span> <span class=n >c</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Nonvectorized approach -&gt; [3, 5, 7]
</pre></div></div> </div> <p>Now, let’s try a vectorized approach…</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[4]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=c1 ># vectorized approach</span>
<span class=n >c</span> <span class=o >=</span> <span class=n >a</span> <span class=o >+</span> <span class=n >b</span>

<span class=nb >print</span><span class=p >(</span><span class=s1 >'Vectorized approach -&gt;'</span><span class=p >,</span> <span class=n >c</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Vectorized approach -&gt; [3 5 7]
</pre></div></div> </div> <p>One thing is immediately clear - the notation of the vectorized approach is far clearer than the non-vectorized approach. It says exactly what is happening - an element-wise addition of vectors. This approach is even clearer with 2D matrices since 2D matrices would require nested loops. In data science we are often working with vectors or matrices of data and need to perform element-wise operations on them as we discussed before, so vectorized notation is often preferable for clarity of the code.</p> <section id=Performance-benefits-of-vectorization > <h2 id=Performance-benefits-of-vectorization >Performance benefits of vectorization<a class=headerlink  href="#Performance-benefits-of-vectorization" title="Permalink to this headline">¶</a></h2> <p>Perhaps the largest benefit is not the code clarity, but the performance improvement that vectorization provides: an increase in computational efficiency/speed. Let’s explore this aspect of vectorization through a simple example. Let’s say we have a large array of numbers and we want to double each of them.</p> <p>We can start by using a non-vectorized approach which loops through each element in the array, doubling it along the way. Let’s create a function that does just that:</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[13]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=k >def</span> <span class=nf >double_nonvectorized</span><span class=p >(</span><span class=n >array</span><span class=p >):</span>
    <span class=n >doubled</span> <span class=o >=</span> <span class=n >array</span><span class=o >.</span><span class=n >copy</span><span class=p >()</span>
    <span class=k >for</span> <span class=n >i</span> <span class=ow >in</span> <span class=nb >range</span><span class=p >(</span><span class=nb >len</span><span class=p >(</span><span class=n >array</span><span class=p >)):</span>
        <span class=n >doubled</span><span class=p >[</span><span class=n >i</span><span class=p >]</span> <span class=o >=</span> <span class=n >array</span><span class=p >[</span><span class=n >i</span><span class=p >]</span> <span class=o >*</span> <span class=mi >2</span>
    <span class=k >return</span> <span class=n >doubled</span>
</pre></div> </div> </div> <p>Next, let’s create the equivalent function, but vectorize it:</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[14]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=k >def</span> <span class=nf >double_vectorized</span><span class=p >(</span><span class=n >array</span><span class=p >):</span>
    <span class=k >return</span> <span class=n >array</span> <span class=o >*</span> <span class=mi >2</span>
</pre></div> </div> </div> <p>Again, note how comparatively simple this version is. Now let’s verify they produce the same, correct output:</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[17]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >array</span> <span class=o >=</span> <span class=n >np</span><span class=o >.</span><span class=n >array</span><span class=p >([</span><span class=mi >1</span><span class=p >,</span><span class=mi >2</span><span class=p >,</span><span class=mi >3</span><span class=p >,</span><span class=mi >4</span><span class=p >])</span>
<span class=nb >print</span><span class=p >(</span><span class=s1 >'Nonvectorized = '</span><span class=p >,</span><span class=n >double_nonvectorized</span><span class=p >(</span><span class=n >array</span><span class=p >))</span>
<span class=nb >print</span><span class=p >(</span><span class=s1 >'Vectorized    = '</span><span class=p >,</span><span class=n >double_vectorized</span><span class=p >(</span><span class=n >array</span><span class=p >))</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Nonvectorized =  [2 4 6 8]
Vectorized    =  [2 4 6 8]
</pre></div></div> </div> <p>Now let’s evaluate the speed difference between the two. To do that, we need to time our code. There are many strategies for doing so, but let’s use Python’s built-in timing package <code class="docutils literal notranslate"><span class=pre >time</span></code>. There’s often some variability in how long it takes to run depending on other processes that are going on, so let’s run the code 5 times each and take the average. We’ll get to practice many of the tools we’ve been learning in the course so far.</p> <p>The <code class="docutils literal notranslate"><span class=pre >time</span></code> package has a function <code class="docutils literal notranslate"><span class=pre >time</span></code> that returns the current time in seconds; so taking the difference between <code class="docutils literal notranslate"><span class=pre >time.time()</span></code> between two points in time provides the number of seconds that have elapsed.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[18]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >import</span> <span class=nn >time</span>

<span class=k >def</span> <span class=nf >timer</span><span class=p >(</span><span class=n >function</span><span class=p >,</span><span class=n >argument</span><span class=p >,</span><span class=n >num_runs</span><span class=p >):</span>
    <span class=n >total_time</span> <span class=o >=</span> <span class=mi >0</span>
    <span class=c1 ># Rerun the code num_runs times</span>
    <span class=k >for</span> <span class=n >i</span> <span class=ow >in</span> <span class=nb >range</span><span class=p >(</span><span class=n >num_runs</span><span class=p >):</span>
        <span class=n >t0</span> <span class=o >=</span> <span class=n >time</span><span class=o >.</span><span class=n >time</span><span class=p >()</span> <span class=c1 ># Capture the initial time</span>
        <span class=n >function</span><span class=p >(</span><span class=n >argument</span><span class=p >)</span> <span class=c1 ># Run the function we're timing</span>
        <span class=n >t1</span> <span class=o >=</span> <span class=n >time</span><span class=o >.</span><span class=n >time</span><span class=p >()</span> <span class=c1 ># Capture the final time</span>
        <span class=n >total_time</span> <span class=o >+=</span> <span class=n >t1</span><span class=o >-</span><span class=n >t0</span>
    <span class=k >return</span> <span class=n >total_time</span> <span class=o >/</span> <span class=n >num_runs</span> <span class=c1 ># Return the average across the runs</span>
</pre></div> </div> </div> <p>All that’s left to be done is to create a very large array that we want to double and time how long it takes</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[62]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >big_array</span> <span class=o >=</span> <span class=n >np</span><span class=o >.</span><span class=n >arange</span><span class=p >(</span><span class=mi >1000000</span><span class=p >)</span>
<span class=n >num_runs</span> <span class=o >=</span> <span class=mi >5</span>

<span class=n >time_nonvectorized</span> <span class=o >=</span> <span class=n >timer</span><span class=p >(</span><span class=n >double_nonvectorized</span><span class=p >,</span><span class=n >big_array</span><span class=p >,</span><span class=n >num_runs</span><span class=p >)</span>
<span class=n >time_vectorized</span> <span class=o >=</span> <span class=n >timer</span><span class=p >(</span><span class=n >double_vectorized</span><span class=p >,</span><span class=n >big_array</span><span class=p >,</span><span class=n >num_runs</span><span class=p >)</span>

<span class=nb >print</span><span class=p >(</span><span class=s1 >'Nonvectorized code took '</span><span class=p >,</span><span class=n >time_nonvectorized</span><span class=p >,</span> <span class=s1 >'s'</span><span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=s1 >'Vectorized code took    '</span><span class=p >,</span><span class=n >time_vectorized</span><span class=p >,</span> <span class=s1 >'s'</span><span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=s1 >'Vectorized code was '</span><span class=p >,</span> <span class=n >time_nonvectorized</span><span class=o >/</span><span class=n >time_vectorized</span> <span class=p >,</span><span class=s1 >' times faster'</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Nonvectorized code took  0.26927862167358396 s
Vectorized code took     0.0003796100616455078 s
Vectorized code was  709.3558598166059  times faster
</pre></div></div> </div> <p>That’s more than a <em>700x</em> speedup! For the exact same code!!!! <em>Note: if you rerun this code, your output will likely vary depending on the computer you’re using and the activity on that computer, but you will consistently see a speedup.</em></p> <p>OK, so why does this happen? The answer is twofold.</p> <p>First, in the vectorized function, Python (or rather, the <code class="docutils literal notranslate"><span class=pre >numpy</span></code> code written in C that gets called) is designed to understand that it’s about to do something to every entry of an array, so it remembers where the array is located, and so only has to look up where to find the array once.</p> <p>In addition, arrays are <em>typed</em>, meaning that Python also knows that every entry of the array it’s modifying is an integer. As a result, it doesn’t have to check the type of every entry in the array when the operation is vectorized, it checks once and knows that it’s working with an array of integers.</p> <section id="Caution:-optimize-when-needed"> <h3 id="Caution:-optimize-when-needed">Caution: optimize when needed<a class=headerlink  href="#Caution:-optimize-when-needed" title="Permalink to this headline">¶</a></h3> <p>While starting with efficient coding practices is the best approach, there are times when the solutions we can think of for a problem are effective but inefficient. If you don’t think of the most optimized approach to a problem at the start, that’s okay. If you follow the practices of creating modular code and never duplicating code, you can always refactor your code later and improve its efficiency through optimization. Don’t let the perfect be the enemy of the good. Get a working solution created for your problem or analysis and if it’s sufficiently modular, you can optimize the performance as you identify opportunities to do so without delaying your minimum viable product.</p> </section> </section> <section id=Vectorization-syntax-parallels-much-of-the-math-of-data-science > <h2 id=Vectorization-syntax-parallels-much-of-the-math-of-data-science >Vectorization syntax parallels much of the math of data science<a class=headerlink  href="#Vectorization-syntax-parallels-much-of-the-math-of-data-science" title="Permalink to this headline">¶</a></h2> <p>Often in data science, we use linear algebra to perform matrix operations. Linear regression, principle components analysis, and correlation analyses all involve matrix operations. Many of these matrix operations can be directly expressed through vectorized operations in much the same way that the math would be expressed. For example, we often need to multiply one matrix by another - a common operation for a data scientist. We will explore in the exercises just how much more concise and readable vectorized code can be in such circumstances, and how much of an increase in speed it results in.</p> </section> <section id=Recap > <h2 id=Recap >Recap<a class=headerlink  href="#Recap" title="Permalink to this headline">¶</a></h2> <ul class=simple > <li><p>Vectorization can drastically increase the speed of execution versus looping over arrays</p> <li><p>Vectorization keeps code simpler and more readable so it’s easier to understand and build on later</p> <li><p>Much of the math of data science is similar to vectorized implementations, making it easier to translate into vectorized code</p> <li><p>While performance may be important for your particular problem, prioritize module implementations that can be optimized later over a delayed deliverable</p> </ul> </section> </section> </article> </div> </div> </main> </div> <footer class=md-footer > <div class=md-footer-nav > <nav class="md-footer-nav__inner md-grid"> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright > <div class=md-footer-copyright__highlight > &#169; Copyright 2021, Nick Eubank. </div> Created using <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.5.0. and <a href="https://github.com/bashtage/sphinx-material/">Material for Sphinx</a> </div> </div> </div> </footer> <script src="../../_static/javascripts/application.js"></script> <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>