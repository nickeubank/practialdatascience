<!DOCTYPE html> <meta charset=utf-8  /> <meta name=viewport  content="width=device-width, initial-scale=1.0" /><meta name=generator  content="Docutils 0.17.1: http://docutils.sourceforge.net/" /> <meta name=viewport  content="width=device-width,initial-scale=1"> <meta http-equiv=x-ua-compatible  content="ie=edge"> <meta name="lang:clipboard.copy" content="Copy to clipboard"> <meta name="lang:clipboard.copied" content="Copied to clipboard"> <meta name="lang:search.language" content=en > <meta name="lang:search.pipeline.stopwords" content=True > <meta name="lang:search.pipeline.trimmer" content=True > <meta name="lang:search.result.none" content="No matching documents"> <meta name="lang:search.result.one" content="1 matching document"> <meta name="lang:search.result.other" content="# matching documents"> <meta name="lang:search.tokenizer" content="[\s\-]+"> <link href="https://fonts.gstatic.com/" rel=preconnect  crossorigin> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel=stylesheet > <style> body, input { font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif } code, kbd, pre { font-family: "Roboto Mono", "Courier New", Courier, monospace } </style> <link rel=stylesheet  href="../_static/stylesheets/application.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-palette.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-fixes.css"/> <link rel=stylesheet  href="../_static/fonts/material-icons.css"/> <meta name=theme-color  content="#2196f3"> <script src="../_static/javascripts/modernizr.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-XX133829453-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-XX133829453-1'); </script> <title>Merging Data to Understand the Relationship between Drug Legalization and Violent Crime &#8212; Practical Data Science</title> <link rel=stylesheet  type="text/css" href="../_static/pygments.css" /> <link rel=stylesheet  type="text/css" href="../_static/material.css" /> <script data-url_root="../" id=documentation_options  src="../_static/documentation_options.js"></script> <script src="../_static/jquery.js"></script> <script src="../_static/underscore.js"></script> <script src="../_static/doctools.js"></script> <script crossorigin=anonymous  integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script> <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script> <script defer=defer  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <link rel="shortcut icon" href="../_static/mids_logo.svg"/> <link rel=index  title=Index  href="../genindex.html" /> <link rel=search  title=Search  href="../search.html" /> <body dir=ltr data-md-color-primary=blue-grey data-md-color-accent=blue> <svg class=md-svg > <defs data-children-count=0 > <svg xmlns="http://www.w3.org/2000/svg" width=416  height=448  viewBox="0 0 416 448" id=__github ><path fill=currentColor  d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle  data-md-toggle=drawer  type=checkbox  id=__drawer > <input class=md-toggle  data-md-toggle=search  type=checkbox  id=__search > <label class=md-overlay  data-md-component=overlay  for=__drawer ></label> <a href="#exercises/Exercise_merging" tabindex=1  class=md-skip > Skip to content </a> <header class=md-header  data-md-component=header > <nav class="md-header-nav md-grid"> <div class="md-flex navheader"> <div class="md-flex__cell md-flex__cell--shrink"> <a href="../index.html" title="Practical Data Science" class="md-header-nav__button md-logo"> <img src="../_static/mids_logo.svg" height=26  alt="Practical Data Science logo"> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer ></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title > <span class=md-header-nav__topic >Practical Data Science</span> <span class=md-header-nav__topic > Merging Data to Understand the Relationship between Drug Legalization and Violent Crime </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search ></label> <div class=md-search  data-md-component=search  role=dialog > <label class=md-search__overlay  for=__search ></label> <div class=md-search__inner  role=search > <form class=md-search__form  action="../search.html" method=get  name=search > <input type=text  class=md-search__input  name=q  placeholder=""Search"" autocapitalize=off  autocomplete=off  spellcheck=false  data-md-component=query  data-md-state=active > <label class="md-icon md-search__icon" for=__search ></label> <button type=reset  class="md-icon md-search__icon" data-md-component=reset  tabindex=-1 > &#xE5CD; </button> </form> <div class=md-search__output > <div class=md-search__scrollwrap  data-md-scrollfix> <div class=md-search-result  data-md-component=result > <div class=md-search-result__meta > Type to start searching </div> <ol class=md-search-result__list ></ol> </div> </div> </div> </div> </div> </div> <script src="../_static/javascripts/version_dropdown.js"></script> <script> var json_loc = "../"versions.json"", target_loc = "../../", text = "Versions"; $( document ).ready( add_version_dropdown(json_loc, target_loc, text)); </script> </div> </nav> </header> <div class=md-container > <nav class=md-tabs  data-md-component=tabs > <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list > <li class=md-tabs__item ><a href="../index.html" class=md-tabs__link >Home</a> <li class=md-tabs__item ><a href="../class_schedule.html" class=md-tabs__link >Class Schedule</a> <li class=md-tabs__item ><a href="../topic_list.html" class=md-tabs__link >Topic List</a> <li class=md-tabs__item ><a href="https://www.nickeubank.com" class=md-tabs__link >About The Author</a> </ul> </div> </nav> <main class=md-main > <div class="md-main__inner md-grid" data-md-component=container > <div class="md-sidebar md-sidebar--primary" data-md-component=navigation > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--primary" data-md-level=0 > <label class="md-nav__title md-nav__title--site" for=__drawer > <a href="../index.html" title="Practical Data Science" class="md-nav__button md-logo"> <img src="../_static/mids_logo.svg" alt=" logo" width=48  height=48 > </a> <a href="../index.html" title="Practical Data Science">Practical Data Science</a> </label> <ul class=md-nav__list > <li class=md-nav__item > <a href="../class_schedule.html" class=md-nav__link >Class Schedule</a> <li class=md-nav__item > <a href="../autograder_guidelines.html" class=md-nav__link >Autograder Guidelines</a> <li class=md-nav__item > <a href="../not_a_mids_student.html" class=md-nav__link >Not a MIDS Student?</a> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >"Contents"</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#exercises-exercise-merging--page-root" class=md-nav__link >Merging Data to Understand the Relationship between Drug Legalization and Violent Crime</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Gradescope-Autograding" class=md-nav__link >Gradescope Autograding</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Submission-Limits" class=md-nav__link >Submission Limits</a> </ul> </nav> <li class=md-nav__item ><a href="#Pre-Legalization-Analysis" class=md-nav__link >Pre-Legalization Analysis</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exercise-1" class=md-nav__link >Exercise 1</a> <li class=md-nav__item ><a href="#Exercise-2" class=md-nav__link >Exercise 2</a> <li class=md-nav__item ><a href="#Exercise-3" class=md-nav__link >Exercise 3</a> <li class=md-nav__item ><a href="#Exercise-4" class=md-nav__link >Exercise 4</a> <li class=md-nav__item ><a href="#Exercise-5" class=md-nav__link >Exercise 5</a> <li class=md-nav__item ><a href="#Exercise-6" class=md-nav__link >Exercise 6</a> </ul> </nav> <li class=md-nav__item ><a href="#Merge-Validation" class=md-nav__link >Merge Validation</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exercise-7" class=md-nav__link >Exercise 7</a> <li class=md-nav__item ><a href="#Exercise-8" class=md-nav__link >Exercise 8</a> </ul> </nav> <li class=md-nav__item ><a href="#Merge-Diagnostics" class=md-nav__link >Merge Diagnostics</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exercise-9" class=md-nav__link >Exercise 9</a> <li class=md-nav__item ><a href="#Exercise-10" class=md-nav__link >Exercise 10</a> <li class=md-nav__item ><a href="#Exercise-11" class=md-nav__link >Exercise 11</a> </ul> </nav> <li class=md-nav__item ><a href="#Comparing-Arrest-Rates" class=md-nav__link >Comparing Arrest Rates</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exercise-12" class=md-nav__link >Exercise 12</a> <li class=md-nav__item ><a href="#Exercise-13" class=md-nav__link >Exercise 13</a> <li class=md-nav__item ><a href="#Exercise-14" class=md-nav__link >Exercise 14</a> </ul> </nav> <li class=md-nav__item ><a href="#Comparing-with-2018-Arrests" class=md-nav__link >Comparing with 2018 Arrests</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exercise-15" class=md-nav__link >Exercise 15</a> <li class=md-nav__item ><a href="#Exercise-16" class=md-nav__link >Exercise 16</a> <li class=md-nav__item ><a href="#Exercise-17" class=md-nav__link >Exercise 17</a> <li class=md-nav__item ><a href="#Exercise-18" class=md-nav__link >Exercise 18</a> <li class=md-nav__item ><a href="#Exercise-19" class=md-nav__link >Exercise 19</a> </ul> </nav> <li class=md-nav__item ><a href="#Difference-in-Difference-Analysis" class=md-nav__link >Difference in Difference Analysis</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exercise-20" class=md-nav__link >Exercise 20</a> <li class=md-nav__item ><a href="#Exercise-21" class=md-nav__link >Exercise 21</a> <li class=md-nav__item ><a href="#Exercise-22" class=md-nav__link >Exercise 22</a> <li class=md-nav__item ><a href="#Exercise-23" class=md-nav__link >Exercise 23</a> </ul> </nav> </ul> </nav> </ul> </nav> </div> </div> </div> <div class=md-content > <article class="md-content__inner md-typeset" role=main > <style> /* CSS for nbsphinx extension */ /* remove conflicting styling from Sphinx themes */ div.nbinput.container div.prompt *, div.nboutput.container div.prompt *, div.nbinput.container div.input_area pre, div.nboutput.container div.output_area pre, div.nbinput.container div.input_area .highlight, div.nboutput.container div.output_area .highlight { border: none; padding: 0; margin: 0; box-shadow: none; } div.nbinput.container > div[class*=highlight], div.nboutput.container > div[class*=highlight] { margin: 0; } div.nbinput.container div.prompt *, div.nboutput.container div.prompt * { background: none; } div.nboutput.container div.output_area .highlight, div.nboutput.container div.output_area pre { background: unset; } div.nboutput.container div.output_area div.highlight { color: unset; /* override Pygments text color */ } /* avoid gaps between output lines */ div.nboutput.container div[class*=highlight] pre { line-height: normal; } /* input/output containers */ div.nbinput.container, div.nboutput.container { display: -webkit-flex; display: flex; align-items: flex-start; margin: 0; width: 100%; } @media (max-width: 540px) { div.nbinput.container, div.nboutput.container { flex-direction: column; } } /* input container */ div.nbinput.container { padding-top: 5px; } /* last container */ div.nblast.container { padding-bottom: 5px; } /* input prompt */ div.nbinput.container div.prompt pre { color: #307FC1; } /* output prompt */ div.nboutput.container div.prompt pre { color: #BF5B3D; } /* all prompts */ div.nbinput.container div.prompt, div.nboutput.container div.prompt { width: 4.5ex; padding-top: 5px; position: relative; user-select: none; } div.nbinput.container div.prompt > div, div.nboutput.container div.prompt > div { position: absolute; right: 0; margin-right: 0.3ex; } @media (max-width: 540px) { div.nbinput.container div.prompt, div.nboutput.container div.prompt { width: unset; text-align: left; padding: 0.4em; } div.nboutput.container div.prompt.empty { padding: 0; } div.nbinput.container div.prompt > div, div.nboutput.container div.prompt > div { position: unset; } } /* disable scrollbars on prompts */ div.nbinput.container div.prompt pre, div.nboutput.container div.prompt pre { overflow: hidden; } /* input/output area */ div.nbinput.container div.input_area, div.nboutput.container div.output_area { -webkit-flex: 1; flex: 1; overflow: auto; } @media (max-width: 540px) { div.nbinput.container div.input_area, div.nboutput.container div.output_area { width: 100%; } } /* input area */ div.nbinput.container div.input_area { border: 1px solid #e0e0e0; border-radius: 2px; /*background: #f5f5f5;*/ } /* override MathJax center alignment in output cells */ div.nboutput.container div[class*=MathJax] { text-align: left !important; } /* override sphinx.ext.imgmath center alignment in output cells */ div.nboutput.container div.math p { text-align: left; } /* standard error */ div.nboutput.container div.output_area.stderr { background: #fdd; } /* ANSI colors */ .ansi-black-fg { color: #3E424D; } .ansi-black-bg { background-color: #3E424D; } .ansi-black-intense-fg { color: #282C36; } .ansi-black-intense-bg { background-color: #282C36; } .ansi-red-fg { color: #E75C58; } .ansi-red-bg { background-color: #E75C58; } .ansi-red-intense-fg { color: #B22B31; } .ansi-red-intense-bg { background-color: #B22B31; } .ansi-green-fg { color: #00A250; } .ansi-green-bg { background-color: #00A250; } .ansi-green-intense-fg { color: #007427; } .ansi-green-intense-bg { background-color: #007427; } .ansi-yellow-fg { color: #DDB62B; } .ansi-yellow-bg { background-color: #DDB62B; } .ansi-yellow-intense-fg { color: #B27D12; } .ansi-yellow-intense-bg { background-color: #B27D12; } .ansi-blue-fg { color: #208FFB; } .ansi-blue-bg { background-color: #208FFB; } .ansi-blue-intense-fg { color: #0065CA; } .ansi-blue-intense-bg { background-color: #0065CA; } .ansi-magenta-fg { color: #D160C4; } .ansi-magenta-bg { background-color: #D160C4; } .ansi-magenta-intense-fg { color: #A03196; } .ansi-magenta-intense-bg { background-color: #A03196; } .ansi-cyan-fg { color: #60C6C8; } .ansi-cyan-bg { background-color: #60C6C8; } .ansi-cyan-intense-fg { color: #258F8F; } .ansi-cyan-intense-bg { background-color: #258F8F; } .ansi-white-fg { color: #C5C1B4; } .ansi-white-bg { background-color: #C5C1B4; } .ansi-white-intense-fg { color: #A1A6B2; } .ansi-white-intense-bg { background-color: #A1A6B2; } .ansi-default-inverse-fg { color: #FFFFFF; } .ansi-default-inverse-bg { background-color: #000000; } .ansi-bold { font-weight: bold; } .ansi-underline { text-decoration: underline; } div.nbinput.container div.input_area div[class*=highlight] > pre, div.nboutput.container div.output_area div[class*=highlight] > pre, div.nboutput.container div.output_area div[class*=highlight].math, div.nboutput.container div.output_area.rendered_html, div.nboutput.container div.output_area > div.output_javascript, div.nboutput.container div.output_area:not(.rendered_html) > img{ padding: 5px; margin: 0; } /* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */ div.nbinput.container div.input_area > div[class^='highlight'], div.nboutput.container div.output_area > div[class^='highlight']{ overflow-y: hidden; } /* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */ .prompt .copybtn { display: none; } /* Some additional styling taken form the Jupyter notebook CSS */ .jp-RenderedHTMLCommon table, div.rendered_html table { border: none; border-collapse: collapse; border-spacing: 0; color: black; font-size: 12px; table-layout: fixed; } .jp-RenderedHTMLCommon thead, div.rendered_html thead { border-bottom: 1px solid black; vertical-align: bottom; } .jp-RenderedHTMLCommon tr, .jp-RenderedHTMLCommon th, .jp-RenderedHTMLCommon td, div.rendered_html tr, div.rendered_html th, div.rendered_html td { text-align: right; vertical-align: middle; padding: 0.5em 0.5em; line-height: normal; white-space: normal; max-width: none; border: none; } .jp-RenderedHTMLCommon th, div.rendered_html th { font-weight: bold; } .jp-RenderedHTMLCommon tbody tr:nth-child(odd), div.rendered_html tbody tr:nth-child(odd) { background: #f5f5f5; } .jp-RenderedHTMLCommon tbody tr:hover, div.rendered_html tbody tr:hover { background: rgba(66, 165, 245, 0.2); } </style> <section id=Merging-Data-to-Understand-the-Relationship-between-Drug-Legalization-and-Violent-Crime > <h1 id=exercises-exercise-merging--page-root >Merging Data to Understand the Relationship between Drug Legalization and Violent Crime<a class=headerlink  href="#exercises-exercise-merging--page-root" title="Permalink to this headline">¶</a></h1> <p>In recent years, many US states have decided to legalize the use of marijuana.</p> <p>When these ideas were first proposed, there were many theories about the relationship between crime and the “War on Drugs” (the term given to US efforts to arrest drug users and dealers over the past several decades).</p> <p>In this exercise, we’re going to test a few of those theories using drug arrest data from the state of California.</p> <p>Though California has passed a number of laws lessening penalities for marijuana possession over the years, arguably the biggest changes were in 2010, when the state changed the penalty for possessing a small amount of marijuana from a criminal crime to a “civil” penality (meaning those found guilty only had to pay a fine, not go to jail), though possessing, selling, or producing larger quantities remained illegal. Then in 2016, the state fully legalized marijuana for recreational use, not only making possession of small amounts legal, but also creating a regulatory system for producing marijuana for sale.</p> <p>Proponents of drug legalization have long argued that the war on drugs contributes to violent crime by creating an opportunity for drug dealers and organized crime to sell and distribute drugs, a business which tends to generate violence when gangs battle over territory. According to this theory, with drug legalization, we should see violent crime decrease after legalization in places where drug arrests had previously been common.</p> <p><strong>To be clear,</strong> this is far from the only argument for drug legalization! It is simply the argument we are well positioned to analyze today.</p> <section id=Gradescope-Autograding > <h2 id=Gradescope-Autograding >Gradescope Autograding<a class=headerlink  href="#Gradescope-Autograding" title="Permalink to this headline">¶</a></h2> <p>Please follow <a class="reference external" href="https://www.practicaldatascience.org/html/autograder_guidelines.html">all standard guidance</a> for submitting this assignment to the Gradescope autograder, including storing your solutions in a dictionary called <code class="docutils literal notranslate"><span class=pre >results</span></code> and ensuring your notebook runs from the start to completion without any errors.</p> <p>For this assignment, please name your file <code class="docutils literal notranslate"><span class=pre >exercise_merging.ipynb</span></code> before uploading.</p> <p>You can check that you have answers for all questions in your <code class="docutils literal notranslate"><span class=pre >results</span></code> dictionary with this code:</p> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=k >assert</span> <span class=nb >set</span><span class=p >(</span><span class=n >results</span><span class=o >.</span><span class=n >keys</span><span class=p >())</span> <span class=o >==</span> <span class=p >{</span>
    <span class=s2 >"ex6_validate_keyword"</span><span class=p >,</span>
    <span class=s2 >"ex10_merged_successfully"</span><span class=p >,</span>
    <span class=s2 >"ex16_num_obs"</span><span class=p >,</span>
    <span class=s2 >"ex17_drug_change"</span><span class=p >,</span>
    <span class=s2 >"ex18_violent_change"</span><span class=p >,</span>
    <span class=s2 >"ex21_diffindiff"</span><span class=p >,</span>
    <span class=s2 >"ex23_diffindiff_proportionate"</span><span class=p >,</span>
<span class=p >}</span>
</pre></div> </div> <section id=Submission-Limits > <h3 id=Submission-Limits >Submission Limits<a class=headerlink  href="#Submission-Limits" title="Permalink to this headline">¶</a></h3> <p>Please remember that you are <strong>only allowed three submissions to the autograder.</strong> Your last submission (if you submit 3 or fewer times), or your third submission (if you submit more than 3 times) will determine your grade Submissions that error out will <strong>not</strong> count against this total.</p> </section> </section> <section id=Pre-Legalization-Analysis > <h2 id=Pre-Legalization-Analysis >Pre-Legalization Analysis<a class=headerlink  href="#Pre-Legalization-Analysis" title="Permalink to this headline">¶</a></h2> <section id=Exercise-1 > <h3 id=Exercise-1 >Exercise 1<a class=headerlink  href="#Exercise-1" title="Permalink to this headline">¶</a></h3> <p>We will begin by examining <a class="reference external" href="https://github.com/nickeubank/practicaldatascience/tree/master/Example_Data/ca">county-level data on arrests from California in 2009</a>. This data is derived directly from data hosted by the <a class="reference external" href="https://openjustice.doj.ca.gov/data">Office of the California State Attorney General</a>, but please follow the github link above and download and import the file <code class="docutils literal notranslate"><span class=pre >ca_arrests_2009.csv</span></code> (don’t try and get it directly from the State Attorney General’s office).</p> </section> <section id=Exercise-2 > <h3 id=Exercise-2 >Exercise 2<a class=headerlink  href="#Exercise-2" title="Permalink to this headline">¶</a></h3> <p>Use your data exploration skills to get a feel for this data. If you need to, you can find the <a class="reference external" href="https://github.com/nickeubank/practicaldatascience/blob/master/Example_Data/ca/arrests_codebook.pdf">original codebook here</a> (This data is a version of that data, but collapsed to one observation per county.)</p> </section> <section id=Exercise-3 > <h3 id=Exercise-3 >Exercise 3<a class=headerlink  href="#Exercise-3" title="Permalink to this headline">¶</a></h3> <p>Figuring out what county has the most violent arrests isn’t very meaningful if we don’t normalize for size. A county with 10 people and 10 arrests for violent crimes is obviously worse than a county with 1,000,000 people an 11 arrests for violent crime.</p> <p>To address this, also import <code class="docutils literal notranslate"><span class=pre >nhgis_county_populations.csv</span></code> from <a class="reference external" href="https://github.com/nickeubank/practicaldatascience/tree/master/Example_Data/ca">the directory we’re working from</a>.</p> </section> <section id=Exercise-4 > <h3 id=Exercise-4 >Exercise 4<a class=headerlink  href="#Exercise-4" title="Permalink to this headline">¶</a></h3> <p>Use your data exploration skills to get used to this data, and figure out how it relates to your 2009 arrest data.</p> </section> <section id=Exercise-5 > <h3 id=Exercise-5 >Exercise 5<a class=headerlink  href="#Exercise-5" title="Permalink to this headline">¶</a></h3> <p>Once you feel like you have a good sense of the relation between our arrest and population data, merge the two datasets.</p> </section> <section id=Exercise-6 > <h3 id=Exercise-6 >Exercise 6<a class=headerlink  href="#Exercise-6" title="Permalink to this headline">¶</a></h3> <p>When merging data, the result will only be meaningful if your understanding of how the data sets you are merging relate to one another are correct. In some ways, this is obvious — for example, if the variable(s) that you are using to merge observations in the two datasets or to actually identifying observations that should be linked, then obviously merging using those variables will create a meaningless new dataset.</p> <p>But other properties that matter are often more subtle. For example, it’s important to figure out whether your merge is a <code class="docutils literal notranslate"><span class=pre >1-to-1</span></code> merge (meaning there is only one observation of the variable you’re merging on in both datasets), a <code class="docutils literal notranslate"><span class=pre >1-to-many</span></code> merge (meaning there is only one observation of the variable you’re merging on in the first dataset, but multiple observations in the second), or a <code class="docutils literal notranslate"><span class=pre >many-to-many</span></code> merge (something you almost never do).</p> <p>Being correct in your assumptions about these things is <em>very</em> important. If you think there’s only one observation per value of your merging variable in each dataset, but there are in fact 2, you’ll end up with two observations for each value after the merge. Moreover, not only is the structure of your data now a mess, but the fact you were wrong means you didn’t understand something about your data.</p> <p>So before running a merge, it is critical to answer the following questions:</p> <ol class="loweralpha simple"> <li><p>What variable(s) do you think will be consistent across these two datasets you can use for merging?</p> <li><p>Do you think there will be exactly 1 observation for each value of this variable(s) in your arrest data?</p> <li><p>Do you think there will be exactly 1 observation for each value of this variable(s) in your population data?</p> </ol> <p>So in markdown, answer these three questions for this data.</p> <p>Then also specify the type of merge you were hoping to accomplish as one of the following strings — <code class="docutils literal notranslate"><span class=pre >"one-to-one"</span></code>, <code class="docutils literal notranslate"><span class=pre >"one-to-many"</span></code>, <code class="docutils literal notranslate"><span class=pre >"many-to-one"</span></code>, or <code class="docutils literal notranslate"><span class=pre >"many-to-many"</span></code> — in your <code class="docutils literal notranslate"><span class=pre >results</span></code> dictionary under the key <code class="docutils literal notranslate"><span class=pre >"ex6_validate_keyword"</span></code>. Assume that the first dataset we are talking about (e.g., the <code class="docutils literal notranslate"><span class=pre >one</span></code> in <code class="docutils literal notranslate"><span class=pre >one-to-many</span></code>, if that were your selection) is your arrests data and the second dataset (e.g., the <code class="docutils literal notranslate"><span class=pre >many</span></code> in <code class="docutils literal notranslate"><span class=pre >one-to-many</span></code>, if that were your selection).</p> </section> </section> <section id=Merge-Validation > <h2 id=Merge-Validation >Merge Validation<a class=headerlink  href="#Merge-Validation" title="Permalink to this headline">¶</a></h2> <p>Because of the importance of answering these questions accurately, <code class="docutils literal notranslate"><span class=pre >pandas</span></code> provides a utility for <em>validating</em> these assumptions when you do a merge: the <code class="docutils literal notranslate"><span class=pre >validate</span></code> keyword! Validate will accept <code class="docutils literal notranslate"><span class=pre >"1:1"</span></code>, <code class="docutils literal notranslate"><span class=pre >"1:m"</span></code>, <code class="docutils literal notranslate"><span class=pre >"m:1"</span></code>, and <code class="docutils literal notranslate"><span class=pre >"m:m"</span></code>. It will then check to make sure your merge matches the type of merge you think it is. I <em>highly</em> recommend always using this option (…and not just because I’m the one who added <code class="docutils literal notranslate"><span class=pre >validate</span></code> to pandas).</p> <p><em>Note:</em> <code class="docutils literal notranslate"><span class=pre >validate</span></code> only actually tests if observations are unique when a <code class="docutils literal notranslate"><span class=pre >1</span></code> is specified; if you do a <code class="docutils literal notranslate"><span class=pre >1:1</span></code> merge but pass <code class="docutils literal notranslate"><span class=pre >validate="1:m"</span></code>, <code class="docutils literal notranslate"><span class=pre >validate="m:1"</span></code>, or <code class="docutils literal notranslate"><span class=pre >validate="m:m"</span></code>, you won’t get an error — a one-to-many merge that turns out to be a one-to-one isn’t nearly as dangerous as a one-to-one merge that turns out to be one-to-many.</p> <section id=Exercise-7 > <h3 id=Exercise-7 >Exercise 7<a class=headerlink  href="#Exercise-7" title="Permalink to this headline">¶</a></h3> <p>Repeat the merge you conducted above, but this time use the <code class="docutils literal notranslate"><span class=pre >validate</span></code> to make sure your assumptions about the data were correct. If you find that you made a mistake, revise your data until the merge you think is correct actually takes place.</p> <p>To aid the autograder, please make sure to comment out any code that generates an error.</p> </section> <section id=Exercise-8 > <h3 id=Exercise-8 >Exercise 8<a class=headerlink  href="#Exercise-8" title="Permalink to this headline">¶</a></h3> <p>Were your assumptions about the data correct? If not, what had you (implicitly) assumed when you did your merge in Exercise 5 that turned out not to be correct?</p> </section> </section> <section id=Merge-Diagnostics > <h2 id=Merge-Diagnostics >Merge Diagnostics<a class=headerlink  href="#Merge-Diagnostics" title="Permalink to this headline">¶</a></h2> <section id=Exercise-9 > <h3 id=Exercise-9 >Exercise 9<a class=headerlink  href="#Exercise-9" title="Permalink to this headline">¶</a></h3> <p>Checking whether you are doing a 1-to-1, many-to-1, 1-to-many, or many-to-many merge is only the first type of diagnostic test you should run on <em>every</em> merge you conduct. The second test is to see if you data merged successfully!</p> <p>To help with this, the <code class="docutils literal notranslate"><span class=pre >merge</span></code> function in pandas offers a keyword option called <code class="docutils literal notranslate"><span class=pre >indicator</span></code>. If you set <code class="docutils literal notranslate"><span class=pre >indicator</span></code> to <code class="docutils literal notranslate"><span class=pre >True</span></code>, then pandas will add a column to the result of your merge called <code class="docutils literal notranslate"><span class=pre >_merge</span></code>. This variable will tell you, for each observation in your merged data, whether:</p> <ul class=simple > <li><p>that observation came from a successful merge of both datasets,</p> <li><p>if that observation was in the left dataset (the first one you passed) but not the right dataset (the second one you passed), or</p> <li><p>if that observation was in the right dataset but not the left.</p> </ul> <p>This allows you to quickly identify failed merges!</p> <p>For example, suppose you had the following data:</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[1]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >import</span> <span class=nn >pandas</span> <span class=k >as</span> <span class=nn >pd</span>
<span class=kn >import</span> <span class=nn >numpy</span> <span class=k >as</span> <span class=nn >np</span>

<span class=n >pd</span><span class=o >.</span><span class=n >set_option</span><span class=p >(</span><span class=s2 >"mode.copy_on_write"</span><span class=p >,</span> <span class=kc >True</span><span class=p >)</span>

<span class=n >df1</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >DataFrame</span><span class=p >({</span><span class=s2 >"key"</span><span class=p >:</span> <span class=p >[</span><span class=s2 >"key1"</span><span class=p >,</span> <span class=s2 >"key2"</span><span class=p >],</span> <span class=s2 >"df1_var"</span><span class=p >:</span> <span class=p >[</span><span class=mi >1</span><span class=p >,</span> <span class=mi >2</span><span class=p >]})</span>
<span class=n >df1</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[1]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>key <th>df1_var <tr> <th>0 <td>key1 <td>1 <tr> <th>1 <td>key2 <td>2 </table> </div></div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[2]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >df2</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >DataFrame</span><span class=p >({</span><span class=s2 >"key"</span><span class=p >:</span> <span class=p >[</span><span class=s2 >"key1"</span><span class=p >,</span> <span class=s2 >"Key2"</span><span class=p >],</span> <span class=s2 >"df2_var"</span><span class=p >:</span> <span class=p >[</span><span class=s2 >"a"</span><span class=p >,</span> <span class=s2 >"b"</span><span class=p >]})</span>
<span class=n >df2</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[2]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>key <th>df2_var <tr> <th>0 <td>key1 <td>a <tr> <th>1 <td>Key2 <td>b </table> </div></div> </div> <p>Now suppose you <em>expected</em> that all observations should merge when you merge these datasets (because you hadn’t noticed the typo in <code class="docutils literal notranslate"><span class=pre >df2</span></code> where <code class="docutils literal notranslate"><span class=pre >key2</span></code> has a capital <code class="docutils literal notranslate"><span class=pre >Key2</span></code>. If you just run a merge, it works without any problems:</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[3]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >new_data</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >merge</span><span class=p >(</span><span class=n >df1</span><span class=p >,</span> <span class=n >df2</span><span class=p >,</span> <span class=n >on</span><span class=o >=</span><span class=s2 >"key"</span><span class=p >,</span> <span class=n >how</span><span class=o >=</span><span class=s2 >"outer"</span><span class=p >)</span>
</pre></div> </div> </div> <p>And so you might carry on in life unaware your data is now corrupted: instead of two merged rows, you now have 3, only 1 of which merged correctly!</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[4]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >new_data</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[4]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>key <th>df1_var <th>df2_var <tr> <th>0 <td>key1 <td>1.0 <td>a <tr> <th>1 <td>key2 <td>2.0 <td>NaN <tr> <th>2 <td>Key2 <td>NaN <td>b </table> </div></div> </div> <p>When what you really wanted was:</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[5]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >df2_correct</span> <span class=o >=</span> <span class=n >df2</span><span class=o >.</span><span class=n >copy</span><span class=p >()</span>
<span class=n >df2_correct</span><span class=o >.</span><span class=n >loc</span><span class=p >[</span><span class=n >df2</span><span class=o >.</span><span class=n >key</span> <span class=o >==</span> <span class=s2 >"Key2"</span><span class=p >,</span> <span class=s2 >"key"</span><span class=p >]</span> <span class=o >=</span> <span class=s2 >"key2"</span>
<span class=n >pd</span><span class=o >.</span><span class=n >merge</span><span class=p >(</span><span class=n >df1</span><span class=p >,</span> <span class=n >df2_correct</span><span class=p >,</span> <span class=n >on</span><span class=o >=</span><span class=s2 >"key"</span><span class=p >,</span> <span class=n >how</span><span class=o >=</span><span class=s2 >"outer"</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[5]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>key <th>df1_var <th>df2_var <tr> <th>0 <td>key1 <td>1 <td>a <tr> <th>1 <td>key2 <td>2 <td>b </table> </div></div> </div> <p>(in a small dataset, you’d quickly see you have 1 row instead of 2, but if you have millions of rows, a couple missing won’t be evident).</p> <p>But now suppose we use the <code class="docutils literal notranslate"><span class=pre >indicator</span></code> function:</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[6]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >new_data</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >merge</span><span class=p >(</span><span class=n >df1</span><span class=p >,</span> <span class=n >df2</span><span class=p >,</span> <span class=n >on</span><span class=o >=</span><span class=s2 >"key"</span><span class=p >,</span> <span class=n >how</span><span class=o >=</span><span class=s2 >"outer"</span><span class=p >,</span> <span class=n >indicator</span><span class=o >=</span><span class=kc >True</span><span class=p >)</span>
<span class=n >new_data</span><span class=o >.</span><span class=n >_merge</span><span class=o >.</span><span class=n >value_counts</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[6]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
_merge
left_only     1
right_only    1
both          1
Name: count, dtype: int64
</pre></div></div> </div> <p>We could immediately see that only one observation merged correct, and that one row from each dataset failed to merge!</p> <p>Moreover, we can look at the failed merges:</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[7]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >new_data</span><span class=p >[</span><span class=n >new_data</span><span class=o >.</span><span class=n >_merge</span> <span class=o >!=</span> <span class=s2 >"both"</span><span class=p >]</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[7]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>key <th>df1_var <th>df2_var <th>_merge <tr> <th>1 <td>key2 <td>2.0 <td>NaN <td>left_only <tr> <th>2 <td>Key2 <td>NaN <td>b <td>right_only </table> </div></div> </div> <p>Allowing us to easily diagnose the problem.</p> <p><strong>Note:</strong> The <code class="docutils literal notranslate"><span class=pre >pandas</span></code> merge function allows users to decide whether to keep only observations that merge (<code class="docutils literal notranslate"><span class=pre >how='inner'</span></code>), all the observations from the first dataset pasted to merge (<code class="docutils literal notranslate"><span class=pre >how='left'</span></code>), all the observations from the second dataset passed to merge (<code class="docutils literal notranslate"><span class=pre >how='right'</span></code>), or all observations (<code class="docutils literal notranslate"><span class=pre >how='outer'</span></code>):</p> <img alt=join_types  src="https://nickeubank.github.io/practicaldatascience_book/_images/3.4.15_merge_types.png"/> <p>But one danger to using the more restrictive options (like the default, <code class="docutils literal notranslate"><span class=pre >how='inner'</span></code>) is that the merge throws away all the observations that fail to merge, and while this may be the <em>eventual</em> goal of your analysis, it means that you don’t get to see all the observations that failed to merge that maybe you thought <em>would</em> merge. In other words, it throws away the errors so you can’t look at them!</p> <p>So to use <code class="docutils literal notranslate"><span class=pre >indicator</span></code> effectively, you have to:</p> <ul class=simple > <li><p>Not use <code class="docutils literal notranslate"><span class=pre >how="inner"</span></code>, and</p> <li><p>Check the values of <code class="docutils literal notranslate"><span class=pre >_merge</span></code> after your merge.</p> </ul> </section> <section id=Exercise-10 > <h3 id=Exercise-10 >Exercise 10<a class=headerlink  href="#Exercise-10" title="Permalink to this headline">¶</a></h3> <p>Now repeat your previous merge using <em>both</em> the <code class="docutils literal notranslate"><span class=pre >validate</span></code> keyword <em>and</em> the <code class="docutils literal notranslate"><span class=pre >indicator</span></code> keyword with <code class="docutils literal notranslate"><span class=pre >how='outer'</span></code>.</p> <p>How many observations successfully merged (were in both datasets)? Store the result in <code class="docutils literal notranslate"><span class=pre >results</span></code> under the key <code class="docutils literal notranslate"><span class=pre >"ex10_merged_successfully"</span></code>.</p> </section> <section id=Exercise-11 > <h3 id=Exercise-11 >Exercise 11<a class=headerlink  href="#Exercise-11" title="Permalink to this headline">¶</a></h3> <p>You <em>should</em> be able to get to the point that all counties in our arrest data merge with population data. If that did not happen, can you figure out why that did not happen? Can you fix the data so that all arrest data merges with population data?</p> </section> </section> <section id=Comparing-Arrest-Rates > <h2 id=Comparing-Arrest-Rates >Comparing Arrest Rates<a class=headerlink  href="#Comparing-Arrest-Rates" title="Permalink to this headline">¶</a></h2> <section id=Exercise-12 > <h3 id=Exercise-12 >Exercise 12<a class=headerlink  href="#Exercise-12" title="Permalink to this headline">¶</a></h3> <p>Now that we have arrest counts and population data, we can calculate arrest <em>rates</em>. For each county, create a new variable called <code class="docutils literal notranslate"><span class=pre >violent_arrest_rate_2009</span></code> that is the number of violent arrests for 2009 divided by the population of the county from 2005-2009, and a similar new variable called <code class="docutils literal notranslate"><span class=pre >drug_arrest_rate_2009</span></code> for drug arrests divided by population.</p> </section> <section id=Exercise-13 > <h3 id=Exercise-13 >Exercise 13<a class=headerlink  href="#Exercise-13" title="Permalink to this headline">¶</a></h3> <p>Make a scatter plot that shows the relationship between each county’s violent arrest rate and it’s drug arrest rate. Since we haven’t done a lot with plotting yet, feel free to plot in whatever manner feels most comfortable. The easiest, if you’re unsure, is just to use the <code class="docutils literal notranslate"><span class=pre >pandas</span></code> inbuilt <code class="docutils literal notranslate"><span class=pre >.plot()</span></code> method. Just specify the <code class="docutils literal notranslate"><span class=pre >x</span></code> keyword with your x-axis variable, the <code class="docutils literal notranslate"><span class=pre >y</span></code> keyword with your y-axis variable, and use <code class="docutils literal notranslate"><span class=pre >kind="scatter"</span></code>.</p> </section> <section id=Exercise-14 > <h3 id=Exercise-14 >Exercise 14<a class=headerlink  href="#Exercise-14" title="Permalink to this headline">¶</a></h3> <p>Based on this simple comparison of 2009 violent arrest rates and drug arrest rates, what might you conclude about the relationship between the illegal drug trade and violent crime?</p> </section> </section> <section id=Comparing-with-2018-Arrests > <h2 id=Comparing-with-2018-Arrests >Comparing with 2018 Arrests<a class=headerlink  href="#Comparing-with-2018-Arrests" title="Permalink to this headline">¶</a></h2> <p>The preceding analysis can tell us about whether violent crime and the drug trade are correlated, but it doesn’t tell us much about whether they are <em>causally</em> related. It <em>could</em> be the case that people dealing drugs <em>cause</em> more violent crime, but it could also be that certain communities, for some other reason, tend to have <em>both</em> more drug sales <em>and</em> more violent crime.</p> <p>To help answer this question, let’s examine whether violent crime arrest rates changed in response to drug legalization. In particular, let’s do this by comparing violent crime arrest rates in 2009 (before drug legalization) to violent crime arrest rates in 2018 (after drug legalization). If the illegal drug trade causes violent crime, then we would expect the violent crime rate to fall in response to drug legalization.</p> <section id=Exercise-15 > <h3 id=Exercise-15 >Exercise 15<a class=headerlink  href="#Exercise-15" title="Permalink to this headline">¶</a></h3> <p>Just as we created violent arrest rates and drug arrest rates for 2009, now we want to do it for 2018. Using the data on 2018 arrests (also in the <a class="reference external" href="https://github.com/nickeubank/practicaldatascience/tree/master/Example_Data/ca">same repository</a> we used before) and the same dataset of population data (you’ll have to use population from 2013-2017, as 2018 population data has yet to be released), create a dataset of arrest rates.</p> <p>As before, <em>be careful with your merges!!!</em></p> </section> <section id=Exercise-16 > <h3 id=Exercise-16 >Exercise 16<a class=headerlink  href="#Exercise-16" title="Permalink to this headline">¶</a></h3> <p>Now merge our two county-level datasets so you have one row for every county, and variables for violent arrest rates in 2018, violent arrest rates in 2009, felony drug arrest rates in 2018, and felony drug arrest rates in 2009. Store the number of observations in your final data set in your <code class="docutils literal notranslate"><span class=pre >results</span></code> dictionary under the key <code class="docutils literal notranslate"><span class=pre >"ex16_num_obs"</span></code>.</p> </section> <section id=Exercise-17 > <h3 id=Exercise-17 >Exercise 17<a class=headerlink  href="#Exercise-17" title="Permalink to this headline">¶</a></h3> <p>Did drug arrests go down from 2009 to 2018 in response to drug legalization? (they sure better! This is what’s called a “sanity check” of your data and analysis. If you find drug arrests went <em>up</em>, you know something went wrong with your code or your understanding of the situations).</p> <p>Store the average county-level change in drug arrests per capita in <code class="docutils literal notranslate"><span class=pre >results</span></code> under the key <code class="docutils literal notranslate"><span class=pre >"ex17_drug_change"</span></code>.</p> </section> <section id=Exercise-18 > <h3 id=Exercise-18 >Exercise 18<a class=headerlink  href="#Exercise-18" title="Permalink to this headline">¶</a></h3> <p>Now we want to look at whether violent crime decreased following drug legalization. Did the average violent arrest rate decrease? By how much? (Note: We’re assuming that arrest rates are proportionate to crime rates. If policing increased so that there were more arrests per crime committed, that would impact our interpretation of these results. But this is just an exercise, so…)</p> <p>Store the average county-level change in violent arrests per capita in <code class="docutils literal notranslate"><span class=pre >results</span></code> under the key <code class="docutils literal notranslate"><span class=pre >"ex18_violent_change"</span></code></p> </section> <section id=Exercise-19 > <h3 id=Exercise-19 >Exercise 19<a class=headerlink  href="#Exercise-19" title="Permalink to this headline">¶</a></h3> <p>Based on your answers to exercises 17 and 18, what might you conclude about the relationship between the illegal drug trade and violent crime? Did legalizing drugs increase violent crime (assuming arrest rates are a good proxy for crime rates)? Decrease violent crime? Have no effect?</p> </section> </section> <section id=Difference-in-Difference-Analysis > <h2 id=Difference-in-Difference-Analysis >Difference in Difference Analysis<a class=headerlink  href="#Difference-in-Difference-Analysis" title="Permalink to this headline">¶</a></h2> <p>The preceding analysis is something we sometimes call a “pre-post” analysis, in that it is a comparison of how and outcome we care about (violent arrest rates) changes from before a treatment is introduced (“pre”) to after (“post”). BUT: pre-post comparisons are imperfect. If we knew that violent crime was not going to change at all in a world without drug legalization, then this comparison is perfectly valid. But what if, absent drug legalization, violent crime would have fallen on its own (maybe because of advances in policing practices or a better economy)? Or maybe it would have increased?</p> <p>This is actually a very common problem. For example, imagine you’re trying to figure out whether taking tylenol helps with headaches. You have a patient with a headache, you give them tylenol, and then the next day you ask them if they still have a headache, and find out that they don’t — does that mean that tylenol cured the headache? Maybe… but most headaches eventually resolve on their own, so maybe the headache would have passed with or without the patient taking tylenol! In fact, there’s a term for this phenomenon in medicine — the “natural history” of a disease, which is the trajectory that we think a disease might follow absent treatment. And the natural history of the disease is almost never for it to stay exactly the same indefinitely.</p> <p>(All of this is closely related to the discipline of causal inference, and if it makes your head to hurt, don’t worry — that means you’re doing it right! We will talk lots and lots more about it in the weeks and months to come.)</p> <p>One way to try to overcome this problem is with something called a difference-in-difference analysis. Rather than just looking at whether violent drug arrest rates increase or decrease between 2009 and 2018, we can split our sample of counties into those that were <em>more</em> impacted by drug legalization and those that were <em>less</em> impacted by drug legalization and evaluate whether we see a greater change in the violent drug arrest rate in the counties that were more impacted.</p> <p>What does it mean to have been “more impacted” by drug legalization? In this case, we can treat the counties that had higher drug arrest rates in 2009 as counties that were more impacted by drug legalization than those that had low drug arrest rates in 2009. After all, in a county that had no drug arrests, legalization wouldn’t do anything, would it?</p> <section id=Exercise-20 > <h3 id=Exercise-20 >Exercise 20<a class=headerlink  href="#Exercise-20" title="Permalink to this headline">¶</a></h3> <p>First, split our sample into two groups: high drug arrests in 2009, and low drug arrests in 2009 (cut the sample at the average drug arrest rate in 2009).</p> </section> <section id=Exercise-21 > <h3 id=Exercise-21 >Exercise 21<a class=headerlink  href="#Exercise-21" title="Permalink to this headline">¶</a></h3> <p>Now, determine weather violent crime changed <em>more</em> from 2009 to 2018 in the counties that had lots of drug arrests in 2009 (where legalization likely had more of an effect) than in counties with fewer drug arrests in 2009 (where legalization likely mattered less)?</p> <p>Calculate this difference-in-difference:</p> <div class="highlight-none notranslate"><div class=highlight ><pre><span></span>(the change in violent crime rate per capita for counties with lots of drug arrests in 2009)
- (the change in violent crime rate per capita for counties with few drug arrests in 2009)
</pre></div> </div> <p>Store your “difference-in-difference” estimate in your <code class="docutils literal notranslate"><span class=pre >results</span></code> dictionary under the key <code class="docutils literal notranslate"><span class=pre >"ex21_diffindiff"</span></code>.</p> </section> <section id=Exercise-22 > <h3 id=Exercise-22 >Exercise 22<a class=headerlink  href="#Exercise-22" title="Permalink to this headline">¶</a></h3> <p>Interpret your difference in difference result.</p> </section> <section id=Exercise-23 > <h3 id=Exercise-23 >Exercise 23<a class=headerlink  href="#Exercise-23" title="Permalink to this headline">¶</a></h3> <p>The quantity we estimated above is a little difficult to interpret. Rather than calculating the <em>absolute</em> change in violent arrest rates per capita, let’s calculate the <em>proportionate</em> change.</p> <p>Calculate:</p> <div class="highlight-none notranslate"><div class=highlight ><pre><span></span>(the county-level percentage change in violent crime rate with lots of drug arrests in 2009)
- (the county-level percentage change in violent crime rate with few drug arrests in 2009)
</pre></div> </div> <p>Store your “difference-in-difference” estimate in your <code class="docutils literal notranslate"><span class=pre >results</span></code> dictionary under the key <code class="docutils literal notranslate"><span class=pre >"ex24_diffindiff_proportionate"</span></code>. Report your result in percentages, such that a value of <code class="docutils literal notranslate"><span class=pre >-100</span></code> would imply that the average county experienced a 100% decrease in the violent arrest rate.</p> </section> </section> </section> </article> </div> </div> </main> </div> <footer class=md-footer > <div class=md-footer-nav > <nav class="md-footer-nav__inner md-grid"> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright > <div class=md-footer-copyright__highlight > &#169; Copyright 2021, Nick Eubank. </div> Created using <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.5.0. and <a href="https://github.com/bashtage/sphinx-material/">Material for Sphinx</a> </div> </div> </div> </footer> <script src="../_static/javascripts/application.js"></script> <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>