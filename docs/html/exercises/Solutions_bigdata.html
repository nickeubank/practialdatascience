<!DOCTYPE html> <meta charset=utf-8  /> <meta name=viewport  content="width=device-width, initial-scale=1.0" /><meta name=generator  content="Docutils 0.17.1: http://docutils.sourceforge.net/" /> <meta name=viewport  content="width=device-width,initial-scale=1"> <meta http-equiv=x-ua-compatible  content="ie=edge"> <meta name="lang:clipboard.copy" content="Copy to clipboard"> <meta name="lang:clipboard.copied" content="Copied to clipboard"> <meta name="lang:search.language" content=en > <meta name="lang:search.pipeline.stopwords" content=True > <meta name="lang:search.pipeline.trimmer" content=True > <meta name="lang:search.result.none" content="No matching documents"> <meta name="lang:search.result.one" content="1 matching document"> <meta name="lang:search.result.other" content="# matching documents"> <meta name="lang:search.tokenizer" content="[\s\-]+"> <link href="https://fonts.gstatic.com/" rel=preconnect  crossorigin> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel=stylesheet > <style> body, input { font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif } code, kbd, pre { font-family: "Roboto Mono", "Courier New", Courier, monospace } </style> <link rel=stylesheet  href="../_static/stylesheets/application.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-palette.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-fixes.css"/> <link rel=stylesheet  href="../_static/fonts/material-icons.css"/> <meta name=theme-color  content="#2196f3"> <script src="../_static/javascripts/modernizr.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-XX133829453-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-XX133829453-1'); </script> <title>Big Data Exercises &#8212; Practical Data Science</title> <link rel=stylesheet  type="text/css" href="../_static/pygments.css" /> <link rel=stylesheet  type="text/css" href="../_static/material.css" /> <script data-url_root="../" id=documentation_options  src="../_static/documentation_options.js"></script> <script src="../_static/jquery.js"></script> <script src="../_static/underscore.js"></script> <script src="../_static/doctools.js"></script> <script crossorigin=anonymous  integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script> <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script> <script defer=defer  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <link rel="shortcut icon" href="../_static/mids_logo.svg"/> <link rel=index  title=Index  href="../genindex.html" /> <link rel=search  title=Search  href="../search.html" /> <body dir=ltr data-md-color-primary=blue-grey data-md-color-accent=blue> <svg class=md-svg > <defs data-children-count=0 > <svg xmlns="http://www.w3.org/2000/svg" width=416  height=448  viewBox="0 0 416 448" id=__github ><path fill=currentColor  d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle  data-md-toggle=drawer  type=checkbox  id=__drawer > <input class=md-toggle  data-md-toggle=search  type=checkbox  id=__search > <label class=md-overlay  data-md-component=overlay  for=__drawer ></label> <a href="#exercises/Solutions_bigdata" tabindex=1  class=md-skip > Skip to content </a> <header class=md-header  data-md-component=header > <nav class="md-header-nav md-grid"> <div class="md-flex navheader"> <div class="md-flex__cell md-flex__cell--shrink"> <a href="../index.html" title="Practical Data Science" class="md-header-nav__button md-logo"> <img src="../_static/mids_logo.svg" height=26  alt="Practical Data Science logo"> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer ></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title > <span class=md-header-nav__topic >Practical Data Science</span> <span class=md-header-nav__topic > Big Data Exercises </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search ></label> <div class=md-search  data-md-component=search  role=dialog > <label class=md-search__overlay  for=__search ></label> <div class=md-search__inner  role=search > <form class=md-search__form  action="../search.html" method=get  name=search > <input type=text  class=md-search__input  name=q  placeholder=""Search"" autocapitalize=off  autocomplete=off  spellcheck=false  data-md-component=query  data-md-state=active > <label class="md-icon md-search__icon" for=__search ></label> <button type=reset  class="md-icon md-search__icon" data-md-component=reset  tabindex=-1 > &#xE5CD; </button> </form> <div class=md-search__output > <div class=md-search__scrollwrap  data-md-scrollfix> <div class=md-search-result  data-md-component=result > <div class=md-search-result__meta > Type to start searching </div> <ol class=md-search-result__list ></ol> </div> </div> </div> </div> </div> </div> <script src="../_static/javascripts/version_dropdown.js"></script> <script> var json_loc = "../"versions.json"", target_loc = "../../", text = "Versions"; $( document ).ready( add_version_dropdown(json_loc, target_loc, text)); </script> </div> </nav> </header> <div class=md-container > <nav class=md-tabs  data-md-component=tabs > <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list > <li class=md-tabs__item ><a href="../index.html" class=md-tabs__link >Home</a> <li class=md-tabs__item ><a href="../class_schedule.html" class=md-tabs__link >Class Schedule</a> <li class=md-tabs__item ><a href="../topic_list.html" class=md-tabs__link >Topic List</a> <li class=md-tabs__item ><a href="https://www.nickeubank.com" class=md-tabs__link >About The Author</a> </ul> </div> </nav> <main class=md-main > <div class="md-main__inner md-grid" data-md-component=container > <div class="md-sidebar md-sidebar--primary" data-md-component=navigation > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--primary" data-md-level=0 > <label class="md-nav__title md-nav__title--site" for=__drawer > <a href="../index.html" title="Practical Data Science" class="md-nav__button md-logo"> <img src="../_static/mids_logo.svg" alt=" logo" width=48  height=48 > </a> <a href="../index.html" title="Practical Data Science">Practical Data Science</a> </label> <ul class=md-nav__list > <li class=md-nav__item > <a href="../class_schedule.html" class=md-nav__link >Class Schedule</a> <li class=md-nav__item > <a href="../autograder_guidelines.html" class=md-nav__link >Autograder Guidelines</a> <li class=md-nav__item > <a href="../not_a_mids_student.html" class=md-nav__link >Not a MIDS Student?</a> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >"Contents"</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#exercises-solutions-bigdata--page-root" class=md-nav__link >Big Data Exercises</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Want-More-Practice?" class=md-nav__link >Want More Practice?</a> </ul> </nav> </ul> </nav> </div> </div> </div> <div class=md-content > <article class="md-content__inner md-typeset" role=main > <style> /* CSS for nbsphinx extension */ /* remove conflicting styling from Sphinx themes */ div.nbinput.container div.prompt *, div.nboutput.container div.prompt *, div.nbinput.container div.input_area pre, div.nboutput.container div.output_area pre, div.nbinput.container div.input_area .highlight, div.nboutput.container div.output_area .highlight { border: none; padding: 0; margin: 0; box-shadow: none; } div.nbinput.container > div[class*=highlight], div.nboutput.container > div[class*=highlight] { margin: 0; } div.nbinput.container div.prompt *, div.nboutput.container div.prompt * { background: none; } div.nboutput.container div.output_area .highlight, div.nboutput.container div.output_area pre { background: unset; } div.nboutput.container div.output_area div.highlight { color: unset; /* override Pygments text color */ } /* avoid gaps between output lines */ div.nboutput.container div[class*=highlight] pre { line-height: normal; } /* input/output containers */ div.nbinput.container, div.nboutput.container { display: -webkit-flex; display: flex; align-items: flex-start; margin: 0; width: 100%; } @media (max-width: 540px) { div.nbinput.container, div.nboutput.container { flex-direction: column; } } /* input container */ div.nbinput.container { padding-top: 5px; } /* last container */ div.nblast.container { padding-bottom: 5px; } /* input prompt */ div.nbinput.container div.prompt pre { color: #307FC1; } /* output prompt */ div.nboutput.container div.prompt pre { color: #BF5B3D; } /* all prompts */ div.nbinput.container div.prompt, div.nboutput.container div.prompt { width: 4.5ex; padding-top: 5px; position: relative; user-select: none; } div.nbinput.container div.prompt > div, div.nboutput.container div.prompt > div { position: absolute; right: 0; margin-right: 0.3ex; } @media (max-width: 540px) { div.nbinput.container div.prompt, div.nboutput.container div.prompt { width: unset; text-align: left; padding: 0.4em; } div.nboutput.container div.prompt.empty { padding: 0; } div.nbinput.container div.prompt > div, div.nboutput.container div.prompt > div { position: unset; } } /* disable scrollbars on prompts */ div.nbinput.container div.prompt pre, div.nboutput.container div.prompt pre { overflow: hidden; } /* input/output area */ div.nbinput.container div.input_area, div.nboutput.container div.output_area { -webkit-flex: 1; flex: 1; overflow: auto; } @media (max-width: 540px) { div.nbinput.container div.input_area, div.nboutput.container div.output_area { width: 100%; } } /* input area */ div.nbinput.container div.input_area { border: 1px solid #e0e0e0; border-radius: 2px; /*background: #f5f5f5;*/ } /* override MathJax center alignment in output cells */ div.nboutput.container div[class*=MathJax] { text-align: left !important; } /* override sphinx.ext.imgmath center alignment in output cells */ div.nboutput.container div.math p { text-align: left; } /* standard error */ div.nboutput.container div.output_area.stderr { background: #fdd; } /* ANSI colors */ .ansi-black-fg { color: #3E424D; } .ansi-black-bg { background-color: #3E424D; } .ansi-black-intense-fg { color: #282C36; } .ansi-black-intense-bg { background-color: #282C36; } .ansi-red-fg { color: #E75C58; } .ansi-red-bg { background-color: #E75C58; } .ansi-red-intense-fg { color: #B22B31; } .ansi-red-intense-bg { background-color: #B22B31; } .ansi-green-fg { color: #00A250; } .ansi-green-bg { background-color: #00A250; } .ansi-green-intense-fg { color: #007427; } .ansi-green-intense-bg { background-color: #007427; } .ansi-yellow-fg { color: #DDB62B; } .ansi-yellow-bg { background-color: #DDB62B; } .ansi-yellow-intense-fg { color: #B27D12; } .ansi-yellow-intense-bg { background-color: #B27D12; } .ansi-blue-fg { color: #208FFB; } .ansi-blue-bg { background-color: #208FFB; } .ansi-blue-intense-fg { color: #0065CA; } .ansi-blue-intense-bg { background-color: #0065CA; } .ansi-magenta-fg { color: #D160C4; } .ansi-magenta-bg { background-color: #D160C4; } .ansi-magenta-intense-fg { color: #A03196; } .ansi-magenta-intense-bg { background-color: #A03196; } .ansi-cyan-fg { color: #60C6C8; } .ansi-cyan-bg { background-color: #60C6C8; } .ansi-cyan-intense-fg { color: #258F8F; } .ansi-cyan-intense-bg { background-color: #258F8F; } .ansi-white-fg { color: #C5C1B4; } .ansi-white-bg { background-color: #C5C1B4; } .ansi-white-intense-fg { color: #A1A6B2; } .ansi-white-intense-bg { background-color: #A1A6B2; } .ansi-default-inverse-fg { color: #FFFFFF; } .ansi-default-inverse-bg { background-color: #000000; } .ansi-bold { font-weight: bold; } .ansi-underline { text-decoration: underline; } div.nbinput.container div.input_area div[class*=highlight] > pre, div.nboutput.container div.output_area div[class*=highlight] > pre, div.nboutput.container div.output_area div[class*=highlight].math, div.nboutput.container div.output_area.rendered_html, div.nboutput.container div.output_area > div.output_javascript, div.nboutput.container div.output_area:not(.rendered_html) > img{ padding: 5px; margin: 0; } /* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */ div.nbinput.container div.input_area > div[class^='highlight'], div.nboutput.container div.output_area > div[class^='highlight']{ overflow-y: hidden; } /* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */ .prompt .copybtn { display: none; } /* Some additional styling taken form the Jupyter notebook CSS */ .jp-RenderedHTMLCommon table, div.rendered_html table { border: none; border-collapse: collapse; border-spacing: 0; color: black; font-size: 12px; table-layout: fixed; } .jp-RenderedHTMLCommon thead, div.rendered_html thead { border-bottom: 1px solid black; vertical-align: bottom; } .jp-RenderedHTMLCommon tr, .jp-RenderedHTMLCommon th, .jp-RenderedHTMLCommon td, div.rendered_html tr, div.rendered_html th, div.rendered_html td { text-align: right; vertical-align: middle; padding: 0.5em 0.5em; line-height: normal; white-space: normal; max-width: none; border: none; } .jp-RenderedHTMLCommon th, div.rendered_html th { font-weight: bold; } .jp-RenderedHTMLCommon tbody tr:nth-child(odd), div.rendered_html tbody tr:nth-child(odd) { background: #f5f5f5; } .jp-RenderedHTMLCommon tbody tr:hover, div.rendered_html tbody tr:hover { background: rgba(66, 165, 245, 0.2); } </style> <section id=Big-Data-Exercises > <h1 id=exercises-solutions-bigdata--page-root >Big Data Exercises<a class=headerlink  href="#exercises-solutions-bigdata--page-root" title="Permalink to this headline">¶</a></h1> <p>In these exercises we will work on data from a series of global weather monitoring stations used to measure climate trends to examine long-term trends in temperature for your home locality. This data comes from the Global Historical Climatology Network, and is the actual raw data provided by NOAA. The only changes I have made to this data are a few small formatting changes to help meet the learning goals of this exercise.</p> <p>To do these excercises, first please download the data for this exercise <a class="reference external" href="https://www.dropbox.com/s/oq36w90hm9ltgvc/global_climate_data.zip?dl=0">from here</a>. Note this is a big file (this is a big-data exercise, after all), so be patient.</p> <p><strong>(1)</strong> The data we’ll be working with can be found in the file <code class="docutils literal notranslate"><span class=pre >ghcnd_daily.tar.gz</span></code>. It includes daily weather data from thousands of weather stations around the work over many decades.</p> <p>Begin by unzipping the file and checking it’s size – it should come out to be <em>about</em> 4gb, but will expand to about 12 gb in RAM, which means there’s just no way most students (who usually have, at most, 16gb of RAM) can import this dataset into pandas and manipulate it directly.</p> <p>(Note: what we’re doing can be applied to much bigger datasets, but they sometimes takes hours to work with, so we’re working with data that’s just a <em>little</em> big so we can get exercises done in reasonable time).</p> <p><strong>(2)</strong> Thankfully, we aren’t going to be working with <em>all</em> the data today. Instead, everyone should pick three weather stations to examine during this analysis.</p> <p>To pick your stations, we’ll need to open the <code class="docutils literal notranslate"><span class=pre >ghcnd-stations.txt</span></code> file in the directory you’ve downloaded. It includes both station codes (which is what we’ll find in the <code class="docutils literal notranslate"><span class=pre >ghcnd_daily.csv</span></code> data, as well as the name and location of each station).</p> <p>When picking a weather station, make sure to pick one flagged as being in either GSN, HCN, or CRN (these designate more formalized stations that have been around a long time, ensuring you’ll get a station with data that has been recorded over a longer period).</p> <p>Note that Station IDs start with the two-letter code of the country in which they are located, and the “NAME” column often constains city names.</p> <p><strong>The ``ghcnd-stations.txt`` is a “fixed-width” dataset,</strong> meaning that instead of putting commas or tabs between observations, all columns have the same width (in terms of number of characters). So to import this data you’ll have to (a) read the notes about the data in the project README.txt, and (b) read about how to read in fixed-width data in pandas. When entering column specifications, remember that normal people count from 1 and include end points, while Python counts from 0 and doesn’t include end points (so if the readme says data is in columns 10-20, in Python that’d be 9 through 20).</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[1]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >import</span> <span class=nn >pandas</span> <span class=k >as</span> <span class=nn >pd</span>
<span class=kn >import</span> <span class=nn >os</span>

<span class=n >os</span><span class=o >.</span><span class=n >chdir</span><span class=p >(</span><span class=s2 >"/users/nick/downloads/global_climate_data"</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[2]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >columns</span> <span class=o >=</span> <span class=p >[</span>
    <span class=p >(</span><span class=mi >0</span><span class=p >,</span> <span class=mi >11</span><span class=p >),</span>
    <span class=p >(</span><span class=mi >12</span><span class=p >,</span> <span class=mi >20</span><span class=p >),</span>
    <span class=p >(</span><span class=mi >21</span><span class=p >,</span> <span class=mi >30</span><span class=p >),</span>
    <span class=p >(</span><span class=mi >31</span><span class=p >,</span> <span class=mi >37</span><span class=p >),</span>
    <span class=p >(</span><span class=mi >38</span><span class=p >,</span> <span class=mi >40</span><span class=p >),</span>
    <span class=p >(</span><span class=mi >41</span><span class=p >,</span> <span class=mi >71</span><span class=p >),</span>
    <span class=p >(</span><span class=mi >72</span><span class=p >,</span> <span class=mi >75</span><span class=p >),</span>
    <span class=p >(</span><span class=mi >76</span><span class=p >,</span> <span class=mi >79</span><span class=p >),</span>
    <span class=p >(</span><span class=mi >80</span><span class=p >,</span> <span class=mi >85</span><span class=p >),</span>
<span class=p >]</span>

<span class=n >stations</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >read_fwf</span><span class=p >(</span>
    <span class=s2 >"ghcnd-stations.txt"</span><span class=p >,</span>
    <span class=n >colspecs</span><span class=o >=</span><span class=n >columns</span><span class=p >,</span>
    <span class=n >header</span><span class=o >=</span><span class=kc >None</span><span class=p >,</span>
    <span class=n >names</span><span class=o >=</span><span class=p >[</span>
        <span class=s2 >"ID"</span><span class=p >,</span>
        <span class=s2 >"LATITUDE"</span><span class=p >,</span>
        <span class=s2 >"LONGITUDE"</span><span class=p >,</span>
        <span class=s2 >"ELEVATION"</span><span class=p >,</span>
        <span class=s2 >"STATE"</span><span class=p >,</span>
        <span class=s2 >"NAME"</span><span class=p >,</span>
        <span class=s2 >"GSN FLAG"</span><span class=p >,</span>
        <span class=s2 >"HCN/CRN FLAG"</span><span class=p >,</span>
        <span class=s2 >"WMO ID"</span><span class=p >,</span>
    <span class=p >],</span>
<span class=p >)</span>
</pre></div> </div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[3]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >stations</span><span class=o >.</span><span class=n >head</span><span class=p >()</span>
<span class=n >stations</span> <span class=o >=</span> <span class=n >stations</span><span class=p >[</span>
    <span class=n >stations</span><span class=p >[</span><span class=s2 >"HCN/CRN FLAG"</span><span class=p >]</span><span class=o >.</span><span class=n >isin</span><span class=p >([</span><span class=s2 >"HCN"</span><span class=p >,</span> <span class=s2 >"CRN"</span><span class=p >])</span> <span class=o >|</span> <span class=n >stations</span><span class=p >[</span><span class=s2 >"GSN FLAG"</span><span class=p >]</span><span class=o >.</span><span class=n >isin</span><span class=p >([</span><span class=s2 >"GSN"</span><span class=p >])</span>
<span class=p >]</span>
</pre></div> </div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[4]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >stations</span><span class=o >.</span><span class=n >head</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[4]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>ID <th>LATITUDE <th>LONGITUDE <th>ELEVATION <th>STATE <th>NAME <th>GSN FLAG <th>HCN/CRN FLAG <th>WMO ID <tr> <th>2 <td>AE000041196 <td>25.3330 <td>55.5170 <td>34.0 <td>NaN <td>SHARJAH INTER. AIRP <td>GSN <td>NaN <td>41196.0 <tr> <th>6 <td>AF000040930 <td>35.3170 <td>69.0170 <td>3366.0 <td>NaN <td>NORTH-SALANG <td>GSN <td>NaN <td>40930.0 <tr> <th>10 <td>AG000060390 <td>36.7167 <td>3.2500 <td>24.0 <td>NaN <td>ALGER-DAR EL BEIDA <td>GSN <td>NaN <td>60390.0 <tr> <th>11 <td>AG000060590 <td>30.5667 <td>2.8667 <td>397.0 <td>NaN <td>EL-GOLEA <td>GSN <td>NaN <td>60590.0 <tr> <th>12 <td>AG000060611 <td>28.0500 <td>9.6331 <td>561.0 <td>NaN <td>IN-AMENAS <td>GSN <td>NaN <td>60611.0 </table> </div></div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[5]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >stations</span><span class=p >[</span><span class=n >stations</span><span class=p >[</span><span class=s2 >"ID"</span><span class=p >]</span><span class=o >.</span><span class=n >str</span><span class=o >.</span><span class=n >contains</span><span class=p >(</span><span class=s2 >"^IN"</span><span class=p >)]</span>  <span class=c1 ># Let's do one from  New Delhi</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[5]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>ID <th>LATITUDE <th>LONGITUDE <th>ELEVATION <th>STATE <th>NAME <th>GSN FLAG <th>HCN/CRN FLAG <th>WMO ID <tr> <th>35873 <td>IN001080500 <td>17.450 <td>78.470 <td>527.0 <td>NaN <td>BEGUMPET OBSY <td>GSN <td>NaN <td>43128.0 <tr> <th>36198 <td>IN003041800 <td>26.100 <td>91.583 <td>54.0 <td>NaN <td>GAUHATI <td>GSN <td>NaN <td>42410.0 <tr> <th>36402 <td>IN004091000 <td>24.050 <td>84.067 <td>221.0 <td>NaN <td>DALTONGANJ <td>GSN <td>NaN <td>42587.0 <tr> <th>36607 <td>IN005030100 <td>24.200 <td>72.200 <td>136.0 <td>NaN <td>DEESA <td>GSN <td>NaN <td>42539.0 <tr> <th>36670 <td>IN005090100 <td>22.367 <td>69.083 <td>11.0 <td>NaN <td>DWARKA <td>GSN <td>NaN <td>42731.0 <tr> <th>36917 <td>IN007101600 <td>31.100 <td>77.167 <td>2202.0 <td>NaN <td>SHIMLA <td>GSN <td>NaN <td>42083.0 <tr> <th>36926 <td>IN008010200 <td>34.083 <td>74.833 <td>1587.0 <td>NaN <td>SRINAGAR <td>GSN <td>NaN <td>42027.0 <tr> <th>36980 <td>IN009010100 <td>12.967 <td>77.583 <td>921.0 <td>NaN <td>BANGALORE <td>GSN <td>NaN <td>43295.0 <tr> <th>37477 <td>IN011020300 <td>19.083 <td>82.033 <td>553.0 <td>NaN <td>JAGDALPUR <td>GSN <td>NaN <td>43041.0 <tr> <th>37513 <td>IN011060800 <td>22.767 <td>81.900 <td>625.0 <td>NaN <td>PENDRA ROAD <td>GSN <td>NaN <td>42779.0 <tr> <th>37733 <td>IN011330900 <td>23.850 <td>78.750 <td>551.0 <td>NaN <td>SAGAR <td>GSN <td>NaN <td>42671.0 <tr> <th>38003 <td>IN012190100 <td>18.533 <td>73.850 <td>559.0 <td>NaN <td>POONA <td>GSN <td>NaN <td>43063.0 <tr> <th>38119 <td>IN014020800 <td>25.250 <td>91.733 <td>1313.0 <td>NaN <td>CHERRAPUNJI <td>GSN <td>NaN <td>42515.0 <tr> <th>38451 <td>IN019070100 <td>28.000 <td>73.300 <td>224.0 <td>NaN <td>BIKANER <td>GSN <td>NaN <td>42165.0 <tr> <th>38778 <td>IN020040900 <td>13.000 <td>80.183 <td>16.0 <td>NaN <td>MADRAS/MINAMBAKKAM <td>GSN <td>NaN <td>43279.0 <tr> <th>38847 <td>IN020081000 <td>10.233 <td>77.467 <td>2343.0 <td>NaN <td>KODAIKANAL <td>GSN <td>NaN <td>43339.0 <tr> <th>38879 <td>IN020100400 <td>9.267 <td>79.300 <td>11.0 <td>NaN <td>PAMBAN <td>GSN <td>NaN <td>43363.0 <tr> <th>39039 <td>IN022021900 <td>28.583 <td>77.200 <td>216.0 <td>NaN <td>NEW DELHI/SAFDARJUN <td>GSN <td>NaN <td>42182.0 <tr> <th>39414 <td>IN024050100 <td>27.050 <td>88.267 <td>2128.0 <td>NaN <td>DARJEELING <td>GSN <td>NaN <td>42295.0 <tr> <th>39503 <td>IN025010100 <td>8.300 <td>73.000 <td>2.0 <td>NaN <td>MINICOY OBSY <td>GSN <td>NaN <td>43369.0 <tr> <th>39512 <td>IN099999901 <td>11.667 <td>92.717 <td>79.0 <td>NaN <td>PORT BLAIR <td>GSN <td>NaN <td>43333.0 </table> </div></div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[6]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=c1 ># Let's do IN022021900. I used to live in Safdarjung Enclave in delhi!</span>
<span class=c1 ># IN007101600</span>

<span class=c1 ># and one from argentina</span>
<span class=n >stations</span><span class=p >[</span><span class=n >stations</span><span class=p >[</span><span class=s2 >"ID"</span><span class=p >]</span><span class=o >.</span><span class=n >str</span><span class=o >.</span><span class=n >contains</span><span class=p >(</span><span class=s2 >"^AR"</span><span class=p >)]</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[6]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>ID <th>LATITUDE <th>LONGITUDE <th>ELEVATION <th>STATE <th>NAME <th>GSN FLAG <th>HCN/CRN FLAG <th>WMO ID <tr> <th>261 <td>AR000087007 <td>-22.100 <td>-65.600 <td>3479.0 <td>NaN <td>LA QUIACA OBSERVATO <td>GSN <td>NaN <td>87007.0 <tr> <th>262 <td>AR000087065 <td>-24.167 <td>-62.900 <td>205.0 <td>NaN <td>RIVADAVIA <td>GSN <td>NaN <td>87065.0 <tr> <th>263 <td>AR000087078 <td>-24.700 <td>-60.583 <td>130.0 <td>NaN <td>LAS LOMITAS <td>GSN <td>NaN <td>87078.0 <tr> <th>265 <td>AR000087155 <td>-27.450 <td>-59.050 <td>53.0 <td>NaN <td>RESISTENCIA AERO <td>GSN <td>NaN <td>87155.0 <tr> <th>266 <td>AR000087217 <td>-29.383 <td>-66.817 <td>438.0 <td>NaN <td>LA RIOJA AERO. <td>GSN <td>NaN <td>87217.0 <tr> <th>267 <td>AR000087257 <td>-29.883 <td>-61.950 <td>88.0 <td>NaN <td>CERES AERO <td>GSN <td>NaN <td>87257.0 <tr> <th>268 <td>AR000087270 <td>-29.183 <td>-59.700 <td>53.0 <td>NaN <td>RECONQUISTA AERO <td>GSN <td>NaN <td>87270.0 <tr> <th>269 <td>AR000087344 <td>-31.317 <td>-64.217 <td>489.0 <td>NaN <td>CORDOBA AERO <td>GSN <td>NaN <td>87344.0 <tr> <th>270 <td>AR000087374 <td>-31.783 <td>-60.483 <td>74.0 <td>NaN <td>PARANA AERO <td>GSN <td>NaN <td>87374.0 <tr> <th>271 <td>AR000087418 <td>-32.833 <td>-68.783 <td>704.0 <td>NaN <td>MENDOZA AERO <td>GSN <td>NaN <td>87418.0 <tr> <th>272 <td>AR000087534 <td>-34.133 <td>-63.367 <td>137.0 <td>NaN <td>LABOULAYE AERO <td>GSN <td>NaN <td>87534.0 <tr> <th>273 <td>AR000087623 <td>-36.567 <td>-64.266 <td>192.0 <td>NaN <td>SANTA ROSA AERO <td>GSN <td>NaN <td>87623.0 <tr> <th>274 <td>AR000087692 <td>-37.933 <td>-57.583 <td>22.0 <td>NaN <td>MAR DEL PLATA AERO <td>GSN <td>NaN <td>87692.0 <tr> <th>275 <td>AR000087715 <td>-38.950 <td>-68.133 <td>273.0 <td>NaN <td>NEUQUEN AERO <td>GSN <td>NaN <td>87715.0 <tr> <th>276 <td>AR000087803 <td>-42.933 <td>-71.150 <td>799.0 <td>NaN <td>ESQUEL AERO <td>GSN <td>NaN <td>87803.0 <tr> <th>277 <td>AR000087828 <td>-43.200 <td>-65.266 <td>43.0 <td>NaN <td>TRELEW AERO <td>GSN <td>NaN <td>87828.0 <tr> <th>278 <td>AR000087860 <td>-45.783 <td>-67.500 <td>58.0 <td>NaN <td>COMODORO RIVADAVIA <td>GSN <td>NaN <td>87860.0 <tr> <th>279 <td>AR000087925 <td>-51.617 <td>-69.283 <td>19.0 <td>NaN <td>RIO GALLEGOS AERO <td>GSN <td>NaN <td>87925.0 <tr> <th>280 <td>AR000870470 <td>-24.850 <td>-65.483 <td>1246.0 <td>NaN <td>SALTA AERO <td>GSN <td>NaN <td>87047.0 <tr> <th>281 <td>AR000873050 <td>-30.250 <td>-68.750 <td>1175.0 <td>NaN <td>JACHAL <td>GSN <td>NaN <td>87305.0 <tr> <th>282 <td>AR000875440 <td>-35.867 <td>-61.900 <td>85.0 <td>NaN <td>PEHUAJO AERO <td>GSN <td>NaN <td>87544.0 <tr> <th>284 <td>AR000877500 <td>-38.733 <td>-62.167 <td>75.0 <td>NaN <td>BAHIA BLANCA AERO <td>GSN <td>NaN <td>87750.0 <tr> <th>292 <td>ARM00087178 <td>-27.386 <td>-55.971 <td>131.1 <td>NaN <td>POSADAS <td>GSN <td>NaN <td>87178.0 <tr> <th>296 <td>ARM00087289 <td>-29.689 <td>-57.152 <td>70.1 <td>NaN <td>PASO DE LOS LIBRES <td>GSN <td>NaN <td>87289.0 <tr> <th>311 <td>ARM00087497 <td>-33.010 <td>-58.613 <td>22.9 <td>NaN <td>GUALEGUAYCHU <td>GSN <td>NaN <td>87497.0 <tr> <th>312 <td>ARM00087506 <td>-35.494 <td>-69.574 <td>1430.1 <td>NaN <td>MALARGUE <td>GSN <td>NaN <td>87506.0 <tr> <th>320 <td>ARM00087593 <td>-34.972 <td>-57.895 <td>21.9 <td>NaN <td>LA PLATA <td>GSN <td>NaN <td>87593.0 </table> </div></div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[7]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=c1 ># ARM00087593 (I also briefly lived in La Plata!)</span>
<span class=c1 ># AR000087007</span>
</pre></div> </div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[8]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >stations</span><span class=p >[</span><span class=n >stations</span><span class=p >[</span><span class=s2 >"ID"</span><span class=p >]</span> <span class=o >==</span> <span class=s2 >"USC00050848"</span><span class=p >]</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[8]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>ID <th>LATITUDE <th>LONGITUDE <th>ELEVATION <th>STATE <th>NAME <th>GSN FLAG <th>HCN/CRN FLAG <th>WMO ID <tr> <th>89825 <td>USC00050848 <td>39.9919 <td>-105.2667 <td>1671.5 <td>CO <td>BOULDER <td>NaN <td>HCN <td>NaN </table> </div></div> </div> <p><strong>(3)</strong> Now that we something about the observations we want to work with, we can now turn to our actual weather data.</p> <p>Our daily weather can be found in <code class="docutils literal notranslate"><span class=pre >ghcnd_daily.csv</span></code>, which you get by unzipping <code class="docutils literal notranslate"><span class=pre >ghcnd_daily.tar.gz</span></code>. Note that the README.txt talks about this being a fixed-width file. Since you’ve already dealt with one fixed-width file, I’ve just converted this to a CSV, and dropped all the data that isn’t “daily max temperatures”.</p> <p>Let’s start with the fun part. <strong>SAVE YOUR NOTEBOOK AND ANY OTHER OPEN FILES!</strong>. Then just try and import the data (<code class="docutils literal notranslate"><span class=pre >ghcnd_daily.csv</span></code>) while watching your Activity Monitor (Mac) or Resource Monitor (Windows) to see what happens.</p> <p>If you have 8GB of RAM, this should fail miserably.</p> <p>If you have 16GB of RAM, you might just get away with this. But if it <em>does</em> load, try sorting the data by year and see how things go.</p> <p>(If you have 32GB of RAM: you’re actually probably fine with data this size. Sorry – datasets big enough to cause big problems for people with 32GB take a long time to chunk on an 8GB computer, and these exercises have to be fast enough to finish in a class period! There are some exercises at the bottom with a REALLY big dataset you can work with.)</p> <p>You may have to kill your kernel, kill Jupyter Lab, and start over when this explodes…</p> <p><strong>(4)</strong> Now that we know that we can’t work with this directly, it’s good with these big datasets to just import ~200 lines so you can get a feel for the data. So load <em>just 200 lines</em> of <code class="docutils literal notranslate"><span class=pre >ghcnd_daily.csv</span></code>.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[9]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >df</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >read_csv</span><span class=p >(</span><span class=s2 >"/users/nick/downloads/global_climate_data/ghcnd_daily.csv"</span><span class=p >,</span> <span class=n >nrows</span><span class=o >=</span><span class=mi >100</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[10]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >df</span><span class=o >.</span><span class=n >head</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[10]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>id <th>year <th>month <th>element <th>value1 <th>mflag1 <th>qflag1 <th>sflag1 <th>value2 <th>mflag2 <th>... <th>qflag29 <th>sflag29 <th>value30 <th>mflag30 <th>qflag30 <th>sflag30 <th>value31 <th>mflag31 <th>qflag31 <th>sflag31 <tr> <th>0 <td>ACW00011604 <td>1949 <td>1 <td>TMAX <td>289 <td>NaN <td>NaN <td>X <td>289 <td>NaN <td>... <td>NaN <td>X <td>272 <td>NaN <td>NaN <td>X <td>272 <td>NaN <td>NaN <td>X <tr> <th>1 <td>ACW00011604 <td>1949 <td>2 <td>TMAX <td>267 <td>NaN <td>NaN <td>X <td>278 <td>NaN <td>... <td>NaN <td>NaN <td>-9999 <td>NaN <td>NaN <td>NaN <td>-9999 <td>NaN <td>NaN <td>NaN <tr> <th>2 <td>ACW00011604 <td>1949 <td>3 <td>TMAX <td>272 <td>NaN <td>NaN <td>X <td>289 <td>NaN <td>... <td>NaN <td>X <td>278 <td>NaN <td>NaN <td>X <td>267 <td>NaN <td>NaN <td>X <tr> <th>3 <td>ACW00011604 <td>1949 <td>4 <td>TMAX <td>278 <td>NaN <td>NaN <td>X <td>283 <td>NaN <td>... <td>NaN <td>X <td>289 <td>NaN <td>NaN <td>X <td>-9999 <td>NaN <td>NaN <td>NaN <tr> <th>4 <td>ACW00011604 <td>1949 <td>5 <td>TMAX <td>283 <td>NaN <td>NaN <td>X <td>283 <td>NaN <td>... <td>NaN <td>X <td>294 <td>NaN <td>NaN <td>X <td>300 <td>NaN <td>NaN <td>X </table> <p>5 rows × 128 columns</p> </div></div> </div> <p><strong>(5)</strong> Once you have a sense of the data, write code to chunk your data: i.e. code that reads in all blocks of the data that will fit in ram, keeps only the observations for the weather stations you’ve selected to focus on, and throws away everything else.</p> <p>In addition to your own 4 weather stations, please also include station USC00050848 (a weather station from near my home!) so you can generate results that we can all compare (to check for accuracy).</p> <p>Note you will probably have to play with your chunk sizes (probably while watching your RAM usage?) to find a chunk size that’s big enough you aren’t running chunks all day, but small enough you can work with it.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[14]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >my_stations</span> <span class=o >=</span> <span class=p >[</span>
    <span class=s2 >"USC00050848"</span><span class=p >,</span>
    <span class=s2 >"IN007101600"</span><span class=p >,</span>
    <span class=s2 >"IN022021900"</span><span class=p >,</span>
    <span class=s2 >"ARM00087593"</span><span class=p >,</span>
    <span class=s2 >"AR000087007"</span><span class=p >,</span>
<span class=p >]</span>

<span class=c1 ># Setup chunking load</span>
<span class=n >df_full</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >read_csv</span><span class=p >(</span>
    <span class=s2 >"/users/nick/dropbox/MIDS_Data_Prep/ClimateData/ghcnd_daily.csv"</span><span class=p >,</span>
    <span class=n >iterator</span><span class=o >=</span><span class=kc >True</span><span class=p >,</span>
    <span class=n >chunksize</span><span class=o >=</span><span class=mi >5_000_000</span><span class=p >,</span>
<span class=p >)</span>
</pre></div> </div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[15]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=c1 ># OK,small enough for me, but not ridiculously small.</span>
<span class=n >keeping</span> <span class=o >=</span> <span class=nb >list</span><span class=p >()</span>
<span class=k >for</span> <span class=n >idx</span><span class=p >,</span> <span class=n >d</span> <span class=ow >in</span> <span class=nb >enumerate</span><span class=p >(</span><span class=n >df_full</span><span class=p >):</span>
    <span class=nb >print</span><span class=p >(</span><span class=sa >f</span><span class=s2 >"starting chunk </span><span class=si >{</span><span class=n >idx</span><span class=si >}</span><span class=s2 >"</span><span class=p >)</span>

    <span class=n >d</span> <span class=o >=</span> <span class=n >d</span><span class=p >[</span><span class=n >d</span><span class=p >[</span><span class=s2 >"id"</span><span class=p >]</span><span class=o >.</span><span class=n >isin</span><span class=p >(</span><span class=n >my_stations</span><span class=p >)]</span>
    <span class=n >keeping</span><span class=o >.</span><span class=n >append</span><span class=p >(</span><span class=n >d</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area stderr docutils container"> <div class=highlight ><pre>
/Users/Nick/opt/miniconda3/lib/python3.9/site-packages/IPython/core/interactiveshell.py:3364: DtypeWarning: Columns (6,10,14,18,22,26,30,34,38,42,46,50,54,58,62,66,70,74,78,82,86,90,94,98,102,106,110,114,118,122,126) have mixed types.Specify dtype option on import or set low_memory=False.
  if (await self.run_code(code, result,  async_=asy)):
</pre></div></div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
starting chunk 0
</pre></div></div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area stderr docutils container"> <div class=highlight ><pre>
/Users/Nick/opt/miniconda3/lib/python3.9/site-packages/IPython/core/interactiveshell.py:3364: DtypeWarning: Columns (6,7,10,11,14,15,18,19,22,23,26,27,30,31,34,35,38,39,42,43,46,47,50,51,54,55,58,59,62,63,66,67,70,71,74,75,78,79,82,83,86,87,90,91,94,95,98,99,102,103,106,107,110,111,114,115,118,119,122,123,126,127) have mixed types.Specify dtype option on import or set low_memory=False.
  if (await self.run_code(code, result,  async_=asy)):
</pre></div></div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
starting chunk 1
</pre></div></div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area stderr docutils container"> <div class=highlight ><pre>
/Users/Nick/opt/miniconda3/lib/python3.9/site-packages/IPython/core/interactiveshell.py:3364: DtypeWarning: Columns (5,6,7,9,10,11,13,14,15,17,18,19,21,22,23,25,26,27,29,30,31,33,34,35,37,38,39,41,42,43,45,46,47,49,50,51,53,54,55,57,58,59,61,62,63,65,66,67,69,70,71,73,74,75,77,78,79,81,82,83,85,86,87,89,90,91,93,94,95,97,98,99,101,102,103,105,106,107,109,110,111,113,114,115,117,118,119,121,122,123,125,126,127) have mixed types.Specify dtype option on import or set low_memory=False.
  if (await self.run_code(code, result,  async_=asy)):
</pre></div></div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
starting chunk 2
</pre></div></div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[16]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >weather_data</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >concat</span><span class=p >(</span><span class=n >keeping</span><span class=p >)</span>
<span class=k >del</span> <span class=n >keeping</span>
</pre></div> </div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[17]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >weather_data</span><span class=o >.</span><span class=n >head</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[17]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>id <th>year <th>month <th>element <th>value1 <th>mflag1 <th>qflag1 <th>sflag1 <th>value2 <th>mflag2 <th>... <th>qflag29 <th>sflag29 <th>value30 <th>mflag30 <th>qflag30 <th>sflag30 <th>value31 <th>mflag31 <th>qflag31 <th>sflag31 <tr> <th>58411 <td>AR000087007 <td>1956 <td>4 <td>TMAX <td>230 <td>NaN <td>NaN <td>G <td>242 <td>NaN <td>... <td>NaN <td>G <td>171 <td>NaN <td>NaN <td>G <td>-9999 <td>NaN <td>NaN <td>NaN <tr> <th>58412 <td>AR000087007 <td>1956 <td>5 <td>TMAX <td>180 <td>NaN <td>NaN <td>G <td>172 <td>NaN <td>... <td>NaN <td>G <td>138 <td>NaN <td>NaN <td>G <td>148 <td>NaN <td>NaN <td>G <tr> <th>58413 <td>AR000087007 <td>1956 <td>6 <td>TMAX <td>156 <td>NaN <td>NaN <td>G <td>136 <td>NaN <td>... <td>NaN <td>G <td>138 <td>NaN <td>NaN <td>G <td>-9999 <td>NaN <td>NaN <td>NaN <tr> <th>58414 <td>AR000087007 <td>1956 <td>7 <td>TMAX <td>132 <td>NaN <td>NaN <td>G <td>136 <td>NaN <td>... <td>NaN <td>G <td>128 <td>NaN <td>NaN <td>G <td>128 <td>NaN <td>NaN <td>G <tr> <th>58415 <td>AR000087007 <td>1956 <td>8 <td>TMAX <td>138 <td>NaN <td>NaN <td>G <td>138 <td>NaN <td>... <td>NaN <td>G <td>158 <td>NaN <td>NaN <td>G <td>164 <td>NaN <td>NaN <td>G </table> <p>5 rows × 128 columns</p> </div></div> </div> <p><strong>(6)</strong> Now, for each weather station, figure out the <em>earliest</em> year with data. Keep <code class="docutils literal notranslate"><span class=pre >USC00050848</span></code> and the two of the three weather stations you picked with the best data (i.e., you should have 3 total, two you picked and <code class="docutils literal notranslate"><span class=pre >USC00050848</span></code>).</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[18]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=k >for</span> <span class=n >name</span> <span class=ow >in</span> <span class=n >weather_data</span><span class=o >.</span><span class=n >id</span><span class=o >.</span><span class=n >unique</span><span class=p >():</span>
    <span class=n >min_year</span> <span class=o >=</span> <span class=n >weather_data</span><span class=o >.</span><span class=n >loc</span><span class=p >[</span><span class=n >weather_data</span><span class=o >.</span><span class=n >id</span> <span class=o >==</span> <span class=n >name</span><span class=p >,</span> <span class=s2 >"year"</span><span class=p >]</span><span class=o >.</span><span class=n >min</span><span class=p >()</span>
    <span class=nb >print</span><span class=p >(</span><span class=sa >f</span><span class=s2 >" for </span><span class=si >{</span><span class=n >name</span><span class=si >}</span><span class=s2 >, earliest year is </span><span class=si >{</span><span class=n >min_year</span><span class=si >}</span><span class=s2 >"</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
 for AR000087007, earliest year is 1956
 for ARM00087593, earliest year is 1974
 for IN007101600, earliest year is 1973
 for IN022021900, earliest year is 1944
 for USC00050848, earliest year is 1893
</pre></div></div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[19]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >weather_data</span> <span class=o >=</span> <span class=n >weather_data</span><span class=p >[</span>
    <span class=n >weather_data</span><span class=o >.</span><span class=n >id</span><span class=o >.</span><span class=n >isin</span><span class=p >([</span><span class=s2 >"USC00050848"</span><span class=p >,</span> <span class=s2 >"IN022021900"</span><span class=p >,</span> <span class=s2 >"AR000087007"</span><span class=p >])</span>
<span class=p >]</span><span class=o >.</span><span class=n >copy</span><span class=p >()</span>
<span class=n >weather_data</span><span class=o >.</span><span class=n >head</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[19]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>id <th>year <th>month <th>element <th>value1 <th>mflag1 <th>qflag1 <th>sflag1 <th>value2 <th>mflag2 <th>... <th>qflag29 <th>sflag29 <th>value30 <th>mflag30 <th>qflag30 <th>sflag30 <th>value31 <th>mflag31 <th>qflag31 <th>sflag31 <tr> <th>58411 <td>AR000087007 <td>1956 <td>4 <td>TMAX <td>230 <td>NaN <td>NaN <td>G <td>242 <td>NaN <td>... <td>NaN <td>G <td>171 <td>NaN <td>NaN <td>G <td>-9999 <td>NaN <td>NaN <td>NaN <tr> <th>58412 <td>AR000087007 <td>1956 <td>5 <td>TMAX <td>180 <td>NaN <td>NaN <td>G <td>172 <td>NaN <td>... <td>NaN <td>G <td>138 <td>NaN <td>NaN <td>G <td>148 <td>NaN <td>NaN <td>G <tr> <th>58413 <td>AR000087007 <td>1956 <td>6 <td>TMAX <td>156 <td>NaN <td>NaN <td>G <td>136 <td>NaN <td>... <td>NaN <td>G <td>138 <td>NaN <td>NaN <td>G <td>-9999 <td>NaN <td>NaN <td>NaN <tr> <th>58414 <td>AR000087007 <td>1956 <td>7 <td>TMAX <td>132 <td>NaN <td>NaN <td>G <td>136 <td>NaN <td>... <td>NaN <td>G <td>128 <td>NaN <td>NaN <td>G <td>128 <td>NaN <td>NaN <td>G <tr> <th>58415 <td>AR000087007 <td>1956 <td>8 <td>TMAX <td>138 <td>NaN <td>NaN <td>G <td>138 <td>NaN <td>... <td>NaN <td>G <td>158 <td>NaN <td>NaN <td>G <td>164 <td>NaN <td>NaN <td>G </table> <p>5 rows × 128 columns</p> </div></div> </div> <p><strong>(7)</strong> Now calculate the average max temp for each weather station / month in the data. Note that in a few weeks, we’ll have the skills to do this by reshaping our data so each row is a single day, rather than a month. But for the moment, just sum the columns, watching out for weird values.</p> <p>To sum across the value columns, we can combine:</p> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=n >weather_data</span><span class=o >.</span><span class=n >filter</span><span class=p >(</span><span class=n >like</span><span class=o >=</span><span class=s1 >'value'</span><span class=p >)</span>
</pre></div> </div> <p>(to just get the columns whose names start with “value”) with <code class="docutils literal notranslate"><span class=pre >.mean(axis='columns')</span></code> (which averages across columns (along rows) rather than the usual averaging across rows (along columns).</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[20]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >weather_data</span><span class=p >[</span><span class=s2 >"value1"</span><span class=p >]</span><span class=o >.</span><span class=n >value_counts</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[20]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
-9999    150
 189      39
 300      39
 200      39
 128      38
        ...
 412       1
 248       1
 362       1
 345       1
-133       1
Name: value1, Length: 336, dtype: int64
</pre></div></div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[21]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=c1 ># First get rid of garbarge entries.</span>
<span class=kn >import</span> <span class=nn >numpy</span> <span class=k >as</span> <span class=nn >np</span>

<span class=k >for</span> <span class=n >i</span> <span class=ow >in</span> <span class=nb >range</span><span class=p >(</span><span class=mi >1</span><span class=p >,</span> <span class=mi >32</span><span class=p >):</span>
    <span class=n >weather_data</span><span class=p >[</span><span class=sa >f</span><span class=s2 >"value</span><span class=si >{</span><span class=n >i</span><span class=si >}</span><span class=s2 >"</span><span class=p >]</span> <span class=o >=</span> <span class=n >weather_data</span><span class=p >[</span><span class=sa >f</span><span class=s2 >"value</span><span class=si >{</span><span class=n >i</span><span class=si >}</span><span class=s2 >"</span><span class=p >]</span><span class=o >.</span><span class=n >replace</span><span class=p >(</span><span class=o >-</span><span class=mi >9999</span><span class=p >,</span> <span class=n >np</span><span class=o >.</span><span class=n >nan</span><span class=p >)</span>

<span class=n >weather_data</span><span class=p >[</span><span class=s2 >"avg"</span><span class=p >]</span> <span class=o >=</span> <span class=n >weather_data</span><span class=o >.</span><span class=n >filter</span><span class=p >(</span><span class=n >like</span><span class=o >=</span><span class=s2 >"value"</span><span class=p >)</span><span class=o >.</span><span class=n >mean</span><span class=p >(</span><span class=n >axis</span><span class=o >=</span><span class=s2 >"columns"</span><span class=p >)</span>
<span class=n >weather_data</span><span class=p >[</span><span class=s2 >"avg_C"</span><span class=p >]</span> <span class=o >=</span> <span class=n >weather_data</span><span class=p >[</span><span class=s2 >"avg"</span><span class=p >]</span> <span class=o >/</span> <span class=mi >10</span>
</pre></div> </div> </div> <p><strong>(6)</strong> Now for each weather station, generate a separate plot of the daily temperatures over time. You should end up with a plot that looks something like this:</p> <img alt=temp_plots_Colorado  src="images/temp_plots_Boulder_CO.png"/> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[22]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >from</span> <span class=nn >plotnine</span> <span class=kn >import</span> <span class=o >*</span>

<span class=n >weather_data</span><span class=p >[</span><span class=s2 >"date"</span><span class=p >]</span> <span class=o >=</span> <span class=n >weather_data</span><span class=p >[</span><span class=s2 >"year"</span><span class=p >]</span> <span class=o >+</span> <span class=p >(</span><span class=n >weather_data</span><span class=p >[</span><span class=s2 >"month"</span><span class=p >]</span> <span class=o >-</span> <span class=mi >1</span><span class=p >)</span> <span class=o >/</span> <span class=mi >12</span>

<span class=n >names</span> <span class=o >=</span> <span class=p >{</span>
    <span class=s2 >"USC00050848"</span><span class=p >:</span> <span class=s2 >"Boulder, CO"</span><span class=p >,</span>
    <span class=s2 >"IN022021900"</span><span class=p >:</span> <span class=s2 >"Safdarjung, New Delhi, India"</span><span class=p >,</span>
    <span class=s2 >"AR000087007"</span><span class=p >:</span> <span class=s2 >"Jujuy, Argentina"</span><span class=p >,</span>
<span class=p >}</span>

<span class=k >for</span> <span class=n >station</span> <span class=ow >in</span> <span class=n >weather_data</span><span class=o >.</span><span class=n >id</span><span class=o >.</span><span class=n >unique</span><span class=p >():</span>
    <span class=n >g</span> <span class=o >=</span> <span class=p >(</span>
        <span class=n >ggplot</span><span class=p >(</span><span class=n >weather_data</span><span class=p >[</span><span class=n >weather_data</span><span class=o >.</span><span class=n >id</span> <span class=o >==</span> <span class=n >station</span><span class=p >],</span> <span class=n >aes</span><span class=p >(</span><span class=n >x</span><span class=o >=</span><span class=s2 >"date"</span><span class=p >,</span> <span class=n >y</span><span class=o >=</span><span class=s2 >"avg_C"</span><span class=p >))</span>
        <span class=o >+</span> <span class=n >geom_line</span><span class=p >()</span>
        <span class=o >+</span> <span class=n >geom_smooth</span><span class=p >(</span><span class=n >method</span><span class=o >=</span><span class=s2 >"lm"</span><span class=p >,</span> <span class=n >color</span><span class=o >=</span><span class=s2 >"red"</span><span class=p >)</span>
        <span class=o >+</span> <span class=n >labs</span><span class=p >(</span>
            <span class=n >title</span><span class=o >=</span><span class=sa >f</span><span class=s2 >"Monthly Avg of Daily High Temps, </span><span class=si >{</span><span class=n >names</span><span class=p >[</span><span class=n >station</span><span class=p >]</span><span class=si >}</span><span class=s2 >"</span><span class=p >,</span>
            <span class=n >x</span><span class=o >=</span><span class=s2 >"Year"</span><span class=p >,</span>
            <span class=n >y</span><span class=o >=</span><span class=s2 >"Monthly Average of Daily High in Centigrade"</span><span class=p >,</span>
        <span class=p >)</span>
    <span class=p >)</span>
    <span class=n >name_no_comma</span> <span class=o >=</span> <span class=n >names</span><span class=p >[</span><span class=n >station</span><span class=p >]</span><span class=o >.</span><span class=n >replace</span><span class=p >(</span><span class=s2 >", "</span><span class=p >,</span> <span class=s2 >"_"</span><span class=p >)</span><span class=o >.</span><span class=n >replace</span><span class=p >(</span><span class=s2 >" "</span><span class=p >,</span> <span class=s2 >"_"</span><span class=p >)</span>
    <span class=nb >print</span><span class=p >(</span><span class=n >name_no_comma</span><span class=p >)</span>
    <span class=n >g</span><span class=o >.</span><span class=n >save</span><span class=p >(</span>
        <span class=sa >f</span><span class=s2 >"/users/nick/github/practicaldatascience/source/images/temp_plots_</span><span class=si >{</span><span class=n >name_no_comma</span><span class=si >}</span><span class=s2 >.png"</span>
    <span class=p >)</span>
    <span class=nb >print</span><span class=p >(</span><span class=n >g</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Jujuy_Argentina
</pre></div></div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area stderr docutils container"> <div class=highlight ><pre>
/Users/Nick/opt/miniconda3/lib/python3.9/site-packages/plotnine/ggplot.py:719: PlotnineWarning: Saving 6.4 x 4.8 in image.
/Users/Nick/opt/miniconda3/lib/python3.9/site-packages/plotnine/ggplot.py:722: PlotnineWarning: Filename: /users/nick/github/practicaldatascience/source/images/temp_plots_Jujuy_Argentina.png
</pre></div></div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <img alt="../_images/exercises_Solutions_bigdata_27_2.png" src="../_images/exercises_Solutions_bigdata_27_2.png"/> </div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>

Safdarjung_New_Delhi_India
</pre></div></div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area stderr docutils container"> <div class=highlight ><pre>
/Users/Nick/opt/miniconda3/lib/python3.9/site-packages/plotnine/ggplot.py:719: PlotnineWarning: Saving 6.4 x 4.8 in image.
/Users/Nick/opt/miniconda3/lib/python3.9/site-packages/plotnine/ggplot.py:722: PlotnineWarning: Filename: /users/nick/github/practicaldatascience/source/images/temp_plots_Safdarjung_New_Delhi_India.png
</pre></div></div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <img alt="../_images/exercises_Solutions_bigdata_27_5.png" src="../_images/exercises_Solutions_bigdata_27_5.png"/> </div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>

Boulder_CO
</pre></div></div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area stderr docutils container"> <div class=highlight ><pre>
/Users/Nick/opt/miniconda3/lib/python3.9/site-packages/plotnine/ggplot.py:719: PlotnineWarning: Saving 6.4 x 4.8 in image.
/Users/Nick/opt/miniconda3/lib/python3.9/site-packages/plotnine/ggplot.py:722: PlotnineWarning: Filename: /users/nick/github/practicaldatascience/source/images/temp_plots_Boulder_CO.png
</pre></div></div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <img alt="../_images/exercises_Solutions_bigdata_27_8.png" src="../_images/exercises_Solutions_bigdata_27_8.png"/> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>

</pre></div></div> </div> <section id="Want-More-Practice?"> <h2 id="Want-More-Practice?">Want More Practice?<a class=headerlink  href="#Want-More-Practice?" title="Permalink to this headline">¶</a></h2> <p>If you <em>really</em> want a challenge, the file <code class="docutils literal notranslate"><span class=pre >ghcnd_daily_30gb.tar.gz</span></code> will decompress into <code class="docutils literal notranslate"><span class=pre >ghcnd_daily.dat</span></code>, the full version of the GHCND daily data. It contains not only daily high temps, but also daily low temps, preciptionation, etc. Moreover, it is still in fixed-width format, and is about 30gb in raw form.</p> <p>Importing and chunking this data (with moderate optimizations) took about 2 hours on my computer.</p> <p>If you’re up for it, it’s a great dataset to wrestling with data in weird formats and chunking.</p> <p><strong>Pro-tip:</strong> strings take up <em>way</em> more space in RAM than numbers, so some columns can be converted to keep the memory footprint of the data down.</p> </section> </section> </article> </div> </div> </main> </div> <footer class=md-footer > <div class=md-footer-nav > <nav class="md-footer-nav__inner md-grid"> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright > <div class=md-footer-copyright__highlight > &#169; Copyright 2021, Nick Eubank. </div> Created using <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.5.0. and <a href="https://github.com/bashtage/sphinx-material/">Material for Sphinx</a> </div> </div> </div> </footer> <script src="../_static/javascripts/application.js"></script> <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>