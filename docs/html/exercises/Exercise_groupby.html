<!DOCTYPE html> <meta charset=utf-8  /> <meta name=viewport  content="width=device-width, initial-scale=1.0" /><meta name=generator  content="Docutils 0.17.1: http://docutils.sourceforge.net/" /> <meta name=viewport  content="width=device-width,initial-scale=1"> <meta http-equiv=x-ua-compatible  content="ie=edge"> <meta name="lang:clipboard.copy" content="Copy to clipboard"> <meta name="lang:clipboard.copied" content="Copied to clipboard"> <meta name="lang:search.language" content=en > <meta name="lang:search.pipeline.stopwords" content=True > <meta name="lang:search.pipeline.trimmer" content=True > <meta name="lang:search.result.none" content="No matching documents"> <meta name="lang:search.result.one" content="1 matching document"> <meta name="lang:search.result.other" content="# matching documents"> <meta name="lang:search.tokenizer" content="[\s\-]+"> <link href="https://fonts.gstatic.com/" rel=preconnect  crossorigin> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel=stylesheet > <style> body, input { font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif } code, kbd, pre { font-family: "Roboto Mono", "Courier New", Courier, monospace } </style> <link rel=stylesheet  href="../_static/stylesheets/application.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-palette.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-fixes.css"/> <link rel=stylesheet  href="../_static/fonts/material-icons.css"/> <meta name=theme-color  content="#2196f3"> <script src="../_static/javascripts/modernizr.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-XX133829453-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-XX133829453-1'); </script> <title>Groupby and Arrest Data &#8212; Practical Data Science</title> <link rel=stylesheet  type="text/css" href="../_static/pygments.css" /> <link rel=stylesheet  type="text/css" href="../_static/material.css" /> <script data-url_root="../" id=documentation_options  src="../_static/documentation_options.js"></script> <script src="../_static/jquery.js"></script> <script src="../_static/underscore.js"></script> <script src="../_static/doctools.js"></script> <script crossorigin=anonymous  integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script> <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script> <script defer=defer  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <link rel="shortcut icon" href="../_static/mids_logo.svg"/> <link rel=index  title=Index  href="../genindex.html" /> <link rel=search  title=Search  href="../search.html" /> <body dir=ltr data-md-color-primary=blue-grey data-md-color-accent=blue> <svg class=md-svg > <defs data-children-count=0 > <svg xmlns="http://www.w3.org/2000/svg" width=416  height=448  viewBox="0 0 416 448" id=__github ><path fill=currentColor  d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle  data-md-toggle=drawer  type=checkbox  id=__drawer > <input class=md-toggle  data-md-toggle=search  type=checkbox  id=__search > <label class=md-overlay  data-md-component=overlay  for=__drawer ></label> <a href="#exercises/Exercise_groupby" tabindex=1  class=md-skip > Skip to content </a> <header class=md-header  data-md-component=header > <nav class="md-header-nav md-grid"> <div class="md-flex navheader"> <div class="md-flex__cell md-flex__cell--shrink"> <a href="../index.html" title="Practical Data Science" class="md-header-nav__button md-logo"> <img src="../_static/mids_logo.svg" height=26  alt="Practical Data Science logo"> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer ></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title > <span class=md-header-nav__topic >Practical Data Science</span> <span class=md-header-nav__topic > Groupby and Arrest Data </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search ></label> <div class=md-search  data-md-component=search  role=dialog > <label class=md-search__overlay  for=__search ></label> <div class=md-search__inner  role=search > <form class=md-search__form  action="../search.html" method=get  name=search > <input type=text  class=md-search__input  name=q  placeholder=""Search"" autocapitalize=off  autocomplete=off  spellcheck=false  data-md-component=query  data-md-state=active > <label class="md-icon md-search__icon" for=__search ></label> <button type=reset  class="md-icon md-search__icon" data-md-component=reset  tabindex=-1 > &#xE5CD; </button> </form> <div class=md-search__output > <div class=md-search__scrollwrap  data-md-scrollfix> <div class=md-search-result  data-md-component=result > <div class=md-search-result__meta > Type to start searching </div> <ol class=md-search-result__list ></ol> </div> </div> </div> </div> </div> </div> <script src="../_static/javascripts/version_dropdown.js"></script> <script> var json_loc = "../"versions.json"", target_loc = "../../", text = "Versions"; $( document ).ready( add_version_dropdown(json_loc, target_loc, text)); </script> </div> </nav> </header> <div class=md-container > <nav class=md-tabs  data-md-component=tabs > <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list > <li class=md-tabs__item ><a href="../index.html" class=md-tabs__link >Home</a> <li class=md-tabs__item ><a href="../class_schedule.html" class=md-tabs__link >Class Schedule</a> <li class=md-tabs__item ><a href="../topic_list.html" class=md-tabs__link >Topic List</a> <li class=md-tabs__item ><a href="https://www.nickeubank.com" class=md-tabs__link >About The Author</a> </ul> </div> </nav> <main class=md-main > <div class="md-main__inner md-grid" data-md-component=container > <div class="md-sidebar md-sidebar--primary" data-md-component=navigation > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--primary" data-md-level=0 > <label class="md-nav__title md-nav__title--site" for=__drawer > <a href="../index.html" title="Practical Data Science" class="md-nav__button md-logo"> <img src="../_static/mids_logo.svg" alt=" logo" width=48  height=48 > </a> <a href="../index.html" title="Practical Data Science">Practical Data Science</a> </label> <ul class=md-nav__list > <li class=md-nav__item > <a href="../class_schedule.html" class=md-nav__link >Class Schedule</a> <li class=md-nav__item > <a href="../autograder_guidelines.html" class=md-nav__link >Autograder Guidelines</a> <li class=md-nav__item > <a href="../not_a_mids_student.html" class=md-nav__link >Not a MIDS Student?</a> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >"Contents"</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#exercises-exercise-groupby--page-root" class=md-nav__link >Groupby and Arrest Data</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Gradescope-Autograding" class=md-nav__link >Gradescope Autograding</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Submission-Limits" class=md-nav__link >Submission Limits</a> <li class=md-nav__item ><a href="#Exercise-1" class=md-nav__link >Exercise 1</a> </ul> </nav> <li class=md-nav__item ><a href="#Learning-the-Group-Structure-of-Your-Data" class=md-nav__link >Learning the Group Structure of Your Data</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exercise-2" class=md-nav__link >Exercise 2</a> <li class=md-nav__item ><a href="#Testing-Your-Assumptions" class=md-nav__link >Testing Your Assumptions</a> <li class=md-nav__item ><a href="#Testing-with-.duplicated()" class=md-nav__link >Testing with .duplicated()</a> <li class=md-nav__item ><a href="#Exercise-3" class=md-nav__link >Exercise 3</a> <li class=md-nav__item ><a href="#Exercise-4" class=md-nav__link >Exercise 4</a> <li class=md-nav__item ><a href="#Exercise-5" class=md-nav__link >Exercise 5</a> </ul> </nav> <li class=md-nav__item ><a href="#Racial-Arrest-Composition" class=md-nav__link >Racial Arrest Composition</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exercise-6" class=md-nav__link >Exercise 6</a> <li class=md-nav__item ><a href="#Exercise-7" class=md-nav__link >Exercise 7</a> <li class=md-nav__item ><a href="#Exercise-8" class=md-nav__link >Exercise 8</a> <li class=md-nav__item ><a href="#Exercise-9" class=md-nav__link >Exercise 9</a> <li class=md-nav__item ><a href="#Exercise-10" class=md-nav__link >Exercise 10</a> <li class=md-nav__item ><a href="#Exercise-11" class=md-nav__link >Exercise 11</a> <li class=md-nav__item ><a href="#Exercise-12" class=md-nav__link >Exercise 12</a> </ul> </nav> </ul> </nav> </ul> </nav> </div> </div> </div> <div class=md-content > <article class="md-content__inner md-typeset" role=main > <style> /* CSS for nbsphinx extension */ /* remove conflicting styling from Sphinx themes */ div.nbinput.container div.prompt *, div.nboutput.container div.prompt *, div.nbinput.container div.input_area pre, div.nboutput.container div.output_area pre, div.nbinput.container div.input_area .highlight, div.nboutput.container div.output_area .highlight { border: none; padding: 0; margin: 0; box-shadow: none; } div.nbinput.container > div[class*=highlight], div.nboutput.container > div[class*=highlight] { margin: 0; } div.nbinput.container div.prompt *, div.nboutput.container div.prompt * { background: none; } div.nboutput.container div.output_area .highlight, div.nboutput.container div.output_area pre { background: unset; } div.nboutput.container div.output_area div.highlight { color: unset; /* override Pygments text color */ } /* avoid gaps between output lines */ div.nboutput.container div[class*=highlight] pre { line-height: normal; } /* input/output containers */ div.nbinput.container, div.nboutput.container { display: -webkit-flex; display: flex; align-items: flex-start; margin: 0; width: 100%; } @media (max-width: 540px) { div.nbinput.container, div.nboutput.container { flex-direction: column; } } /* input container */ div.nbinput.container { padding-top: 5px; } /* last container */ div.nblast.container { padding-bottom: 5px; } /* input prompt */ div.nbinput.container div.prompt pre { color: #307FC1; } /* output prompt */ div.nboutput.container div.prompt pre { color: #BF5B3D; } /* all prompts */ div.nbinput.container div.prompt, div.nboutput.container div.prompt { width: 4.5ex; padding-top: 5px; position: relative; user-select: none; } div.nbinput.container div.prompt > div, div.nboutput.container div.prompt > div { position: absolute; right: 0; margin-right: 0.3ex; } @media (max-width: 540px) { div.nbinput.container div.prompt, div.nboutput.container div.prompt { width: unset; text-align: left; padding: 0.4em; } div.nboutput.container div.prompt.empty { padding: 0; } div.nbinput.container div.prompt > div, div.nboutput.container div.prompt > div { position: unset; } } /* disable scrollbars on prompts */ div.nbinput.container div.prompt pre, div.nboutput.container div.prompt pre { overflow: hidden; } /* input/output area */ div.nbinput.container div.input_area, div.nboutput.container div.output_area { -webkit-flex: 1; flex: 1; overflow: auto; } @media (max-width: 540px) { div.nbinput.container div.input_area, div.nboutput.container div.output_area { width: 100%; } } /* input area */ div.nbinput.container div.input_area { border: 1px solid #e0e0e0; border-radius: 2px; /*background: #f5f5f5;*/ } /* override MathJax center alignment in output cells */ div.nboutput.container div[class*=MathJax] { text-align: left !important; } /* override sphinx.ext.imgmath center alignment in output cells */ div.nboutput.container div.math p { text-align: left; } /* standard error */ div.nboutput.container div.output_area.stderr { background: #fdd; } /* ANSI colors */ .ansi-black-fg { color: #3E424D; } .ansi-black-bg { background-color: #3E424D; } .ansi-black-intense-fg { color: #282C36; } .ansi-black-intense-bg { background-color: #282C36; } .ansi-red-fg { color: #E75C58; } .ansi-red-bg { background-color: #E75C58; } .ansi-red-intense-fg { color: #B22B31; } .ansi-red-intense-bg { background-color: #B22B31; } .ansi-green-fg { color: #00A250; } .ansi-green-bg { background-color: #00A250; } .ansi-green-intense-fg { color: #007427; } .ansi-green-intense-bg { background-color: #007427; } .ansi-yellow-fg { color: #DDB62B; } .ansi-yellow-bg { background-color: #DDB62B; } .ansi-yellow-intense-fg { color: #B27D12; } .ansi-yellow-intense-bg { background-color: #B27D12; } .ansi-blue-fg { color: #208FFB; } .ansi-blue-bg { background-color: #208FFB; } .ansi-blue-intense-fg { color: #0065CA; } .ansi-blue-intense-bg { background-color: #0065CA; } .ansi-magenta-fg { color: #D160C4; } .ansi-magenta-bg { background-color: #D160C4; } .ansi-magenta-intense-fg { color: #A03196; } .ansi-magenta-intense-bg { background-color: #A03196; } .ansi-cyan-fg { color: #60C6C8; } .ansi-cyan-bg { background-color: #60C6C8; } .ansi-cyan-intense-fg { color: #258F8F; } .ansi-cyan-intense-bg { background-color: #258F8F; } .ansi-white-fg { color: #C5C1B4; } .ansi-white-bg { background-color: #C5C1B4; } .ansi-white-intense-fg { color: #A1A6B2; } .ansi-white-intense-bg { background-color: #A1A6B2; } .ansi-default-inverse-fg { color: #FFFFFF; } .ansi-default-inverse-bg { background-color: #000000; } .ansi-bold { font-weight: bold; } .ansi-underline { text-decoration: underline; } div.nbinput.container div.input_area div[class*=highlight] > pre, div.nboutput.container div.output_area div[class*=highlight] > pre, div.nboutput.container div.output_area div[class*=highlight].math, div.nboutput.container div.output_area.rendered_html, div.nboutput.container div.output_area > div.output_javascript, div.nboutput.container div.output_area:not(.rendered_html) > img{ padding: 5px; margin: 0; } /* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */ div.nbinput.container div.input_area > div[class^='highlight'], div.nboutput.container div.output_area > div[class^='highlight']{ overflow-y: hidden; } /* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */ .prompt .copybtn { display: none; } /* Some additional styling taken form the Jupyter notebook CSS */ .jp-RenderedHTMLCommon table, div.rendered_html table { border: none; border-collapse: collapse; border-spacing: 0; color: black; font-size: 12px; table-layout: fixed; } .jp-RenderedHTMLCommon thead, div.rendered_html thead { border-bottom: 1px solid black; vertical-align: bottom; } .jp-RenderedHTMLCommon tr, .jp-RenderedHTMLCommon th, .jp-RenderedHTMLCommon td, div.rendered_html tr, div.rendered_html th, div.rendered_html td { text-align: right; vertical-align: middle; padding: 0.5em 0.5em; line-height: normal; white-space: normal; max-width: none; border: none; } .jp-RenderedHTMLCommon th, div.rendered_html th { font-weight: bold; } .jp-RenderedHTMLCommon tbody tr:nth-child(odd), div.rendered_html tbody tr:nth-child(odd) { background: #f5f5f5; } .jp-RenderedHTMLCommon tbody tr:hover, div.rendered_html tbody tr:hover { background: rgba(66, 165, 245, 0.2); } </style> <section id=Groupby-and-Arrest-Data > <h1 id=exercises-exercise-groupby--page-root >Groupby and Arrest Data<a class=headerlink  href="#exercises-exercise-groupby--page-root" title="Permalink to this headline">¶</a></h1> <p>In our merging exercises, we examined the relationship between county-level violent arrest totals and county-level drug arrest totals. In those exercises, you were given a dataset that provided you with county-level arrest totals. But that’s not actually how the data is provided by the state of California. This week we will work with the <em>raw</em> California arrest data, which is not organized by county or even county-year.</p> <section id=Gradescope-Autograding > <h2 id=Gradescope-Autograding >Gradescope Autograding<a class=headerlink  href="#Gradescope-Autograding" title="Permalink to this headline">¶</a></h2> <p>Please follow <a class="reference external" href="https://www.practicaldatascience.org/html/autograder_guidelines.html">all standard guidance</a> for submitting this assignment to the Gradescope autograder, including storing your solutions in a dictionary called <code class="docutils literal notranslate"><span class=pre >results</span></code> and ensuring your notebook runs from the start to completion without any errors.</p> <p>For this assignment, please name your file <code class="docutils literal notranslate"><span class=pre >exercise_groupby.ipynb</span></code> before uploading.</p> <p>You can check that you have answers for all questions in your <code class="docutils literal notranslate"><span class=pre >results</span></code> dictionary with this code:</p> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=k >assert</span> <span class=nb >set</span><span class=p >(</span><span class=n >results</span><span class=o >.</span><span class=n >keys</span><span class=p >())</span> <span class=o >==</span> <span class=p >{</span>
    <span class=s2 >"ex4_num_rows"</span><span class=p >,</span>
    <span class=s2 >"ex5_collapsed_vars"</span><span class=p >,</span>
    <span class=s2 >"ex7_alameda_1980_share_violent_arrestees_black"</span><span class=p >,</span>
    <span class=s2 >"ex11_white_drug_share"</span><span class=p >,</span>
    <span class=s2 >"ex11_black_drug_share"</span><span class=p >,</span>
    <span class=s2 >"ex12_proportionate"</span><span class=p >,</span>
<span class=p >}</span>
</pre></div> </div> <section id=Submission-Limits > <h3 id=Submission-Limits >Submission Limits<a class=headerlink  href="#Submission-Limits" title="Permalink to this headline">¶</a></h3> <p>Please remember that you are <strong>only allowed three submissions to the autograder.</strong> Your last submission (if you submit 3 or fewer times), or your third submission (if you submit more than 3 times) will determine your grade Submissions that error out will <strong>not</strong> count against this total.</p> </section> <section id=Exercise-1 > <h3 id=Exercise-1 >Exercise 1<a class=headerlink  href="#Exercise-1" title="Permalink to this headline">¶</a></h3> <p>Import the raw California arrest data from the State Attorney General’s office. Please use <a class="reference external" href="https://github.com/nickeubank/MIDS_Data/blob/master/OnlineArrestData1980-2021.csv">this link</a> (the original is here <a class="reference external" href="https://openjustice.doj.ca.gov/data">here</a>, but they keep updating it and I get tired of updating solutions, so… please use my copy!)</p> </section> </section> <section id=Learning-the-Group-Structure-of-Your-Data > <h2 id=Learning-the-Group-Structure-of-Your-Data >Learning the Group Structure of Your Data<a class=headerlink  href="#Learning-the-Group-Structure-of-Your-Data" title="Permalink to this headline">¶</a></h2> <section id=Exercise-2 > <h3 id=Exercise-2 >Exercise 2<a class=headerlink  href="#Exercise-2" title="Permalink to this headline">¶</a></h3> <p>What is the unit of observation for this dataset? In other words, when row zero says that there were 505 arrests for <code class="docutils literal notranslate"><span class=pre >VIOLENT</span></code> crimes, what exactly is that telling you—505 arrests in 1980? 505 arrests in Alameda County?</p> <p>(Please answer in Markdown)</p> </section> <section id=Testing-Your-Assumptions > <h3 id=Testing-Your-Assumptions >Testing Your Assumptions<a class=headerlink  href="#Testing-Your-Assumptions" title="Permalink to this headline">¶</a></h3> <p>It’s important to be able to test whether the data you are working with really is organized the way you think it is, especially when working with groupby. Let’s discuss how to check your answer to Exercise 2 with the <code class="docutils literal notranslate"><span class=pre >.duplicated()</span></code> method.</p> <p>Consider the following toy data:</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[7]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >import</span> <span class=nn >pandas</span> <span class=k >as</span> <span class=nn >pd</span>

<span class=n >df</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >DataFrame</span><span class=p >(</span>
    <span class=p >{</span>
        <span class=s2 >"social_security_numbers"</span><span class=p >:</span> <span class=p >[</span>
            <span class=mi >111111111</span><span class=p >,</span>
            <span class=mi >222222222</span><span class=p >,</span>
            <span class=mi >222222222</span><span class=p >,</span>
            <span class=mi >333333333</span><span class=p >,</span>
            <span class=mi >333333333</span><span class=p >,</span>
        <span class=p >],</span>
        <span class=s2 >"second_column"</span><span class=p >:</span> <span class=p >[</span><span class=s2 >"a"</span><span class=p >,</span> <span class=s2 >"a"</span><span class=p >,</span> <span class=s2 >"a"</span><span class=p >,</span> <span class=s2 >"a"</span><span class=p >,</span> <span class=s2 >"b"</span><span class=p >],</span>
    <span class=p >}</span>
<span class=p >)</span>
<span class=n >df</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[7]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>social_security_numbers <th>second_column <tr> <th>0 <td>111111111 <td>a <tr> <th>1 <td>222222222 <td>a <tr> <th>2 <td>222222222 <td>a <tr> <th>3 <td>333333333 <td>a <tr> <th>4 <td>333333333 <td>b </table> </div></div> </div> <p>If we want to see if there are any duplicate rows in the dataset, we can use the <code class="docutils literal notranslate"><span class=pre >.duplicated()</span></code> method:</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[8]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >df</span><span class=o >.</span><span class=n >duplicated</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[8]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
0    False
1    False
2     True
3    False
4    False
dtype: bool
</pre></div></div> </div> <p>As you can see, <code class="docutils literal notranslate"><span class=pre >.duplicated()</span></code> looks at each row and returns <code class="docutils literal notranslate"><span class=pre >True</span></code> if it has seen the row it is looking at before.</p> <p>Notice that <code class="docutils literal notranslate"><span class=pre >.duplicted()</span></code> doesn’t return <code class="docutils literal notranslate"><span class=pre >True</span></code> for <em>all</em> rows that look the same as another row in the data—it treats the first instance of a row as unique, and only tags <em>subsequent</em> repetitions as “duplicates” (You can change this behavior with the <code class="docutils literal notranslate"><span class=pre >keep</span></code> keyword argument if you want).</p> <p><code class="docutils literal notranslate"><span class=pre >.duplicated()</span></code> can also be used to test for rows that are duplicates in terms of a sub-set of columns. For example, <code class="docutils literal notranslate"><span class=pre >df.duplicated(["social_security_numbers"])</span></code> identifies rows with duplicate values of the variable <code class="docutils literal notranslate"><span class=pre >social_security_numbers</span></code>:</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[9]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >df</span><span class=o >.</span><span class=n >duplicated</span><span class=p >([</span><span class=s2 >"social_security_numbers"</span><span class=p >])</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[9]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
0    False
1    False
2     True
3    False
4     True
dtype: bool
</pre></div></div> </div> <p>Since <code class="docutils literal notranslate"><span class=pre >duplicated</span></code> is now only looking at <code class="docutils literal notranslate"><span class=pre >social_security_numbers</span></code> (not all values in a row), the last row is now a duplicate (because <code class="docutils literal notranslate"><span class=pre >333333333</span></code> is duplicated), where when we considered all columns, it was not a duplicate.</p> </section> <section id="Testing-with-.duplicated()"> <h3 id="Testing-with-.duplicated()">Testing with .duplicated()<a class=headerlink  href="#Testing-with-.duplicated()" title="Permalink to this headline">¶</a></h3> <p><code class="docutils literal notranslate"><span class=pre >.duplicated()</span></code> can be paired with the <code class="docutils literal notranslate"><span class=pre >.any()</span></code> method to write <code class="docutils literal notranslate"><span class=pre >assert</span></code> tests to detect the presence of duplicates in our dataset and to validate our assumptions about whether certain variables uniquely identify observations in our data.</p> <p>When you run <code class="docutils literal notranslate"><span class=pre >.any()</span></code> on an array of Booleans, it returns a single value of <code class="docutils literal notranslate"><span class=pre >True</span></code> if <em>any</em> entries are <code class="docutils literal notranslate"><span class=pre >True</span></code>, and a single value of <code class="docutils literal notranslate"><span class=pre >False</span></code> if <em>no</em> entries are <code class="docutils literal notranslate"><span class=pre >True</span></code>. (You can also use <code class="docutils literal notranslate"><span class=pre >.all()</span></code> to test if all entries are <code class="docutils literal notranslate"><span class=pre >False</span></code>).</p> <p>Thus the command <code class="docutils literal notranslate"><span class=pre >df.duplicated(['social_security_numbers'])</span></code> will return <code class="docutils literal notranslate"><span class=pre >False</span></code> if <code class="docutils literal notranslate"><span class=pre >social_security_numbers</span></code> uniquely identifies every row in our dataset (since there are no duplicates)! But if there <em>are</em> any duplicates, it will return <code class="docutils literal notranslate"><span class=pre >True</span></code>:</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[10]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >df</span><span class=o >.</span><span class=n >duplicated</span><span class=p >([</span><span class=s2 >"social_security_numbers"</span><span class=p >])</span><span class=o >.</span><span class=n >any</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[10]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
True
</pre></div></div> </div> <p>So if I wanted a test that would raise an <code class="docutils literal notranslate"><span class=pre >Error</span></code> if it turned out that <code class="docutils literal notranslate"><span class=pre >social_security_numbers</span></code> <em>didn’t</em> uniquely identify observations, I would combine that code with <code class="docutils literal notranslate"><span class=pre >assert</span> <span class=pre >not</span></code>:</p> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=k >assert</span> <span class=ow >not</span> <span class=n >df</span><span class=o >.</span><span class=n >duplicated</span><span class=p >([</span><span class=s2 >"social_security_numbers"</span><span class=p >])</span><span class=o >.</span><span class=n >any</span><span class=p >()</span>

<span class=o >---------------------------------------------------------------------------</span>
<span class=ne >AssertionError</span>                            <span class=n >Traceback</span> <span class=p >(</span><span class=n >most</span> <span class=n >recent</span> <span class=n >call</span> <span class=n >last</span><span class=p >)</span>
<span class=n >Cell</span> <span class=n >In</span> <span class=p >[</span><span class=mi >20</span><span class=p >],</span> <span class=n >line</span> <span class=mi >1</span>
<span class=o >----&gt;</span> <span class=mi >1</span> <span class=k >assert</span> <span class=ow >not</span> <span class=n >df</span><span class=o >.</span><span class=n >duplicated</span><span class=p >([</span><span class=s2 >"social_security_numbers"</span><span class=p >])</span><span class=o >.</span><span class=n >any</span><span class=p >()</span>

<span class=ne >AssertionError</span><span class=p >:</span>
</pre></div> </div> <p>(which in this case raises an Error because <code class="docutils literal notranslate"><span class=pre >social_security_numbers</span></code> <em>isn’t</em> unique!)</p> <p>BTW, if this feels oddly familiar, that’s probably because we talked about this same idea when discussing merging. A <code class="docutils literal notranslate"><span class=pre >1:1</span></code> merge is one in which the merging variables uniquely identify observations in both datasets.</p> </section> <section id=Exercise-3 > <h3 id=Exercise-3 >Exercise 3<a class=headerlink  href="#Exercise-3" title="Permalink to this headline">¶</a></h3> <p>Use <code class="docutils literal notranslate"><span class=pre >duplicated</span></code> to test if the variables <em>you</em> think uniquely identify rows in your data really do uniquely identify rows. If you were wrong, update your beliefs (and your code) until you have an <code class="docutils literal notranslate"><span class=pre >assert</span></code> statement that passes.</p> </section> <section id=Exercise-4 > <h3 id=Exercise-4 >Exercise 4<a class=headerlink  href="#Exercise-4" title="Permalink to this headline">¶</a></h3> <p>Once you have a handle on how the data looks now, please <strong>collapse the data</strong> to be one observation per county-year-racial group. Store the number of rows in the resulting dataframe in your <code class="docutils literal notranslate"><span class=pre >results</span></code> dictionary under the key <code class="docutils literal notranslate"><span class=pre >"ex4_num_rows"</span></code>.</p> <p><strong>Hint:</strong> Think carefully about the most appropriate <em>aggregation function</em> (e.g., mean, median, sum, count) given the data we’re working with!</p> <p><strong>Hint 2:</strong> When using <code class="docutils literal notranslate"><span class=pre >groupby</span></code>, I am a HUGE fan of the <code class="docutils literal notranslate"><span class=pre >as_index=False</span></code> keyword argument (e.g., <code class="docutils literal notranslate"><span class=pre >df.groupby("col1",</span> <span class=pre >as_index=False).mean()</span></code>). By default when you use groupby, pandas likes to make a new index out of the grouping columns. As you know, I HATE indices, and this keyword argument prevents pandas from this behavior. To illustrate:</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[12]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >df</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >DataFrame</span><span class=p >(</span>
    <span class=p >{</span>
        <span class=s2 >"social_security_numbers"</span><span class=p >:</span> <span class=p >[</span>
            <span class=mi >111111111</span><span class=p >,</span>
            <span class=mi >222222222</span><span class=p >,</span>
            <span class=mi >222222222</span><span class=p >,</span>
            <span class=mi >222222222</span><span class=p >,</span>
            <span class=mi >333333333</span><span class=p >,</span>
        <span class=p >],</span>
        <span class=s2 >"second_column"</span><span class=p >:</span> <span class=p >[</span><span class=s2 >"a"</span><span class=p >,</span> <span class=s2 >"a"</span><span class=p >,</span> <span class=s2 >"b"</span><span class=p >,</span> <span class=s2 >"a"</span><span class=p >,</span> <span class=s2 >"b"</span><span class=p >],</span>
        <span class=s2 >"third_column"</span><span class=p >:</span> <span class=p >[</span><span class=mi >100</span><span class=p >,</span> <span class=mi >200</span><span class=p >,</span> <span class=mi >300</span><span class=p >,</span> <span class=mi >400</span><span class=p >,</span> <span class=mi >500</span><span class=p >],</span>
    <span class=p >}</span>
<span class=p >)</span>
<span class=n >df</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[12]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>social_security_numbers <th>second_column <th>third_column <tr> <th>0 <td>111111111 <td>a <td>100 <tr> <th>1 <td>222222222 <td>a <td>200 <tr> <th>2 <td>222222222 <td>b <td>300 <tr> <th>3 <td>222222222 <td>a <td>400 <tr> <th>4 <td>333333333 <td>b <td>500 </table> </div></div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[13]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=c1 ># Without as_index=False</span>
<span class=n >df</span><span class=o >.</span><span class=n >groupby</span><span class=p >([</span><span class=s2 >"social_security_numbers"</span><span class=p >,</span> <span class=s2 >"second_column"</span><span class=p >])</span><span class=o >.</span><span class=n >mean</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[13]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th> <th>third_column <tr> <th>social_security_numbers <th>second_column <th> <tr> <th>111111111 <th>a <td>100.0 <tr> <th rowspan=2  valign=top >222222222 <th>a <td>300.0 <tr> <th>b <td>300.0 <tr> <th>333333333 <th>b <td>500.0 </table> </div></div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[14]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=c1 ># With as_index=False</span>
<span class=n >df</span><span class=o >.</span><span class=n >groupby</span><span class=p >([</span><span class=s2 >"social_security_numbers"</span><span class=p >,</span> <span class=s2 >"second_column"</span><span class=p >],</span> <span class=n >as_index</span><span class=o >=</span><span class=kc >False</span><span class=p >)</span><span class=o >.</span><span class=n >mean</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[14]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>social_security_numbers <th>second_column <th>third_column <tr> <th>0 <td>111111111 <td>a <td>100.0 <tr> <th>1 <td>222222222 <td>a <td>300.0 <tr> <th>2 <td>222222222 <td>b <td>300.0 <tr> <th>3 <td>333333333 <td>b <td>500.0 </table> </div></div> </div> </section> <section id=Exercise-5 > <h3 id=Exercise-5 >Exercise 5<a class=headerlink  href="#Exercise-5" title="Permalink to this headline">¶</a></h3> <p>You should notice that there are significantly fewer rows in the data now. Given your answer from 3, what groups were you <em>collapsing</em> in question 4 (in other words, which different groups were previously split out into separate rows but have now been aggregated into the same rows)?</p> <p>Store the names of those variables <strong>in a ``list`` in alphabetical order</strong> in <code class="docutils literal notranslate"><span class=pre >results</span></code> as <code class="docutils literal notranslate"><span class=pre >"ex5_collapsed_vars"</span></code>.</p> </section> </section> <section id=Racial-Arrest-Composition > <h2 id=Racial-Arrest-Composition >Racial Arrest Composition<a class=headerlink  href="#Racial-Arrest-Composition" title="Permalink to this headline">¶</a></h2> <p>The next question we want to ask is: does the racial composition of arrests in each county vary by arrest type? In other words, do Blacks, Hispanics, Whites, and Other make up substantially different portions of the people arrested for drug offenses and violent offenses?</p> <p>To answer this question, we need to be able to say what proportion of all drug arrestees were Black/White/Hispanic/Other and what proportion of all violent arrestees were Black/White/Hispanic/Other <em>for each county and for each year</em>.</p> <p>In trying to do this, we’ll need to break the problem down into pieces, starting from our goal (these quantities) and working backwards.</p> <section id=Exercise-6 > <h3 id=Exercise-6 >Exercise 6<a class=headerlink  href="#Exercise-6" title="Permalink to this headline">¶</a></h3> <p>To calculate the share of all drug and violent arrestees who come from each racial group, what quantities do we need?</p> <p>Expressed differently, what two variables (one for drug arrests, one for violent arrests) do we need to add to our data to it allow us to calculate the share of arrestees in each county-year that come from a given racial group?</p> <p>Calculate these two variables (one variable for drug arrests, one for violent arrests).</p> <p><strong>Hint:</strong> <code class="docutils literal notranslate"><span class=pre >transform</span></code> should probably make an appearance here.</p> <p><strong>Hint:</strong> This types of groupby manipulations are an easy place to do things wrong, so it’s important to eye-ball your data to be sure you did things right!</p> <p>Take a look at the data for, say, Alameda County in 1980, and compare the values that you calculate above with what you get if you try to calculate those same numbers by hand using the raw data from Exercise 5?</p> </section> <section id=Exercise-7 > <h3 id=Exercise-7 >Exercise 7<a class=headerlink  href="#Exercise-7" title="Permalink to this headline">¶</a></h3> <p>Now calculate the share of violent and drug arrestees in each county and year from each racial group.</p> <p>To ensure you’re on the right track, store the share (between zero and one) of violent arrestees in Alameda County in 1980 who were Black as <code class="docutils literal notranslate"><span class=pre >ex7_alameda_1980_share_violent_arrestees_black</span></code>.</p> </section> <section id=Exercise-8 > <h3 id=Exercise-8 >Exercise 8<a class=headerlink  href="#Exercise-8" title="Permalink to this headline">¶</a></h3> <p>We’re about to start studying this data by plotting the share of violent arrestees that are Black against the share of felony drug arrestees that are Black. But the moment where you finish your data manipulations and are about to start you data analysis is a <em>great</em> time to just make sure everything in your data looks good. Let’s run a few checks:</p> <ul class=simple > <li><p>Are your values of the share of felony arrestees who were arrested for violent crimes sensible?</p> <li><p>You’re about to analyze the data using only the rows for the Black racial group. How many unique counties are there with data for Black arrestees? How many for White arrestees? Do you remember how many counties there are in CA (google is your friend if not!)?</p> </ul> <p>Include assert statements to check all these features of your data.</p> <p>(Reminder: the autograder will only work if you are entire notebook runs without errors.)</p> <p>If you encounter any problems, make sure you understand why they are happening, and fix them (if a fix is appropriate!).</p> </section> <section id=Exercise-9 > <h3 id=Exercise-9 >Exercise 9<a class=headerlink  href="#Exercise-9" title="Permalink to this headline">¶</a></h3> <p>Now check to see if you have the same number of counties <em>in each year for each racial group</em>.</p> <p>Can you figure out why there aren’t? (Hint: this isn’t trivial to figure out! You’ll probably have to do some detective work, and even then you’ll have to make a bit of a “best guess” at what’s going on!)</p> </section> <section id=Exercise-10 > <h3 id=Exercise-10 >Exercise 10<a class=headerlink  href="#Exercise-10" title="Permalink to this headline">¶</a></h3> <p>Once you think you have a theory of the case, fix the problem. Again, this will NOT be trivial.</p> </section> <section id=Exercise-11 > <h3 id=Exercise-11 >Exercise 11<a class=headerlink  href="#Exercise-11" title="Permalink to this headline">¶</a></h3> <p>Now that you have corrected your problem, averaging over the values for each county-year, calculate the average share of drug arrestees who are Black and the average share of drug arrestees who are White. Store the results as <code class="docutils literal notranslate"><span class=pre >"ex11_white_drug_share"</span></code> and <code class="docutils literal notranslate"><span class=pre >"ex11_black_drug_share"</span></code>.</p> </section> <section id=Exercise-12 > <h3 id=Exercise-12 >Exercise 12<a class=headerlink  href="#Exercise-12" title="Permalink to this headline">¶</a></h3> <p>Plot the share of violent arrestees that are Black against the share of felony drug arrestees that are Black. Do they look proportionate? Answer in text here.</p> <p>Do Black arrestees make up a greater share of violent arrestees, or a greater share of drug arrestees? Store you answer as <code class="docutils literal notranslate"><span class=pre >"greater</span> <span class=pre >violent"</span></code>, or <code class="docutils literal notranslate"><span class=pre >"greater</span> <span class=pre >drug"</span></code> in <code class="docutils literal notranslate"><span class=pre >"ex12_proportionate"</span></code>.</p> <p><strong>Hint:</strong> You can add a 45 degree reference line by making a dummy dataset with one point at 0,0 and one point at a location near the top of your data (e.g. 0.7, 0.7). Without a reference line it’s VERY hard to be sure if how your points relate to proportionality.</p> <p>(A quick note of warning on interpretation: these results can tell you whether Black Californians make up a larger proportion of <em>arrests</em> for certain types of crimes, not whether they make up a larger proportion of people who <em>commit</em> a give type of crime! Those <em>might</em> be the same, but they might not… this data just can’t answer that question.)</p> </section> </section> </section> </article> </div> </div> </main> </div> <footer class=md-footer > <div class=md-footer-nav > <nav class="md-footer-nav__inner md-grid"> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright > <div class=md-footer-copyright__highlight > &#169; Copyright 2021, Nick Eubank. </div> Created using <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.5.0. and <a href="https://github.com/bashtage/sphinx-material/">Material for Sphinx</a> </div> </div> </div> </footer> <script src="../_static/javascripts/application.js"></script> <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>