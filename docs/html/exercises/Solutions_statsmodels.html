<!DOCTYPE html> <meta charset=utf-8  /> <meta name=viewport  content="width=device-width, initial-scale=1.0" /><meta name=generator  content="Docutils 0.17.1: http://docutils.sourceforge.net/" /> <meta name=viewport  content="width=device-width,initial-scale=1"> <meta http-equiv=x-ua-compatible  content="ie=edge"> <meta name="lang:clipboard.copy" content="Copy to clipboard"> <meta name="lang:clipboard.copied" content="Copied to clipboard"> <meta name="lang:search.language" content=en > <meta name="lang:search.pipeline.stopwords" content=True > <meta name="lang:search.pipeline.trimmer" content=True > <meta name="lang:search.result.none" content="No matching documents"> <meta name="lang:search.result.one" content="1 matching document"> <meta name="lang:search.result.other" content="# matching documents"> <meta name="lang:search.tokenizer" content="[\s\-]+"> <link href="https://fonts.gstatic.com/" rel=preconnect  crossorigin> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel=stylesheet > <style> body, input { font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif } code, kbd, pre { font-family: "Roboto Mono", "Courier New", Courier, monospace } </style> <link rel=stylesheet  href="../_static/stylesheets/application.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-palette.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-fixes.css"/> <link rel=stylesheet  href="../_static/fonts/material-icons.css"/> <meta name=theme-color  content="#2196f3"> <script src="../_static/javascripts/modernizr.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-XX133829453-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-XX133829453-1'); </script> <title>Maternal Smoking and Birth Weight &#8212; Practical Data Science</title> <link rel=stylesheet  type="text/css" href="../_static/pygments.css" /> <link rel=stylesheet  type="text/css" href="../_static/material.css" /> <script data-url_root="../" id=documentation_options  src="../_static/documentation_options.js"></script> <script src="../_static/jquery.js"></script> <script src="../_static/underscore.js"></script> <script src="../_static/doctools.js"></script> <script crossorigin=anonymous  integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script> <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script> <script defer=defer  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <link rel="shortcut icon" href="../_static/mids_logo.svg"/> <link rel=index  title=Index  href="../genindex.html" /> <link rel=search  title=Search  href="../search.html" /> <body dir=ltr data-md-color-primary=blue-grey data-md-color-accent=blue> <svg class=md-svg > <defs data-children-count=0 > <svg xmlns="http://www.w3.org/2000/svg" width=416  height=448  viewBox="0 0 416 448" id=__github ><path fill=currentColor  d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle  data-md-toggle=drawer  type=checkbox  id=__drawer > <input class=md-toggle  data-md-toggle=search  type=checkbox  id=__search > <label class=md-overlay  data-md-component=overlay  for=__drawer ></label> <a href="#exercises/Solutions_statsmodels" tabindex=1  class=md-skip > Skip to content </a> <header class=md-header  data-md-component=header > <nav class="md-header-nav md-grid"> <div class="md-flex navheader"> <div class="md-flex__cell md-flex__cell--shrink"> <a href="../index.html" title="Practical Data Science" class="md-header-nav__button md-logo"> <img src="../_static/mids_logo.svg" height=26  alt="Practical Data Science logo"> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer ></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title > <span class=md-header-nav__topic >Practical Data Science</span> <span class=md-header-nav__topic > Maternal Smoking and Birth Weight </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search ></label> <div class=md-search  data-md-component=search  role=dialog > <label class=md-search__overlay  for=__search ></label> <div class=md-search__inner  role=search > <form class=md-search__form  action="../search.html" method=get  name=search > <input type=text  class=md-search__input  name=q  placeholder=""Search"" autocapitalize=off  autocomplete=off  spellcheck=false  data-md-component=query  data-md-state=active > <label class="md-icon md-search__icon" for=__search ></label> <button type=reset  class="md-icon md-search__icon" data-md-component=reset  tabindex=-1 > &#xE5CD; </button> </form> <div class=md-search__output > <div class=md-search__scrollwrap  data-md-scrollfix> <div class=md-search-result  data-md-component=result > <div class=md-search-result__meta > Type to start searching </div> <ol class=md-search-result__list ></ol> </div> </div> </div> </div> </div> </div> <script src="../_static/javascripts/version_dropdown.js"></script> <script> var json_loc = "../"versions.json"", target_loc = "../../", text = "Versions"; $( document ).ready( add_version_dropdown(json_loc, target_loc, text)); </script> </div> </nav> </header> <div class=md-container > <nav class=md-tabs  data-md-component=tabs > <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list > <li class=md-tabs__item ><a href="../index.html" class=md-tabs__link >Home</a> <li class=md-tabs__item ><a href="../class_schedule.html" class=md-tabs__link >Class Schedule</a> <li class=md-tabs__item ><a href="../topic_list.html" class=md-tabs__link >Topic List</a> <li class=md-tabs__item ><a href="https://www.nickeubank.com" class=md-tabs__link >About The Author</a> </ul> </div> </nav> <main class=md-main > <div class="md-main__inner md-grid" data-md-component=container > <div class="md-sidebar md-sidebar--primary" data-md-component=navigation > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--primary" data-md-level=0 > <label class="md-nav__title md-nav__title--site" for=__drawer > <a href="../index.html" title="Practical Data Science" class="md-nav__button md-logo"> <img src="../_static/mids_logo.svg" alt=" logo" width=48  height=48 > </a> <a href="../index.html" title="Practical Data Science">Practical Data Science</a> </label> <ul class=md-nav__list > <li class=md-nav__item > <a href="../class_schedule.html" class=md-nav__link >Class Schedule</a> <li class=md-nav__item > <a href="../autograder_guidelines.html" class=md-nav__link >Autograder Guidelines</a> <li class=md-nav__item > <a href="../not_a_mids_student.html" class=md-nav__link >Not a MIDS Student?</a> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >"Contents"</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#exercises-solutions-statsmodels--page-root" class=md-nav__link >Maternal Smoking and Birth Weight</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Gradescope-Autograding" class=md-nav__link >Gradescope Autograding</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Submission-Limits" class=md-nav__link >Submission Limits</a> </ul> </nav> <li class=md-nav__item ><a href="#Exercises" class=md-nav__link >Exercises</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exercise-1" class=md-nav__link >Exercise 1</a> <li class=md-nav__item ><a href="#Exercise-2" class=md-nav__link >Exercise 2</a> </ul> </nav> <li class=md-nav__item ><a href="#Linear-Regression" class=md-nav__link >Linear Regression</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exercise-3" class=md-nav__link >Exercise 3</a> <li class=md-nav__item ><a href="#Exercise-4" class=md-nav__link >Exercise 4</a> <li class=md-nav__item ><a href="#Exercise-5" class=md-nav__link >Exercise 5</a> <li class=md-nav__item ><a href="#Exercise-6" class=md-nav__link >Exercise 6</a> <li class=md-nav__item ><a href="#Exercise-7" class=md-nav__link >Exercise 7</a> </ul> </nav> <li class=md-nav__item ><a href="#statsmodels-versus-R" class=md-nav__link >statsmodels versus R</a> <li class=md-nav__item ><a href="#Logistic-Regression" class=md-nav__link >Logistic Regression</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exercise-8" class=md-nav__link >Exercise 8</a> </ul> </nav> <li class=md-nav__item ><a href="#Weighting" class=md-nav__link >Weighting</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exercise-9" class=md-nav__link >Exercise 9</a> <li class=md-nav__item ><a href="#Exercise-10" class=md-nav__link >Exercise 10</a> <li class=md-nav__item ><a href="#Exercise-11" class=md-nav__link >Exercise 11</a> <li class=md-nav__item ><a href="#Exercise-12" class=md-nav__link >Exercise 12</a> </ul> </nav> </ul> </nav> </ul> </nav> </div> </div> </div> <div class=md-content > <article class="md-content__inner md-typeset" role=main > <style> /* CSS for nbsphinx extension */ /* remove conflicting styling from Sphinx themes */ div.nbinput.container div.prompt *, div.nboutput.container div.prompt *, div.nbinput.container div.input_area pre, div.nboutput.container div.output_area pre, div.nbinput.container div.input_area .highlight, div.nboutput.container div.output_area .highlight { border: none; padding: 0; margin: 0; box-shadow: none; } div.nbinput.container > div[class*=highlight], div.nboutput.container > div[class*=highlight] { margin: 0; } div.nbinput.container div.prompt *, div.nboutput.container div.prompt * { background: none; } div.nboutput.container div.output_area .highlight, div.nboutput.container div.output_area pre { background: unset; } div.nboutput.container div.output_area div.highlight { color: unset; /* override Pygments text color */ } /* avoid gaps between output lines */ div.nboutput.container div[class*=highlight] pre { line-height: normal; } /* input/output containers */ div.nbinput.container, div.nboutput.container { display: -webkit-flex; display: flex; align-items: flex-start; margin: 0; width: 100%; } @media (max-width: 540px) { div.nbinput.container, div.nboutput.container { flex-direction: column; } } /* input container */ div.nbinput.container { padding-top: 5px; } /* last container */ div.nblast.container { padding-bottom: 5px; } /* input prompt */ div.nbinput.container div.prompt pre { color: #307FC1; } /* output prompt */ div.nboutput.container div.prompt pre { color: #BF5B3D; } /* all prompts */ div.nbinput.container div.prompt, div.nboutput.container div.prompt { width: 4.5ex; padding-top: 5px; position: relative; user-select: none; } div.nbinput.container div.prompt > div, div.nboutput.container div.prompt > div { position: absolute; right: 0; margin-right: 0.3ex; } @media (max-width: 540px) { div.nbinput.container div.prompt, div.nboutput.container div.prompt { width: unset; text-align: left; padding: 0.4em; } div.nboutput.container div.prompt.empty { padding: 0; } div.nbinput.container div.prompt > div, div.nboutput.container div.prompt > div { position: unset; } } /* disable scrollbars on prompts */ div.nbinput.container div.prompt pre, div.nboutput.container div.prompt pre { overflow: hidden; } /* input/output area */ div.nbinput.container div.input_area, div.nboutput.container div.output_area { -webkit-flex: 1; flex: 1; overflow: auto; } @media (max-width: 540px) { div.nbinput.container div.input_area, div.nboutput.container div.output_area { width: 100%; } } /* input area */ div.nbinput.container div.input_area { border: 1px solid #e0e0e0; border-radius: 2px; /*background: #f5f5f5;*/ } /* override MathJax center alignment in output cells */ div.nboutput.container div[class*=MathJax] { text-align: left !important; } /* override sphinx.ext.imgmath center alignment in output cells */ div.nboutput.container div.math p { text-align: left; } /* standard error */ div.nboutput.container div.output_area.stderr { background: #fdd; } /* ANSI colors */ .ansi-black-fg { color: #3E424D; } .ansi-black-bg { background-color: #3E424D; } .ansi-black-intense-fg { color: #282C36; } .ansi-black-intense-bg { background-color: #282C36; } .ansi-red-fg { color: #E75C58; } .ansi-red-bg { background-color: #E75C58; } .ansi-red-intense-fg { color: #B22B31; } .ansi-red-intense-bg { background-color: #B22B31; } .ansi-green-fg { color: #00A250; } .ansi-green-bg { background-color: #00A250; } .ansi-green-intense-fg { color: #007427; } .ansi-green-intense-bg { background-color: #007427; } .ansi-yellow-fg { color: #DDB62B; } .ansi-yellow-bg { background-color: #DDB62B; } .ansi-yellow-intense-fg { color: #B27D12; } .ansi-yellow-intense-bg { background-color: #B27D12; } .ansi-blue-fg { color: #208FFB; } .ansi-blue-bg { background-color: #208FFB; } .ansi-blue-intense-fg { color: #0065CA; } .ansi-blue-intense-bg { background-color: #0065CA; } .ansi-magenta-fg { color: #D160C4; } .ansi-magenta-bg { background-color: #D160C4; } .ansi-magenta-intense-fg { color: #A03196; } .ansi-magenta-intense-bg { background-color: #A03196; } .ansi-cyan-fg { color: #60C6C8; } .ansi-cyan-bg { background-color: #60C6C8; } .ansi-cyan-intense-fg { color: #258F8F; } .ansi-cyan-intense-bg { background-color: #258F8F; } .ansi-white-fg { color: #C5C1B4; } .ansi-white-bg { background-color: #C5C1B4; } .ansi-white-intense-fg { color: #A1A6B2; } .ansi-white-intense-bg { background-color: #A1A6B2; } .ansi-default-inverse-fg { color: #FFFFFF; } .ansi-default-inverse-bg { background-color: #000000; } .ansi-bold { font-weight: bold; } .ansi-underline { text-decoration: underline; } div.nbinput.container div.input_area div[class*=highlight] > pre, div.nboutput.container div.output_area div[class*=highlight] > pre, div.nboutput.container div.output_area div[class*=highlight].math, div.nboutput.container div.output_area.rendered_html, div.nboutput.container div.output_area > div.output_javascript, div.nboutput.container div.output_area:not(.rendered_html) > img{ padding: 5px; margin: 0; } /* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */ div.nbinput.container div.input_area > div[class^='highlight'], div.nboutput.container div.output_area > div[class^='highlight']{ overflow-y: hidden; } /* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */ .prompt .copybtn { display: none; } /* Some additional styling taken form the Jupyter notebook CSS */ .jp-RenderedHTMLCommon table, div.rendered_html table { border: none; border-collapse: collapse; border-spacing: 0; color: black; font-size: 12px; table-layout: fixed; } .jp-RenderedHTMLCommon thead, div.rendered_html thead { border-bottom: 1px solid black; vertical-align: bottom; } .jp-RenderedHTMLCommon tr, .jp-RenderedHTMLCommon th, .jp-RenderedHTMLCommon td, div.rendered_html tr, div.rendered_html th, div.rendered_html td { text-align: right; vertical-align: middle; padding: 0.5em 0.5em; line-height: normal; white-space: normal; max-width: none; border: none; } .jp-RenderedHTMLCommon th, div.rendered_html th { font-weight: bold; } .jp-RenderedHTMLCommon tbody tr:nth-child(odd), div.rendered_html tbody tr:nth-child(odd) { background: #f5f5f5; } .jp-RenderedHTMLCommon tbody tr:hover, div.rendered_html tbody tr:hover { background: rgba(66, 165, 245, 0.2); } </style> <section id=Maternal-Smoking-and-Birth-Weight > <h1 id=exercises-solutions-statsmodels--page-root >Maternal Smoking and Birth Weight<a class=headerlink  href="#exercises-solutions-statsmodels--page-root" title="Permalink to this headline">¶</a></h1> <section id=Gradescope-Autograding > <h2 id=Gradescope-Autograding >Gradescope Autograding<a class=headerlink  href="#Gradescope-Autograding" title="Permalink to this headline">¶</a></h2> <p>Please follow <a class="reference external" href="https://www.practicaldatascience.org/html/autograder_guidelines.html">all standard guidance</a> for submitting this assignment to the Gradescope autograder, including storing your solutions in a dictionary called <code class="docutils literal notranslate"><span class=pre >results</span></code> and ensuring your notebook runs from the start to completion without any errors.</p> <p>For this assignment, please name your file <code class="docutils literal notranslate"><span class=pre >exercise_statsmodels.ipynb</span></code> before uploading.</p> <p>You can check that you have answers for all questions in your <code class="docutils literal notranslate"><span class=pre >results</span></code> dictionary with this code:</p> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=k >assert</span> <span class=nb >set</span><span class=p >(</span><span class=n >results</span><span class=o >.</span><span class=n >keys</span><span class=p >())</span> <span class=o >==</span> <span class=p >{</span>
    <span class=s2 >"ex2_birth_weight_lower"</span><span class=p >,</span>
    <span class=s2 >"ex3_smoking_coefficient"</span><span class=p >,</span>
    <span class=s2 >"ex4_smoking_coefficient"</span><span class=p >,</span>
    <span class=s2 >"ex6_compare_white_black"</span><span class=p >,</span>
    <span class=s2 >"ex6_compare_white_black_tstat"</span><span class=p >,</span>
    <span class=s2 >"ex7_predictions"</span><span class=p >,</span>
    <span class=s2 >"ex8_smoking_coefficient"</span><span class=p >,</span>
    <span class=s2 >"ex10_num_high_drug_arrest"</span><span class=p >,</span>
    <span class=s2 >"ex11_diff_in_diff"</span><span class=p >,</span>
    <span class=s2 >"ex12_diff_in_diff_weighted"</span><span class=p >,</span>
<span class=p >}</span>
</pre></div> </div> <section id=Submission-Limits > <h3 id=Submission-Limits >Submission Limits<a class=headerlink  href="#Submission-Limits" title="Permalink to this headline">¶</a></h3> <p>Please remember that you are <strong>only allowed three submissions to the autograder.</strong> Your last submission (if you submit 3 or fewer times), or your third submission (if you submit more than 3 times) will determine your grade Submissions that error out will <strong>not</strong> count against this total.</p> </section> </section> <section id=Exercises > <h2 id=Exercises >Exercises<a class=headerlink  href="#Exercises" title="Permalink to this headline">¶</a></h2> <p>For these exercises, we will borrow some data and exercises from another MIDS course on Statistical Modeling:</p> <p>These days, it is widely understood that mothers who smoke during pregnancy risk exposing their babies to many health problems. This was not common knowledge fifty years ago. One of the first studies that addressed the issue of pregnancy and smoking was the Child Health and Development Studies, a comprehensive study of all babies born between 1960 and 1967 at the Kaiser Foundation Hospital in Oakland, CA. The original reference for the study is Yerushalmy (1964, American Journal of Obstetrics and Gynecology, pp. 505-518). The data and a summary of the study are in Nolan and Speed (2000, Stat Labs, Chapter 10) and can be found at <a class="reference external" href="https://www.stat.berkeley.edu/users/statlabs/">the book’s website.</a></p> <p>There were about 15,000 families in the study. We will only analyze a subset of the data, in particular 869 male single births where the baby lived at least 28 days. The researchers interviewed mothers early in their pregnancy to collect information on socioeconomic and demographic characteristics, including an indicator of whether the mother smoked during pregnancy. The variables in the dataset are described in the <a class="reference external" href="https://ids-702-f19.github.io/Course-Website/hw/hw-02.html">code book here</a>. In this exercise, we will attempt to use this data to answer the following questions:</p> <ol class="arabic simple"> <li><p>Do mothers who smoke tend to give birth to babies with lower weights than mothers who do not smoke?</p> <li><p>What is a likely range for the difference in birth weights for smokers and non-smokers?</p> <li><p>Is there any evidence that the association between smoking and birth weight differs by mother’s race? If so, characterize those differences.</p> <li><p>Are there other interesting associations with birth weight that are worth mentioning?</p> </ol> <section id=Exercise-1 > <h3 id=Exercise-1 >Exercise 1<a class=headerlink  href="#Exercise-1" title="Permalink to this headline">¶</a></h3> <p>Load the data “smoking.csv”, which includes information on both biometrics of infants at birth, and information on mothers (variables prefixed with the letter “m”), from <a class="reference external" href="https://github.com/nickeubank/MIDS_Data">this MIDS repo</a>. (Yup, I’m giving you CLEAN DATA! I think this is the only time I’ve done this in this course! Enjoy it. :)).</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[1]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >import</span> <span class=nn >pandas</span> <span class=k >as</span> <span class=nn >pd</span>
<span class=kn >import</span> <span class=nn >numpy</span> <span class=k >as</span> <span class=nn >np</span>

<span class=n >pd</span><span class=o >.</span><span class=n >set_option</span><span class=p >(</span><span class=s2 >"mode.copy_on_write"</span><span class=p >,</span> <span class=kc >True</span><span class=p >)</span>

<span class=n >smoking_and_bw</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >read_csv</span><span class=p >(</span>
    <span class=s2 >"https://media.githubusercontent.com/media/"</span>
    <span class=s2 >"nickeubank/MIDS_Data/master/smoking.csv"</span>
<span class=p >)</span>
</pre></div> </div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[2]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >smoking_and_bw</span><span class=o >.</span><span class=n >head</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[2]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>id <th>date <th>gestation <th>bwt.oz <th>parity <th>mrace <th>mage <th>med <th>mht <th>mpregwt <th>inc <th>smoke <tr> <th>0 <td>4604 <td>1598 <td>148 <td>116 <td>7 <td>7 <td>28 <td>1 <td>66 <td>135 <td>2 <td>0 <tr> <th>1 <td>7435 <td>1527 <td>181 <td>110 <td>7 <td>7 <td>27 <td>1 <td>64 <td>133 <td>1 <td>0 <tr> <th>2 <td>7722 <td>1563 <td>204 <td>55 <td>11 <td>7 <td>35 <td>3 <td>65 <td>140 <td>6 <td>0 <tr> <th>3 <td>2026 <td>1503 <td>225 <td>132 <td>4 <td>7 <td>28 <td>2 <td>67 <td>148 <td>3 <td>0 <tr> <th>4 <td>3553 <td>1638 <td>233 <td>105 <td>4 <td>7 <td>34 <td>3 <td>61 <td>130 <td>3 <td>0 </table> </div></div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[3]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >smoking_and_bw</span><span class=o >.</span><span class=n >smoke</span><span class=o >.</span><span class=n >value_counts</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[3]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
smoke
0    466
1    403
Name: count, dtype: int64
</pre></div></div> </div> </section> <section id=Exercise-2 > <h3 id=Exercise-2 >Exercise 2<a class=headerlink  href="#Exercise-2" title="Permalink to this headline">¶</a></h3> <p>Start by plotting the relationship between infant weight at birth and gestation (length of pregnancy (in days) at time of birth) for both mothers who smoke and those who do not in a single plot. Include regression lines for both populations (again, all on one plot).</p> <p>Limit attention in the plot (and in subsequent questions) to children born after <em>more than</em> 225 days of gestation (there aren’t really any observations for parents who smoke for less than that, so we don’t get common support).</p> <p>Does it seem like birthweights tend to be lower for the children of parents who smoke at a given gestational period? Store your answer as either <code class="docutils literal notranslate"><span class=pre >"yes"</span></code> or <code class="docutils literal notranslate"><span class=pre >"no"</span></code> in <code class="docutils literal notranslate"><span class=pre >ex2_birth_weight_lower</span></code>.</p> <p><strong>NOTE:</strong> This dataset has at least one column name that cause issues with Python (and seaborn. and statsmodels).</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[4]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >smoking_and_bw</span> <span class=o >=</span> <span class=n >smoking_and_bw</span><span class=p >[</span><span class=n >smoking_and_bw</span><span class=o >.</span><span class=n >gestation</span> <span class=o >&gt;</span> <span class=mi >225</span><span class=p >]</span><span class=o >.</span><span class=n >copy</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[5]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >smoking_and_bw</span> <span class=o >=</span> <span class=n >smoking_and_bw</span><span class=o >.</span><span class=n >rename</span><span class=p >({</span><span class=s2 >"bwt.oz"</span><span class=p >:</span> <span class=s2 >"bwt_oz"</span><span class=p >},</span> <span class=n >axis</span><span class=o >=</span><span class=s2 >"columns"</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[6]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >import</span> <span class=nn >seaborn.objects</span> <span class=k >as</span> <span class=nn >so</span>
<span class=kn >from</span> <span class=nn >matplotlib</span> <span class=kn >import</span> <span class=n >style</span>
<span class=kn >import</span> <span class=nn >matplotlib.pyplot</span> <span class=k >as</span> <span class=nn >plt</span>
<span class=kn >import</span> <span class=nn >warnings</span>

<span class=n >warnings</span><span class=o >.</span><span class=n >simplefilter</span><span class=p >(</span><span class=n >action</span><span class=o >=</span><span class=s2 >"ignore"</span><span class=p >,</span> <span class=n >category</span><span class=o >=</span><span class=ne >FutureWarning</span><span class=p >)</span>
<span class=n >smoking_and_bw</span><span class=p >[</span><span class=s2 >"smoke"</span><span class=p >]</span> <span class=o >=</span> <span class=n >smoking_and_bw</span><span class=p >[</span><span class=s2 >"smoke"</span><span class=p >]</span><span class=o >.</span><span class=n >astype</span><span class=p >(</span><span class=s2 >"bool"</span><span class=p >)</span>
<span class=p >(</span>
    <span class=n >so</span><span class=o >.</span><span class=n >Plot</span><span class=p >(</span><span class=n >smoking_and_bw</span><span class=p >,</span> <span class=n >x</span><span class=o >=</span><span class=s2 >"gestation"</span><span class=p >,</span> <span class=n >y</span><span class=o >=</span><span class=s2 >"bwt_oz"</span><span class=p >,</span> <span class=n >color</span><span class=o >=</span><span class=s2 >"smoke"</span><span class=p >)</span>
    <span class=o >.</span><span class=n >add</span><span class=p >(</span><span class=n >so</span><span class=o >.</span><span class=n >Dots</span><span class=p >())</span>
    <span class=o >.</span><span class=n >add</span><span class=p >(</span><span class=n >so</span><span class=o >.</span><span class=n >Lines</span><span class=p >(),</span> <span class=n >so</span><span class=o >.</span><span class=n >PolyFit</span><span class=p >(</span><span class=n >order</span><span class=o >=</span><span class=mi >1</span><span class=p >))</span>
    <span class=o >.</span><span class=n >label</span><span class=p >(</span><span class=n >title</span><span class=o >=</span><span class=s2 >"Gestational Period and Birth Weight (by Maternal Smoking)"</span><span class=p >)</span>
    <span class=o >.</span><span class=n >theme</span><span class=p >({</span><span class=o >**</span><span class=n >style</span><span class=o >.</span><span class=n >library</span><span class=p >[</span><span class=s2 >"seaborn-v0_8-whitegrid"</span><span class=p >]})</span>
<span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[6]:
</pre></div> </div> <div class="output_area docutils container"> <img alt="../_images/exercises_Solutions_statsmodels_10_0.png" class=no-scaled-link  src="../_images/exercises_Solutions_statsmodels_10_0.png" style="width: 595px; height: 378.25px;"/> </div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[7]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >results</span> <span class=o >=</span> <span class=nb >dict</span><span class=p >()</span>
<span class=n >results</span><span class=p >[</span><span class=s2 >"ex2_birth_weight_lower"</span><span class=p >]</span> <span class=o >=</span> <span class=s2 >"yes"</span>
</pre></div> </div> </div> <blockquote> <div><p>Yup. Those linear models cross out past 315 days or so, but there’s basically no data there, so doesn’t mean much. Through the bulk of the distribution the children of smoking mothers weigh less.</p> </div></blockquote> </section> </section> <section id=Linear-Regression > <h2 id=Linear-Regression >Linear Regression<a class=headerlink  href="#Linear-Regression" title="Permalink to this headline">¶</a></h2> <p><strong>PLEASE CONTINUE TO SUBSET FOR GESTATION GREATER THAN 225 DAYS for this section</strong></p> <section id=Exercise-3 > <h3 id=Exercise-3 >Exercise 3<a class=headerlink  href="#Exercise-3" title="Permalink to this headline">¶</a></h3> <p>Now check this relationship using <code class="docutils literal notranslate"><span class=pre >statsmodels</span></code>. Regress birthweight on gestational period and whether the infant’s mother smoked. Is your conclusion from the previous exercise confirmed? Store the coefficient for smoking in results under the key <code class="docutils literal notranslate"><span class=pre >"ex3_smoking_coefficient"</span></code>.</p> <p><em>Note:</em> coefficients are stored in the <code class="docutils literal notranslate"><span class=pre >.params</span></code> attribute of your fit model.</p> <p><em>Note 2:</em> you may hit a problem because of the name of one of your columns. You should probably be able to guess the problem given your experience with Python. Also, if you have trouble figuring out how to access the parameters from a fitted model, check out the docs <a class="reference external" href="https://www.statsmodels.org/dev/generated/statsmodels.regression.linear_model.OLS.html">here</a>.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[8]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >import</span> <span class=nn >statsmodels.formula.api</span> <span class=k >as</span> <span class=nn >smf</span>

<span class=n >s_and_bw_model</span> <span class=o >=</span> <span class=n >smf</span><span class=o >.</span><span class=n >ols</span><span class=p >(</span><span class=s2 >"bwt_oz ~ gestation + smoke"</span><span class=p >,</span> <span class=n >smoking_and_bw</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=n >s_and_bw_model</span><span class=o >.</span><span class=n >summary</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[8]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <table> <caption>OLS Regression Results</caption> <tr> <th>Dep. Variable: <td>bwt_oz <th> R-squared: <td> 0.208 <tr> <th>Model: <td>OLS <th> Adj. R-squared: <td> 0.206 <tr> <th>Method: <td>Least Squares <th> F-statistic: <td> 112.6 <tr> <th>Date: <td>Thu, 16 Nov 2023 <th> Prob (F-statistic): <td>3.68e-44 <tr> <th>Time: <td>10:33:12 <th> Log-Likelihood: <td> -3606.9 <tr> <th>No. Observations: <td> 862 <th> AIC: <td> 7220. <tr> <th>Df Residuals: <td> 859 <th> BIC: <td> 7234. <tr> <th>Df Model: <td> 2 <th> <td> <tr> <th>Covariance Type: <td>nonrobust <th> <td> </table> <table> <tr> <td> <th>coef <th>std err <th>t <th>P&gt;|t| <th>[0.025 <th>0.975] <tr> <th>Intercept <td> -13.4386 <td> 10.878 <td> -1.235 <td> 0.217 <td> -34.790 <td> 7.913 <tr> <th>smoke[T.True] <td> -7.8784 <td> 1.090 <td> -7.227 <td> 0.000 <td> -10.018 <td> -5.739 <tr> <th>gestation <td> 0.4860 <td> 0.039 <td> 12.544 <td> 0.000 <td> 0.410 <td> 0.562 </table> <table> <tr> <th>Omnibus: <td> 6.654 <th> Durbin-Watson: <td> 1.950 <tr> <th>Prob(Omnibus): <td> 0.036 <th> Jarque-Bera (JB): <td> 7.760 <tr> <th>Skew: <td> 0.114 <th> Prob(JB): <td> 0.0206 <tr> <th>Kurtosis: <td> 3.405 <th> Cond. No. <td>5.61e+03 </table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The condition number is large, 5.61e+03. This might indicate that there are<br/>strong multicollinearity or other numerical problems.</div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[9]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >results</span><span class=p >[</span><span class=s2 >"ex3_smoking_coefficient"</span><span class=p >]</span> <span class=o >=</span> <span class=n >s_and_bw_model</span><span class=o >.</span><span class=n >params</span><span class=p >[</span><span class=s2 >"smoke[T.True]"</span><span class=p >]</span>
</pre></div> </div> </div> <blockquote> <div><p>Yup! Smoking results in markedly reduced birth weight!</p> </div></blockquote> </section> <section id=Exercise-4 > <h3 id=Exercise-4 >Exercise 4<a class=headerlink  href="#Exercise-4" title="Permalink to this headline">¶</a></h3> <p>Now let’s expand our model to also take into account mothers’ pregnancy weight and race (make sure to treat race as a categorical variable!). Don’t try to do any recoding of <code class="docutils literal notranslate"><span class=pre >mrace</span></code>, just turn it into a categorical. Does your interpretation of the <code class="docutils literal notranslate"><span class=pre >smoke</span></code> coefficient change? Store the new coefficient under the key <code class="docutils literal notranslate"><span class=pre >"ex4_smoking_coefficient"</span></code>.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[10]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >s_and_bw_model2</span> <span class=o >=</span> <span class=n >smf</span><span class=o >.</span><span class=n >ols</span><span class=p >(</span>
    <span class=s2 >"bwt_oz ~ gestation + smoke + mpregwt + C(mrace)"</span><span class=p >,</span> <span class=n >smoking_and_bw</span>
<span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=n >s_and_bw_model2</span><span class=o >.</span><span class=n >summary</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[10]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <table> <caption>OLS Regression Results</caption> <tr> <th>Dep. Variable: <td>bwt_oz <th> R-squared: <td> 0.255 <tr> <th>Model: <td>OLS <th> Adj. R-squared: <td> 0.245 <tr> <th>Method: <td>Least Squares <th> F-statistic: <td> 24.23 <tr> <th>Date: <td>Thu, 16 Nov 2023 <th> Prob (F-statistic): <td>6.80e-47 <tr> <th>Time: <td>10:33:12 <th> Log-Likelihood: <td> -3580.3 <tr> <th>No. Observations: <td> 862 <th> AIC: <td> 7187. <tr> <th>Df Residuals: <td> 849 <th> BIC: <td> 7248. <tr> <th>Df Model: <td> 12 <th> <td> <tr> <th>Covariance Type: <td>nonrobust <th> <td> </table> <table> <tr> <td> <th>coef <th>std err <th>t <th>P&gt;|t| <th>[0.025 <th>0.975] <tr> <th>Intercept <td> -17.3203 <td> 11.138 <td> -1.555 <td> 0.120 <td> -39.181 <td> 4.541 <tr> <th>smoke[T.True] <td> -7.8958 <td> 1.081 <td> -7.303 <td> 0.000 <td> -10.018 <td> -5.774 <tr> <th>C(mrace)[T.1] <td> -1.8441 <td> 2.776 <td> -0.664 <td> 0.507 <td> -7.293 <td> 3.605 <tr> <th>C(mrace)[T.2] <td> -5.6291 <td> 3.749 <td> -1.502 <td> 0.134 <td> -12.987 <td> 1.729 <tr> <th>C(mrace)[T.3] <td> -0.5249 <td> 2.477 <td> -0.212 <td> 0.832 <td> -5.387 <td> 4.337 <tr> <th>C(mrace)[T.4] <td> 0.9884 <td> 2.497 <td> 0.396 <td> 0.692 <td> -3.912 <td> 5.889 <tr> <th>C(mrace)[T.5] <td> -0.6721 <td> 1.767 <td> -0.380 <td> 0.704 <td> -4.141 <td> 2.796 <tr> <th>C(mrace)[T.6] <td> 4.3084 <td> 3.235 <td> 1.332 <td> 0.183 <td> -2.041 <td> 10.658 <tr> <th>C(mrace)[T.7] <td> -6.4570 <td> 1.477 <td> -4.372 <td> 0.000 <td> -9.356 <td> -3.558 <tr> <th>C(mrace)[T.8] <td> -7.1764 <td> 2.849 <td> -2.519 <td> 0.012 <td> -12.767 <td> -1.585 <tr> <th>C(mrace)[T.9] <td> -1.9153 <td> 4.098 <td> -0.467 <td> 0.640 <td> -9.959 <td> 6.128 <tr> <th>gestation <td> 0.4417 <td> 0.039 <td> 11.441 <td> 0.000 <td> 0.366 <td> 0.517 <tr> <th>mpregwt <td> 0.1396 <td> 0.027 <td> 5.242 <td> 0.000 <td> 0.087 <td> 0.192 </table> <table> <tr> <th>Omnibus: <td> 8.387 <th> Durbin-Watson: <td> 1.968 <tr> <th>Prob(Omnibus): <td> 0.015 <th> Jarque-Bera (JB): <td> 11.377 <tr> <th>Skew: <td> 0.078 <th> Prob(JB): <td> 0.00338 <tr> <th>Kurtosis: <td> 3.541 <th> Cond. No. <td>6.50e+03 </table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The condition number is large, 6.5e+03. This might indicate that there are<br/>strong multicollinearity or other numerical problems.</div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[11]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >results</span><span class=p >[</span><span class=s2 >"ex4_smoking_coefficient"</span><span class=p >]</span> <span class=o >=</span> <span class=n >s_and_bw_model2</span><span class=o >.</span><span class=n >params</span><span class=p >[</span><span class=s2 >"smoke[T.True]"</span><span class=p >]</span>
</pre></div> </div> </div> </section> <section id=Exercise-5 > <h3 id=Exercise-5 >Exercise 5<a class=headerlink  href="#Exercise-5" title="Permalink to this headline">¶</a></h3> <p>Now let’s test for whether there is an interaction between the mother’s race and the effect of smoking by adding an interaction term to this regression.</p> <p>Note that race is coded as follows:</p> <div class="highlight-none notranslate"><div class=highlight ><pre><span></span>mrace    mother’s race or ethnicity
         0-5= white
         6  = mexican
         7 = black
         8 = asian
         9 = mix
         99 = unknown
</pre></div> </div> <p>As most variation in this data is between “white” and other categories, first recode race to be an indicator for white and non-white for easier interpretation.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[12]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >smoking_and_bw</span><span class=p >[</span><span class=s2 >"white"</span><span class=p >]</span> <span class=o >=</span> <span class=p >(</span><span class=n >smoking_and_bw</span><span class=p >[</span><span class=s2 >"mrace"</span><span class=p >]</span> <span class=o >&gt;=</span> <span class=mi >0</span><span class=p >)</span> <span class=o >&amp;</span> <span class=p >(</span><span class=n >smoking_and_bw</span><span class=p >[</span><span class=s2 >"mrace"</span><span class=p >]</span> <span class=o >&lt;</span> <span class=mi >6</span><span class=p >)</span>

<span class=n >s_and_bw_model3</span> <span class=o >=</span> <span class=n >smf</span><span class=o >.</span><span class=n >ols</span><span class=p >(</span>
    <span class=s2 >"bwt_oz ~ gestation + mpregwt + C(white)*smoke"</span><span class=p >,</span> <span class=n >smoking_and_bw</span>
<span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=n >s_and_bw_model3</span><span class=o >.</span><span class=n >summary</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[12]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <table> <caption>OLS Regression Results</caption> <tr> <th>Dep. Variable: <td>bwt_oz <th> R-squared: <td> 0.243 <tr> <th>Model: <td>OLS <th> Adj. R-squared: <td> 0.238 <tr> <th>Method: <td>Least Squares <th> F-statistic: <td> 54.81 <tr> <th>Date: <td>Thu, 16 Nov 2023 <th> Prob (F-statistic): <td>1.91e-49 <tr> <th>Time: <td>10:33:12 <th> Log-Likelihood: <td> -3587.5 <tr> <th>No. Observations: <td> 862 <th> AIC: <td> 7187. <tr> <th>Df Residuals: <td> 856 <th> BIC: <td> 7216. <tr> <th>Df Model: <td> 5 <th> <td> <tr> <th>Covariance Type: <td>nonrobust <th> <td> </table> <table> <tr> <td> <th>coef <th>std err <th>t <th>P&gt;|t| <th>[0.025 <th>0.975] <tr> <th>Intercept <td> -21.8908 <td> 10.949 <td> -1.999 <td> 0.046 <td> -43.381 <td> -0.401 <tr> <th>C(white)[T.True] <td> 4.3761 <td> 1.575 <td> 2.778 <td> 0.006 <td> 1.284 <td> 7.468 <tr> <th>smoke[T.True] <td> -8.8601 <td> 2.077 <td> -4.267 <td> 0.000 <td> -12.936 <td> -4.784 <tr> <th>C(white)[T.True]:smoke[T.True] <td> 1.0069 <td> 2.421 <td> 0.416 <td> 0.678 <td> -3.746 <td> 5.759 <tr> <th>gestation <td> 0.4446 <td> 0.039 <td> 11.510 <td> 0.000 <td> 0.369 <td> 0.520 <tr> <th>mpregwt <td> 0.1319 <td> 0.026 <td> 5.132 <td> 0.000 <td> 0.081 <td> 0.182 </table> <table> <tr> <th>Omnibus: <td> 8.544 <th> Durbin-Watson: <td> 1.956 <tr> <th>Prob(Omnibus): <td> 0.014 <th> Jarque-Bera (JB): <td> 11.787 <tr> <th>Skew: <td> 0.071 <th> Prob(JB): <td> 0.00276 <tr> <th>Kurtosis: <td> 3.555 <th> Cond. No. <td>6.35e+03 </table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The condition number is large, 6.35e+03. This might indicate that there are<br/>strong multicollinearity or other numerical problems.</div> </div> </section> <section id=Exercise-6 > <h3 id=Exercise-6 >Exercise 6<a class=headerlink  href="#Exercise-6" title="Permalink to this headline">¶</a></h3> <p>Now, using <a class="reference external" href="https://www.statsmodels.org/stable/generated/statsmodels.regression.linear_model.OLSResults.t_test.html">post-regression test syntax</a> (not by running a new regression on a subpopulation), recover the coefficient and t-statistic for <em>whether smoking reduces birth weight for white mothers.</em> Store the t-statistic of your test in <code class="docutils literal notranslate"><span class=pre >ex6_compare_white_black_tstat</span></code>.</p> <p><strong>Hint:</strong> Read to the BOTTOM of the post-regression test syntax documentation for how to specify hypotheses with strings.</p> <p>How does this coefficient compare to that for non-White mothers?</p> <p>Is the reduction in birth weight associated with smoking for White mothers larger or smaller than for non-White mothers (the effect of smoking is negative for everyone, so basically I’m asking whether the <em>absolute value</em> of this negative value is larger or smaller for White mothers than non-White mothers)? Store your answer as either <code class="docutils literal notranslate"><span class=pre >"larger"</span></code> or <code class="docutils literal notranslate"><span class=pre >"smaller"</span></code> under the key <code class="docutils literal notranslate"><span class=pre >"ex6_compare_white_black"</span></code>.</p> <p><strong>Note:</strong> Please ensure your t-stat is stored as a single number, not an array or an array of arrays.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[13]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >hypotheses</span> <span class=o >=</span> <span class=s2 >"smoke[T.True] + C(white)[T.True]:smoke[T.True] = 0"</span>
<span class=n >t_test</span> <span class=o >=</span> <span class=n >s_and_bw_model3</span><span class=o >.</span><span class=n >t_test</span><span class=p >(</span><span class=n >hypotheses</span><span class=p >)</span>
<span class=n >t_test</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[13]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
&lt;class 'statsmodels.stats.contrast.ContrastResults'&gt;
                             Test for Constraints
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
c0            -7.8532      1.253     -6.266      0.000     -10.313      -5.393
==============================================================================
</pre></div></div> </div> <blockquote> <div><p>The reduction in birth weight associated with smoking for white mothers appears to be about 40% that of the penalty of black mothers.</p> </div></blockquote> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[14]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >results</span><span class=p >[</span><span class=s2 >"ex6_compare_white_black"</span><span class=p >]</span> <span class=o >=</span> <span class=s2 >"smaller"</span>
<span class=n >results</span><span class=p >[</span><span class=s2 >"ex6_compare_white_black_tstat"</span><span class=p >]</span> <span class=o >=</span> <span class=n >t_test</span><span class=o >.</span><span class=n >tvalue</span><span class=p >[</span><span class=mi >0</span><span class=p >][</span><span class=mi >0</span><span class=p >]</span>
</pre></div> </div> </div> </section> <section id=Exercise-7 > <h3 id=Exercise-7 >Exercise 7<a class=headerlink  href="#Exercise-7" title="Permalink to this headline">¶</a></h3> <p>Now let’s use this model to predict some values. Let’s generate some hypothetical newborns:</p> <div class="highlight-python notranslate"><div class=highlight ><pre><span></span><span class=n >newborns</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >DataFrame</span><span class=p >(</span>
    <span class=p >{</span>
        <span class=s2 >"smoke"</span><span class=p >:</span> <span class=p >[</span><span class=mi >1</span><span class=p >,</span> <span class=mi >1</span><span class=p >,</span> <span class=mi >0</span><span class=p >,</span> <span class=mi >0</span><span class=p >],</span>
        <span class=s2 >"white"</span><span class=p >:</span> <span class=p >[</span><span class=kc >True</span><span class=p >,</span> <span class=kc >False</span><span class=p >,</span> <span class=kc >True</span><span class=p >,</span> <span class=kc >False</span><span class=p >],</span>
        <span class=s2 >"gestation"</span><span class=p >:</span> <span class=p >[</span><span class=mi >253</span><span class=p >,</span> <span class=mi >300</span><span class=p >,</span> <span class=mi >248</span><span class=p >,</span> <span class=mi >287</span><span class=p >],</span>
        <span class=s2 >"mpregwt"</span><span class=p >:</span> <span class=p >[</span><span class=mi >132</span><span class=p >,</span> <span class=mi >129</span><span class=p >,</span> <span class=mi >140</span><span class=p >,</span> <span class=mi >139</span><span class=p >],</span>
    <span class=p >}</span>
<span class=p >)</span>
</pre></div> </div> <p>Using the model you ran above with gestation, smoke, mpregwt, white, and the interaction of white and smoke, predict birth weights for these newborns. Store your predictions <strong>in a list</strong> under the key <code class="docutils literal notranslate"><span class=pre >"ex7_predictions"</span></code>.</p> <p>Note that if you have different data types from those in this pretend dataset or different column names from those in the dataset you used to fit your model, you’ll get an error—just adjust the column names / data types to match the data you used to fit your model.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[15]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >newborns</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >DataFrame</span><span class=p >(</span>
    <span class=p >{</span>
        <span class=s2 >"smoke"</span><span class=p >:</span> <span class=p >[</span><span class=mi >1</span><span class=p >,</span> <span class=mi >1</span><span class=p >,</span> <span class=mi >0</span><span class=p >,</span> <span class=mi >0</span><span class=p >],</span>
        <span class=s2 >"white"</span><span class=p >:</span> <span class=p >[</span><span class=kc >True</span><span class=p >,</span> <span class=kc >False</span><span class=p >,</span> <span class=kc >True</span><span class=p >,</span> <span class=kc >False</span><span class=p >],</span>
        <span class=s2 >"gestation"</span><span class=p >:</span> <span class=p >[</span><span class=mi >253</span><span class=p >,</span> <span class=mi >300</span><span class=p >,</span> <span class=mi >248</span><span class=p >,</span> <span class=mi >287</span><span class=p >],</span>
        <span class=s2 >"mpregwt"</span><span class=p >:</span> <span class=p >[</span><span class=mi >132</span><span class=p >,</span> <span class=mi >129</span><span class=p >,</span> <span class=mi >140</span><span class=p >,</span> <span class=mi >139</span><span class=p >],</span>
    <span class=p >}</span>
<span class=p >)</span>
</pre></div> </div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[16]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >s_and_bw_model3</span><span class=o >.</span><span class=n >predict</span><span class=p >(</span><span class=n >newborns</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[16]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
0    104.523084
1    119.639155
2    111.208810
3    124.039095
dtype: float64
</pre></div></div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[17]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >results</span><span class=p >[</span><span class=s2 >"ex7_predictions"</span><span class=p >]</span> <span class=o >=</span> <span class=nb >list</span><span class=p >(</span><span class=n >s_and_bw_model3</span><span class=o >.</span><span class=n >predict</span><span class=p >(</span><span class=n >newborns</span><span class=p >))</span>
<span class=n >results</span><span class=p >[</span><span class=s2 >"ex7_predictions"</span><span class=p >]</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[17]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
[104.52308427743274, 119.63915539293482, 111.20881028285342, 124.0390947146367]
</pre></div></div> </div> </section> </section> <section id=statsmodels-versus-R > <h2 id=statsmodels-versus-R >statsmodels versus R<a class=headerlink  href="#statsmodels-versus-R" title="Permalink to this headline">¶</a></h2> <p>A quick but important note: the tools that are made available in different packages is often a function of who uses those packages, and how they use them. By and large, nearly all statisticians use R, and so many stats tools (like automatic forward-model-selection or backwards-model-selection) have “convenience implementations” (single functions that do all the things you’d want to accomplish) in R, but aren’t available as convenience packages in <code class="docutils literal notranslate"><span class=pre >statsmodels</span></code>. That’s because <code class="docutils literal notranslate"><span class=pre >statsmodels</span></code> was mostly written by economists and social scientists who tend to feel model selection should be a function of theory not statistical performance (not taking sides: just reporting a difference that exists).</p> <p>To be clear, you can still implement things like forward model selection yourself in Python – just write a loop that tries different regressors and plots the resulting AICs! – but it will often take a little more work. (Indeed, you can find examples of people <a class="reference external" href="https://planspace.org/20150423-forward_selection_with_statsmodels/">writing these loops on the web</a>). And that’s not to say that <code class="docutils literal notranslate"><span class=pre >statsmodels</span></code> doesn’t have a TON of stuff (take a minute to just look over all the <a class="reference external" href="http://www.statsmodels.org/stable/examples/index.html">examples of cool things you can do in statsmodels here</a>). Just don’t be surprised if you ommissions that seem odd given what you see emphasized in stats courses.</p> <p>This is one of the reasons that languages are sticky: once a group of people have invested in adding all the bells and whistles they like to a language, there are good reasons to not move to another language, even if the other language has some advantages. A statistician who likes the basic language organization of Python more than R, for example, may still stay with R because the packages already do everything a statistician wants to do, and so it’s not worth having to re-implement common tasks in a new language.</p> </section> <section id=Logistic-Regression > <h2 id=Logistic-Regression >Logistic Regression<a class=headerlink  href="#Logistic-Regression" title="Permalink to this headline">¶</a></h2> <section id=Exercise-8 > <h3 id=Exercise-8 >Exercise 8<a class=headerlink  href="#Exercise-8" title="Permalink to this headline">¶</a></h3> <p>Now, using statsmodels, evaluate the impact of smoking on the likelihood a child is born prematurely (where “premature” is defined as gestation of <em>less than</em> 252 days).</p> <p>For obvious reasons, <strong>DO NOT USE OUR SUBSET FOR GESTATION GREATER THAN 225 DAYS</strong> from above for this section.</p> <p>For this model, please include mother’s pre-pregnancy weight, smoking status, and whether the mother is White (if you use all the racial categories, the model won’t converge). Please don’t include the interaction we used in the last question. Store the coefficient for smoking in <code class="docutils literal notranslate"><span class=pre >ex8_smoking_coefficient</span></code>.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[18]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >smoking_and_bw</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >read_csv</span><span class=p >(</span>
    <span class=s2 >"https://media.githubusercontent.com/media/"</span>
    <span class=s2 >"nickeubank/MIDS_Data/master/smoking.csv"</span>
<span class=p >)</span>

<span class=n >smoking_and_bw</span><span class=p >[</span><span class=s2 >"premature"</span><span class=p >]</span> <span class=o >=</span> <span class=p >(</span><span class=n >smoking_and_bw</span><span class=p >[</span><span class=s2 >"gestation"</span><span class=p >]</span> <span class=o >&lt;</span> <span class=mi >252</span><span class=p >)</span><span class=o >.</span><span class=n >astype</span><span class=p >(</span><span class=s2 >"int"</span><span class=p >)</span>
<span class=n >smoking_and_bw</span> <span class=o >=</span> <span class=n >smoking_and_bw</span><span class=o >.</span><span class=n >rename</span><span class=p >({</span><span class=s2 >"bwt.oz"</span><span class=p >:</span> <span class=s2 >"bwt_oz"</span><span class=p >},</span> <span class=n >axis</span><span class=o >=</span><span class=s2 >"columns"</span><span class=p >)</span>
<span class=n >smoking_and_bw</span><span class=p >[</span><span class=s2 >"white"</span><span class=p >]</span> <span class=o >=</span> <span class=p >(</span><span class=n >smoking_and_bw</span><span class=p >[</span><span class=s2 >"mrace"</span><span class=p >]</span> <span class=o >&gt;=</span> <span class=mi >0</span><span class=p >)</span> <span class=o >&amp;</span> <span class=p >(</span><span class=n >smoking_and_bw</span><span class=p >[</span><span class=s2 >"mrace"</span><span class=p >]</span> <span class=o >&lt;</span> <span class=mi >6</span><span class=p >)</span>
<span class=n >smoking_and_bw</span><span class=o >.</span><span class=n >columns</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[18]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Index(['id', 'date', 'gestation', 'bwt_oz', 'parity', 'mrace', 'mage', 'med',
       'mht', 'mpregwt', 'inc', 'smoke', 'premature', 'white'],
      dtype='object')
</pre></div></div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[19]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >premature_fit</span> <span class=o >=</span> <span class=n >smf</span><span class=o >.</span><span class=n >logit</span><span class=p >(</span><span class=s2 >"premature ~ smoke + white + mpregwt"</span><span class=p >,</span> <span class=n >smoking_and_bw</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Optimization terminated successfully.
         Current function value: 0.187899
         Iterations 7
</pre></div></div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[20]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >premature_fit</span><span class=o >.</span><span class=n >summary</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[20]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <table> <caption>Logit Regression Results</caption> <tr> <th>Dep. Variable: <td>premature <th> No. Observations: <td> 869 <tr> <th>Model: <td>Logit <th> Df Residuals: <td> 865 <tr> <th>Method: <td>MLE <th> Df Model: <td> 3 <tr> <th>Date: <td>Thu, 16 Nov 2023 <th> Pseudo R-squ.: <td>0.04614 <tr> <th>Time: <td>10:33:12 <th> Log-Likelihood: <td> -163.28 <tr> <th>converged: <td>True <th> LL-Null: <td> -171.18 <tr> <th>Covariance Type: <td>nonrobust <th> LLR p-value: <td>0.001248 </table> <table> <tr> <td> <th>coef <th>std err <th>z <th>P&gt;|z| <th>[0.025 <th>0.975] <tr> <th>Intercept <td> -1.5353 <td> 1.024 <td> -1.499 <td> 0.134 <td> -3.542 <td> 0.472 <tr> <th>white[T.True] <td> -1.2247 <td> 0.320 <td> -3.833 <td> 0.000 <td> -1.851 <td> -0.598 <tr> <th>smoke <td> 0.4253 <td> 0.320 <td> 1.331 <td> 0.183 <td> -0.201 <td> 1.052 <tr> <th>mpregwt <td> -0.0070 <td> 0.008 <td> -0.907 <td> 0.364 <td> -0.022 <td> 0.008 </table></div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[21]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >results</span><span class=p >[</span><span class=s2 >"ex8_smoking_coefficient"</span><span class=p >]</span> <span class=o >=</span> <span class=n >premature_fit</span><span class=o >.</span><span class=n >params</span><span class=p >[</span><span class=s2 >"smoke"</span><span class=p >]</span>
</pre></div> </div> </div> <blockquote> <div><p>Smoking appears to increase the likelihood of a premature birth marginally, though the statistical significance of the effect is low, so it may just be a spurious correlation.</p> </div></blockquote> </section> </section> <section id=Weighting > <h2 id=Weighting >Weighting<a class=headerlink  href="#Weighting" title="Permalink to this headline">¶</a></h2> <p>Let’s now try using statsmodels on another dataset.</p> <p>In our merging exercises, we ran a difference-in-difference analysis on crime in California counties to see if, following drug legalization, there was a larger decline in violent crime in counties that had previously also had high drug arrest rates (to test the idea that violence was being generated by the drug trade, and that legalization would decrease this violence).</p> <p>In those analyses, we treated counties as equally-weighted units of analysis. If we think that each county is a single “community”, and we think crime and arrests is shaped at the level of communities (particularly when our community division is related to administrative boundaries that impact policing and government services, and is the case with counties), then this is reasonable.</p> <p>But one might think that crime is determined at the individual level, or maybe neighborhood level, and so big counties should “count more” in our analysis.</p> <p>(More formally, when we are fitting a regression model that picks parameter values to minimize the overall sum of squared errors, maybe we should pick values that to a better job of minimizing the errors for populous counties at the expense of not doing quite as good a job of minimizing the errors for smaller counties)</p> <p>Here, let’s use weighted least squares to weight observations based on population. This will allow bigger counties to influence our estimates more.</p> <section id=Exercise-9 > <h3 id=Exercise-9 >Exercise 9<a class=headerlink  href="#Exercise-9" title="Permalink to this headline">¶</a></h3> <p>To begin, read in our data on California arrest rates and population from <a class="reference external" href="https://github.com/nickeubank/MIDS_Data/blob/master/arrest_rates_and_population.parquet">github</a>. You will see I’ve reshaped the data to long format for convenience. This data is stored as a parquet file.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[22]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >import</span> <span class=nn >pandas</span> <span class=k >as</span> <span class=nn >pd</span>

<span class=n >arrests</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >read_parquet</span><span class=p >(</span>
    <span class=s2 >"https://github.com/nickeubank/MIDS_Data/blob/"</span>
    <span class=s2 >"master/arrest_rates_and_population.parquet?raw=true"</span>
<span class=p >)</span>
</pre></div> </div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[23]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >arrests</span><span class=o >.</span><span class=n >sample</span><span class=p >(</span><span class=mi >10</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[23]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th>variable <th>COUNTY <th>year <th>drug_arrest_rate <th>total_population <th>violent_arrest_rate <tr> <th>68 <td>San Benito County <td>2009 <td>0.002027 <td>54752.0 <td>0.003817 <tr> <th>98 <td>Stanislaus County <td>2009 <td>0.004373 <td>505165.0 <td>0.004377 <tr> <th>81 <td>San Mateo County <td>2018 <td>0.000299 <td>763450.0 <td>0.001853 <tr> <th>102 <td>Tehama County <td>2009 <td>0.007541 <td>60601.0 <td>0.003894 <tr> <th>75 <td>San Francisco County <td>2018 <td>0.000915 <td>864263.0 <td>0.002377 <tr> <th>0 <td>Alameda County <td>2009 <td>0.003946 <td>1457095.0 <td>0.002963 <tr> <th>84 <td>Santa Clara County <td>2009 <td>0.002501 <td>1729378.0 <td>0.002492 <tr> <th>64 <td>Riverside County <td>2009 <td>0.002888 <td>2036304.0 <td>0.002861 <tr> <th>92 <td>Siskiyou County <td>2009 <td>0.004054 <td>44404.0 <td>0.004256 <tr> <th>76 <td>San Joaquin County <td>2009 <td>0.002889 <td>664641.0 <td>0.004849 </table> </div></div> </div> </section> <section id=Exercise-10 > <h3 id=Exercise-10 >Exercise 10<a class=headerlink  href="#Exercise-10" title="Permalink to this headline">¶</a></h3> <p>To run our difference-in-difference in a regression framework, we need both an indicator variable for observations that occur after legalization (i.e. year == 2018), and an indicator for the population we consider treated (those who had drug arrest rates above the average 2009 drug arrest rate). Re-create those here. Remember that your “high drug arrest rate in 2009” variable should only take on a single value for each county (regardless of the year of the observation).</p> <p>As a check, store the number of counties that have a high drug arrest rate in 2009 under the key <code class="docutils literal notranslate"><span class=pre >"ex10_num_high_drug_arrest"</span></code>.</p> <p><em>Note:</em> if you want, you can also use the 2009 drug arrest rates as a continuous variable. This is a kind of “generalized difference-in-difference”, in which we’re just doing the continuous analogue of the thing we do when we split the sample into “high” and “low” 2009 arrest rates.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[24]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=c1 ># Legalization indicator.</span>
<span class=n >arrests</span><span class=p >[</span><span class=s2 >"after_legalization"</span><span class=p >]</span> <span class=o >=</span> <span class=n >arrests</span><span class=o >.</span><span class=n >year</span> <span class=o >==</span> <span class=mi >2018</span>
</pre></div> </div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[25]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=c1 ># Bit of a weird manipulation...</span>

<span class=n >arrests</span> <span class=o >=</span> <span class=n >arrests</span><span class=o >.</span><span class=n >rename</span><span class=p >({</span><span class=s2 >"drug_arrest_rate"</span><span class=p >:</span> <span class=s2 >"drug_arrest_rate_2009"</span><span class=p >},</span> <span class=n >axis</span><span class=o >=</span><span class=s2 >"columns"</span><span class=p >)</span>
<span class=n >arrests</span><span class=o >.</span><span class=n >loc</span><span class=p >[</span><span class=n >arrests</span><span class=o >.</span><span class=n >year</span> <span class=o >==</span> <span class=mi >2018</span><span class=p >,</span> <span class=s2 >"drug_arrest_rate_2009"</span><span class=p >]</span> <span class=o >=</span> <span class=n >np</span><span class=o >.</span><span class=n >nan</span>

<span class=c1 ># Propagate 2009 values across observations in both time periods.</span>
<span class=n >arrests</span><span class=p >[</span><span class=s2 >"drug_arrest_rate_2009"</span><span class=p >]</span> <span class=o >=</span> <span class=n >arrests</span><span class=o >.</span><span class=n >groupby</span><span class=p >(</span><span class=s2 >"COUNTY"</span><span class=p >)[</span>
    <span class=p >[</span><span class=s2 >"drug_arrest_rate_2009"</span><span class=p >]</span>
<span class=p >]</span><span class=o >.</span><span class=n >transform</span><span class=p >(</span><span class=nb >max</span><span class=p >)</span>

<span class=n >arrests</span><span class=p >[</span><span class=s2 >"high_2009_drug_arrest_rate"</span><span class=p >]</span> <span class=o >=</span> <span class=p >(</span>
    <span class=n >arrests</span><span class=p >[</span><span class=s2 >"drug_arrest_rate_2009"</span><span class=p >]</span> <span class=o >&gt;</span> <span class=n >arrests</span><span class=p >[</span><span class=s2 >"drug_arrest_rate_2009"</span><span class=p >]</span><span class=o >.</span><span class=n >mean</span><span class=p >()</span>
<span class=p >)</span>
</pre></div> </div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[26]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >arrests</span><span class=o >.</span><span class=n >head</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[26]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th>variable <th>COUNTY <th>year <th>drug_arrest_rate_2009 <th>total_population <th>violent_arrest_rate <th>after_legalization <th>high_2009_drug_arrest_rate <tr> <th>0 <td>Alameda County <td>2009 <td>0.003946 <td>1457095.0 <td>0.002963 <td>False <td>True <tr> <th>1 <td>Alameda County <td>2018 <td>0.003946 <td>1629615.0 <td>0.002536 <td>True <td>True <tr> <th>2 <td>Alpine County <td>2009 <td>0.001735 <td>1153.0 <td>0.006938 <td>False <td>False <tr> <th>3 <td>Alpine County <td>2018 <td>0.001735 <td>1203.0 <td>0.004156 <td>True <td>False <tr> <th>4 <td>Amador County <td>2009 <td>0.002655 <td>38039.0 <td>0.002629 <td>False <td>False </table> </div></div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[27]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >results</span><span class=p >[</span><span class=s2 >"ex10_num_high_drug_arrest"</span><span class=p >]</span> <span class=o >=</span> <span class=n >arrests</span><span class=o >.</span><span class=n >loc</span><span class=p >[</span>
    <span class=n >arrests</span><span class=p >[</span><span class=s2 >"high_2009_drug_arrest_rate"</span><span class=p >],</span> <span class=s2 >"COUNTY"</span>
<span class=p >]</span><span class=o >.</span><span class=n >nunique</span><span class=p >()</span>
<span class=n >results</span><span class=p >[</span><span class=s2 >"ex10_num_high_drug_arrest"</span><span class=p >]</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[27]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
23
</pre></div></div> </div> </section> <section id=Exercise-11 > <h3 id=Exercise-11 >Exercise 11<a class=headerlink  href="#Exercise-11" title="Permalink to this headline">¶</a></h3> <p>Now regression the violent arrest rate on your two indicators and their interaction. The coefficient on the interaction is your “difference-in-difference” estimate! If you go back to your old homeworks, you should find the coefficient is exactly what you calculated. Store this coefficient under the key <code class="docutils literal notranslate"><span class=pre >"ex11_diff_in_diff"</span></code>.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[37]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >arrests</span><span class=o >.</span><span class=n >high_2009_drug_arrest_rate</span><span class=o >.</span><span class=n >describe</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[37]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
count       116
unique        2
top       False
freq         70
Name: high_2009_drug_arrest_rate, dtype: object
</pre></div></div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[29]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=c1 ># Here's with the discrete split of the sample</span>
<span class=n >arrest_model</span> <span class=o >=</span> <span class=n >smf</span><span class=o >.</span><span class=n >ols</span><span class=p >(</span>
    <span class=s2 >"violent_arrest_rate ~ high_2009_drug_arrest_rate "</span>
    <span class=s2 >"+ after_legalization + after_legalization:high_2009_drug_arrest_rate"</span><span class=p >,</span>
    <span class=n >arrests</span><span class=p >,</span>
<span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=n >arrest_model</span><span class=o >.</span><span class=n >summary</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[29]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <table> <caption>OLS Regression Results</caption> <tr> <th>Dep. Variable: <td>violent_arrest_rate <th> R-squared: <td> 0.100 <tr> <th>Model: <td>OLS <th> Adj. R-squared: <td> 0.076 <tr> <th>Method: <td>Least Squares <th> F-statistic: <td> 4.166 <tr> <th>Date: <td>Thu, 16 Nov 2023 <th> Prob (F-statistic): <td>0.00773 <tr> <th>Time: <td>10:33:13 <th> Log-Likelihood: <td> 630.00 <tr> <th>No. Observations: <td> 116 <th> AIC: <td> -1252. <tr> <th>Df Residuals: <td> 112 <th> BIC: <td> -1241. <tr> <th>Df Model: <td> 3 <th> <td> <tr> <th>Covariance Type: <td>nonrobust <th> <td> </table> <table> <tr> <td> <th>coef <th>std err <th>t <th>P&gt;|t| <th>[0.025 <th>0.975] <tr> <th>Intercept <td> 0.0034 <td> 0.000 <td> 18.669 <td> 0.000 <td> 0.003 <td> 0.004 <tr> <th>high_2009_drug_arrest_rate[T.True] <td> 0.0008 <td> 0.000 <td> 2.679 <td> 0.008 <td> 0.000 <td> 0.001 <tr> <th>after_legalization[T.True] <td> -0.0002 <td> 0.000 <td> -0.716 <td> 0.475 <td> -0.001 <td> 0.000 <tr> <th>after_legalization[T.True]:high_2009_drug_arrest_rate[T.True] <td> -0.0002 <td> 0.000 <td> -0.604 <td> 0.547 <td> -0.001 <td> 0.001 </table> <table> <tr> <th>Omnibus: <td>24.084 <th> Durbin-Watson: <td> 1.239 <tr> <th>Prob(Omnibus): <td> 0.000 <th> Jarque-Bera (JB): <td> 33.273 <tr> <th>Skew: <td> 1.057 <th> Prob(JB): <td>5.95e-08 <tr> <th>Kurtosis: <td> 4.554 <th> Cond. No. <td> 6.40 </table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[30]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >results</span><span class=p >[</span><span class=s2 >"ex11_diff_in_diff"</span><span class=p >]</span> <span class=o >=</span> <span class=n >arrest_model</span><span class=o >.</span><span class=n >params</span><span class=p >[</span>
    <span class=s2 >"after_legalization[T.True]:high_2009_drug_arrest_rate[T.True]"</span>
<span class=p >]</span>
<span class=n >results</span><span class=p >[</span><span class=s2 >"ex11_diff_in_diff"</span><span class=p >]</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[30]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
-0.00024739378861355764
</pre></div></div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[31]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=c1 ># And here's with the the continuous variable</span>
<span class=c1 ># Note that interpretation of the magnitude of that coefficient is a little harder,</span>
<span class=c1 ># as you have to evaluate it at reasonable values of drug_arrest_rate_2009.</span>
<span class=n >continuous_arrest_model</span> <span class=o >=</span> <span class=n >smf</span><span class=o >.</span><span class=n >ols</span><span class=p >(</span>
    <span class=s2 >"violent_arrest_rate ~ drug_arrest_rate_2009 + after_legalization "</span>
    <span class=s2 >"+ after_legalization:drug_arrest_rate_2009"</span><span class=p >,</span>
    <span class=n >arrests</span><span class=p >,</span>
<span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=n >continuous_arrest_model</span><span class=o >.</span><span class=n >summary</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[31]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <table> <caption>OLS Regression Results</caption> <tr> <th>Dep. Variable: <td>violent_arrest_rate <th> R-squared: <td> 0.067 <tr> <th>Model: <td>OLS <th> Adj. R-squared: <td> 0.042 <tr> <th>Method: <td>Least Squares <th> F-statistic: <td> 2.674 <tr> <th>Date: <td>Thu, 16 Nov 2023 <th> Prob (F-statistic): <td>0.0508 <tr> <th>Time: <td>10:33:13 <th> Log-Likelihood: <td> 627.87 <tr> <th>No. Observations: <td> 116 <th> AIC: <td> -1248. <tr> <th>Df Residuals: <td> 112 <th> BIC: <td> -1237. <tr> <th>Df Model: <td> 3 <th> <td> <tr> <th>Covariance Type: <td>nonrobust <th> <td> </table> <table> <tr> <td> <th>coef <th>std err <th>t <th>P&gt;|t| <th>[0.025 <th>0.975] <tr> <th>Intercept <td> 0.0029 <td> 0.000 <td> 8.367 <td> 0.000 <td> 0.002 <td> 0.004 <tr> <th>after_legalization[T.True] <td> 0.0003 <td> 0.000 <td> 0.599 <td> 0.551 <td> -0.001 <td> 0.001 <tr> <th>drug_arrest_rate_2009 <td> 0.2409 <td> 0.100 <td> 2.399 <td> 0.018 <td> 0.042 <td> 0.440 <tr> <th>after_legalization[T.True]:drug_arrest_rate_2009 <td> -0.1818 <td> 0.142 <td> -1.280 <td> 0.203 <td> -0.463 <td> 0.100 </table> <table> <tr> <th>Omnibus: <td>19.333 <th> Durbin-Watson: <td> 1.161 <tr> <th>Prob(Omnibus): <td> 0.000 <th> Jarque-Bera (JB): <td> 23.764 <tr> <th>Skew: <td> 0.941 <th> Prob(JB): <td>6.92e-06 <tr> <th>Kurtosis: <td> 4.174 <th> Cond. No. <td>1.82e+03 </table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The condition number is large, 1.82e+03. This might indicate that there are<br/>strong multicollinearity or other numerical problems.</div> </div> </section> <section id=Exercise-12 > <h3 id=Exercise-12 >Exercise 12<a class=headerlink  href="#Exercise-12" title="Permalink to this headline">¶</a></h3> <p>Now let’s do the same analysis, but this time using county population as a weight in a Weighted Least Squares regression (<code class="docutils literal notranslate"><span class=pre >smf.wls</span></code>). Just pass the keyword argument <code class="docutils literal notranslate"><span class=pre >weights</span></code> as a vector to weights (in this case, <code class="docutils literal notranslate"><span class=pre >arrests['total_population']</span></code>). Note that the <code class="docutils literal notranslate"><span class=pre >weights</span></code> argument is <em>outside</em> the formula, so you have to pass an actual vector of values, not just the name of a column.</p> <p>Does your interpretation of the effects of drug legalization change? Store the new difference-in-difference coefficient under the key <code class="docutils literal notranslate"><span class=pre >"ex12_diff_in_diff_weighted"</span></code>.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[32]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >weighted_arrest_model</span> <span class=o >=</span> <span class=n >smf</span><span class=o >.</span><span class=n >wls</span><span class=p >(</span>
    <span class=s2 >"violent_arrest_rate ~ high_2009_drug_arrest_rate"</span>
    <span class=s2 >"+ after_legalization + after_legalization:high_2009_drug_arrest_rate"</span><span class=p >,</span>
    <span class=n >data</span><span class=o >=</span><span class=n >arrests</span><span class=p >,</span>
    <span class=n >weights</span><span class=o >=</span><span class=n >arrests</span><span class=p >[</span><span class=s2 >"total_population"</span><span class=p >],</span>
<span class=p >)</span>
<span class=n >weighted_arrest_model</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span><span class=o >.</span><span class=n >summary</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[32]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <table> <caption>WLS Regression Results</caption> <tr> <th>Dep. Variable: <td>violent_arrest_rate <th> R-squared: <td> 0.396 <tr> <th>Model: <td>WLS <th> Adj. R-squared: <td> 0.380 <tr> <th>Method: <td>Least Squares <th> F-statistic: <td> 24.52 <tr> <th>Date: <td>Thu, 16 Nov 2023 <th> Prob (F-statistic): <td>2.86e-12 <tr> <th>Time: <td>10:33:13 <th> Log-Likelihood: <td> 608.13 <tr> <th>No. Observations: <td> 116 <th> AIC: <td> -1208. <tr> <th>Df Residuals: <td> 112 <th> BIC: <td> -1197. <tr> <th>Df Model: <td> 3 <th> <td> <tr> <th>Covariance Type: <td>nonrobust <th> <td> </table> <table> <tr> <td> <th>coef <th>std err <th>t <th>P&gt;|t| <th>[0.025 <th>0.975] <tr> <th>Intercept <td> 0.0028 <td> 0.000 <td> 21.484 <td> 0.000 <td> 0.003 <td> 0.003 <tr> <th>high_2009_drug_arrest_rate[T.True] <td> 0.0011 <td> 0.000 <td> 5.938 <td> 0.000 <td> 0.001 <td> 0.001 <tr> <th>after_legalization[T.True] <td> -0.0004 <td> 0.000 <td> -1.972 <td> 0.051 <td> -0.001 <td> 1.76e-06 <tr> <th>after_legalization[T.True]:high_2009_drug_arrest_rate[T.True] <td> -0.0003 <td> 0.000 <td> -1.171 <td> 0.244 <td> -0.001 <td> 0.000 </table> <table> <tr> <th>Omnibus: <td> 6.397 <th> Durbin-Watson: <td> 1.073 <tr> <th>Prob(Omnibus): <td> 0.041 <th> Jarque-Bera (JB): <td> 10.179 <tr> <th>Skew: <td> 0.125 <th> Prob(JB): <td> 0.00616 <tr> <th>Kurtosis: <td> 4.429 <th> Cond. No. <td> 7.31 </table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[33]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >results</span><span class=p >[</span><span class=s2 >"ex12_diff_in_diff_weighted"</span><span class=p >]</span> <span class=o >=</span> <span class=n >weighted_arrest_model</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span><span class=o >.</span><span class=n >params</span><span class=p >[</span>
    <span class=s2 >"after_legalization[T.True]:high_2009_drug_arrest_rate[T.True]"</span>
<span class=p >]</span>
<span class=n >results</span><span class=p >[</span><span class=s2 >"ex12_diff_in_diff_weighted"</span><span class=p >]</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[33]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
-0.0002883709530635656
</pre></div></div> </div> <blockquote> <div><p>Not substantively really different.</p> </div></blockquote> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[34]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=nb >set</span><span class=p >(</span><span class=n >results</span><span class=o >.</span><span class=n >keys</span><span class=p >())</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[34]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
{'ex10_num_high_drug_arrest',
 'ex11_diff_in_diff',
 'ex12_diff_in_diff_weighted',
 'ex2_birth_weight_lower',
 'ex3_smoking_coefficient',
 'ex4_smoking_coefficient',
 'ex6_compare_white_black',
 'ex6_compare_white_black_tstat',
 'ex7_predictions',
 'ex8_smoking_coefficient'}
</pre></div></div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[35]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=k >assert</span> <span class=nb >set</span><span class=p >(</span><span class=n >results</span><span class=o >.</span><span class=n >keys</span><span class=p >())</span> <span class=o >==</span> <span class=p >{</span>
    <span class=s2 >"ex10_num_high_drug_arrest"</span><span class=p >,</span>
    <span class=s2 >"ex11_diff_in_diff"</span><span class=p >,</span>
    <span class=s2 >"ex12_diff_in_diff_weighted"</span><span class=p >,</span>
    <span class=s2 >"ex2_birth_weight_lower"</span><span class=p >,</span>
    <span class=s2 >"ex3_smoking_coefficient"</span><span class=p >,</span>
    <span class=s2 >"ex4_smoking_coefficient"</span><span class=p >,</span>
    <span class=s2 >"ex6_compare_white_black"</span><span class=p >,</span>
    <span class=s2 >"ex6_compare_white_black_tstat"</span><span class=p >,</span>
    <span class=s2 >"ex7_predictions"</span><span class=p >,</span>
    <span class=s2 >"ex8_smoking_coefficient"</span><span class=p >,</span>
<span class=p >}</span>
</pre></div> </div> </div> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[36]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >import</span> <span class=nn >json</span>

<span class=k >with</span> <span class=nb >open</span><span class=p >(</span><span class=s2 >"autograder/solutions.json"</span><span class=p >,</span> <span class=s2 >"w"</span><span class=p >)</span> <span class=k >as</span> <span class=n >outfile</span><span class=p >:</span>
    <span class=n >json</span><span class=o >.</span><span class=n >dump</span><span class=p >(</span><span class=n >results</span><span class=p >,</span> <span class=n >outfile</span><span class=p >)</span>
</pre></div> </div> </div> </section> </section> </section> </article> </div> </div> </main> </div> <footer class=md-footer > <div class=md-footer-nav > <nav class="md-footer-nav__inner md-grid"> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright > <div class=md-footer-copyright__highlight > &#169; Copyright 2021, Nick Eubank. </div> Created using <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.5.0. and <a href="https://github.com/bashtage/sphinx-material/">Material for Sphinx</a> </div> </div> </div> </footer> <script src="../_static/javascripts/application.js"></script> <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>