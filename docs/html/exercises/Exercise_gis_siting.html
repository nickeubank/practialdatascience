<!DOCTYPE html> <meta charset=utf-8  /> <meta name=viewport  content="width=device-width, initial-scale=1.0" /><meta name=generator  content="Docutils 0.17.1: http://docutils.sourceforge.net/" /> <meta name=viewport  content="width=device-width,initial-scale=1"> <meta http-equiv=x-ua-compatible  content="ie=edge"> <meta name="lang:clipboard.copy" content="Copy to clipboard"> <meta name="lang:clipboard.copied" content="Copied to clipboard"> <meta name="lang:search.language" content=en > <meta name="lang:search.pipeline.stopwords" content=True > <meta name="lang:search.pipeline.trimmer" content=True > <meta name="lang:search.result.none" content="No matching documents"> <meta name="lang:search.result.one" content="1 matching document"> <meta name="lang:search.result.other" content="# matching documents"> <meta name="lang:search.tokenizer" content="[\s\-]+"> <link href="https://fonts.gstatic.com/" rel=preconnect  crossorigin> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel=stylesheet > <style> body, input { font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif } code, kbd, pre { font-family: "Roboto Mono", "Courier New", Courier, monospace } </style> <link rel=stylesheet  href="../_static/stylesheets/application.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-palette.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-fixes.css"/> <link rel=stylesheet  href="../_static/fonts/material-icons.css"/> <meta name=theme-color  content="#2196f3"> <script src="../_static/javascripts/modernizr.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-XX133829453-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-XX133829453-1'); </script> <title>Locating a New Grocery Store &#8212; Practical Data Science</title> <link rel=stylesheet  type="text/css" href="../_static/pygments.css" /> <link rel=stylesheet  type="text/css" href="../_static/material.css" /> <script data-url_root="../" id=documentation_options  src="../_static/documentation_options.js"></script> <script src="../_static/jquery.js"></script> <script src="../_static/underscore.js"></script> <script src="../_static/doctools.js"></script> <script crossorigin=anonymous  integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script> <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script> <script defer=defer  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <link rel="shortcut icon" href="../_static/mids_logo.svg"/> <link rel=index  title=Index  href="../genindex.html" /> <link rel=search  title=Search  href="../search.html" /> <body dir=ltr data-md-color-primary=blue-grey data-md-color-accent=blue> <svg class=md-svg > <defs data-children-count=0 > <svg xmlns="http://www.w3.org/2000/svg" width=416  height=448  viewBox="0 0 416 448" id=__github ><path fill=currentColor  d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle  data-md-toggle=drawer  type=checkbox  id=__drawer > <input class=md-toggle  data-md-toggle=search  type=checkbox  id=__search > <label class=md-overlay  data-md-component=overlay  for=__drawer ></label> <a href="#exercises/Exercise_gis_siting" tabindex=1  class=md-skip > Skip to content </a> <header class=md-header  data-md-component=header > <nav class="md-header-nav md-grid"> <div class="md-flex navheader"> <div class="md-flex__cell md-flex__cell--shrink"> <a href="../index.html" title="Practical Data Science" class="md-header-nav__button md-logo"> <img src="../_static/mids_logo.svg" height=26  alt="Practical Data Science logo"> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer ></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title > <span class=md-header-nav__topic >Practical Data Science</span> <span class=md-header-nav__topic > Locating a New Grocery Store </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search ></label> <div class=md-search  data-md-component=search  role=dialog > <label class=md-search__overlay  for=__search ></label> <div class=md-search__inner  role=search > <form class=md-search__form  action="../search.html" method=get  name=search > <input type=text  class=md-search__input  name=q  placeholder=Search  autocapitalize=off  autocomplete=off  spellcheck=false  data-md-component=query  data-md-state=active > <label class="md-icon md-search__icon" for=__search ></label> <button type=reset  class="md-icon md-search__icon" data-md-component=reset  tabindex=-1 > &#xE5CD; </button> </form> <div class=md-search__output > <div class=md-search__scrollwrap  data-md-scrollfix> <div class=md-search-result  data-md-component=result > <div class=md-search-result__meta > Type to start searching </div> <ol class=md-search-result__list ></ol> </div> </div> </div> </div> </div> </div> <script src="../_static/javascripts/version_dropdown.js"></script> <script> var json_loc = "../"versions.json"", target_loc = "../../", text = "Versions"; $( document ).ready( add_version_dropdown(json_loc, target_loc, text)); </script> </div> </nav> </header> <div class=md-container > <nav class=md-tabs  data-md-component=tabs > <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list > <li class=md-tabs__item ><a href="../index.html" class=md-tabs__link >Home</a> <li class=md-tabs__item ><a href="../class_schedule.html" class=md-tabs__link >Class Schedule</a> <li class=md-tabs__item ><a href="../topic_list.html" class=md-tabs__link >Topic List</a> <li class=md-tabs__item ><a href="https://www.nickeubank.com" class=md-tabs__link >About The Author</a> </ul> </div> </nav> <main class=md-main > <div class="md-main__inner md-grid" data-md-component=container > <div class="md-sidebar md-sidebar--primary" data-md-component=navigation > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--primary" data-md-level=0 > <label class="md-nav__title md-nav__title--site" for=__drawer > <a href="../index.html" title="Practical Data Science" class="md-nav__button md-logo"> <img src="../_static/mids_logo.svg" alt=" logo" width=48  height=48 > </a> <a href="../index.html" title="Practical Data Science">Practical Data Science</a> </label> <ul class=md-nav__list > <li class=md-nav__item > <a href="../class_schedule.html" class=md-nav__link >Class Schedule</a> <li class=md-nav__item > <a href="../autograder_guidelines.html" class=md-nav__link >Autograder Guidelines</a> <li class=md-nav__item > <a href="../not_a_mids_student.html" class=md-nav__link >Not a MIDS Student?</a> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >Contents</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#exercises-exercise-gis-siting--page-root" class=md-nav__link >Locating a New Grocery Store</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exercise-1" class=md-nav__link >Exercise 1</a> <li class=md-nav__item ><a href="#Exercise-2" class=md-nav__link >Exercise 2</a> <li class=md-nav__item ><a href="#Exercise-3" class=md-nav__link >Exercise 3</a> <li class=md-nav__item ><a href="#Exercise-4" class=md-nav__link >Exercise 4</a> <li class=md-nav__item ><a href="#Exercise-5" class=md-nav__link >Exercise 5</a> <li class=md-nav__item ><a href="#Exercise-6" class=md-nav__link >Exercise 6</a> <li class=md-nav__item ><a href="#Exercise-7" class=md-nav__link >Exercise 7</a> <li class=md-nav__item ><a href="#Exercise-8" class=md-nav__link >Exercise 8</a> <li class=md-nav__item ><a href="#Exercise-9" class=md-nav__link >Exercise 9</a> <li class=md-nav__item ><a href="#Exercise-10" class=md-nav__link >Exercise 10</a> <li class=md-nav__item ><a href="#Exercise-11" class=md-nav__link >Exercise 11</a> <li class=md-nav__item ><a href="#Exercise-12" class=md-nav__link >Exercise 12</a> <li class=md-nav__item ><a href="#Exercise-13" class=md-nav__link >Exercise 13</a> </ul> </nav> </ul> </nav> </div> </div> </div> <div class=md-content > <article class="md-content__inner md-typeset" role=main > <section id=Locating-a-New-Grocery-Store > <h1 id=exercises-exercise-gis-siting--page-root >Locating a New Grocery Store<a class=headerlink  href="#exercises-exercise-gis-siting--page-root" title="Permalink to this headline">¶</a></h1> <p>Congratulations! You’ve been hired by Whole Foods to help them identify potential locations for a new store in New York.</p> <p>To aid in your analysis, we will be working with a dataset of <em>all</em> retail food stores in New York provided by the NY Department of Agriculture and Markets. The source for the <a class="reference external" href="https://data.ny.gov/Economic-Development/Retail-Food-Stores/9a8c-vfzj">data is here</a>, but please work from the copy of the <a class="reference external" href="https://github.com/nickeubank/practicaldatascience/blob/master/Example_Data/gis_siting/ny_retail_food.zip">data here</a>. We will use this data to identify areas that are under-served by grocery stores today (e.g. to find market opportunities).</p> <p>Of course, it’s not enough to know where grocery stores currently are or are not – if it were, we could just advise our client to put some grocery stores out in the middle of no where! So we’ll also be using some demographic data from the US American Communities Survey (downloaded from NHGIS). You can find that <a class="reference external" href="https://github.com/nickeubank/practicaldatascience/blob/master/Example_Data/gis_siting/ny_census_blockgroups_2019.zip">data here</a>. This is all public data, and as such is not nearly as detailed as data you can buy from marketing professionals, but even so you’ll see we can get a lot of value from it.</p> <section id=Exercise-1 > <h2 id=Exercise-1 >Exercise 1<a class=headerlink  href="#Exercise-1" title="Permalink to this headline">¶</a></h2> <p>Please download, import, and plot both datasets.</p> </section> <section id=Exercise-2 > <h2 id=Exercise-2 >Exercise 2<a class=headerlink  href="#Exercise-2" title="Permalink to this headline">¶</a></h2> <p>Let’s begin by establishing where our CURRENT Whole Foods stores are located. Please create a new GeoDataFrame consisting of all Whole Foods locations in New York. How many Whole Foods are there currently in New York? Where are they predominantly located?</p> <p>If you have questions about the variables in the NY retail food database, you can find all the documentation provided by the NY State Department of Agriculture and Markets <a class="reference external" href="https://github.com/nickeubank/practicaldatascience/tree/master/Example_Data/gis_siting">in this folder</a>.</p> </section> <section id=Exercise-3 > <h2 id=Exercise-3 >Exercise 3<a class=headerlink  href="#Exercise-3" title="Permalink to this headline">¶</a></h2> <p>Now let’s create a GeoDataFrame with competing grocery stores. In the NY area, we’ll limit attention to Walmart (hint – there are a lot of walmarts), ACME Markets (Albertson’s), Trader Joe’s, ALDI, and any stores identifying themselves as supermarkets or super markets. Grocery, as a search term, catches a lot of delis and bodegas, which aren’t really in competition with Whole Foods.</p> <p>(Note that in a real analysis, you’d want to be a little more careful to include any other non-chain grocery stores!)</p> </section> <section id=Exercise-4 > <h2 id=Exercise-4 >Exercise 4<a class=headerlink  href="#Exercise-4" title="Permalink to this headline">¶</a></h2> <p>Now comes the fun part!</p> <p>In the census data we loaded previously, we have information on the population, average income, and average education for every census block group (a “block group” is an official level of aggregation) in New York. But we <em>don’t</em> know how close those people are to an existing grocery store! So let’s use the data we’ve now created to gather information about what communities may currently be under-served by local grocery stores!</p> <p>The first thing we want to do is rule out locations near existing Whole Foods.</p> <p>Using <code class="docutils literal notranslate"><span class=pre >sjoin_nearest</span></code>, find the closest <em>Whole Foods</em> to every census block group. Also use the <code class="docutils literal notranslate"><span class=pre >distance_col</span></code> keyword argument (you can use <code class="docutils literal notranslate"><span class=pre >sjoin_nearest?</span></code> to read about it) to get the actual distance to said nearest Whole Foods.</p> <p>Note that distance you get from this operation will be in meters because of how our data is being represented (it’s projection – something we’ll read about for our second GIS class).</p> <p>Also note that we’re getting the distance to the nearest Whole Foods <em>from each census block group</em>, which are polygons. geopandas is smart enough to calculate the <em>shortest</em> distance from the polygon (i.e. the distance from the point on the polygon edge that is closest to the Whole Foods!).</p> </section> <section id=Exercise-5 > <h2 id=Exercise-5 >Exercise 5<a class=headerlink  href="#Exercise-5" title="Permalink to this headline">¶</a></h2> <p>Let’s start building a dataset of possible grocery locations. First, let’s drop any census block groups that aren’t urban (Whole Foods are really an urban company). To do so, calculate the population density of each census block group and drop any census block groups with population densities below 100 people per square kilometer (bearing in mind that the units of this map are meters, so <code class="docutils literal notranslate"><span class=pre >.area</span></code> will return an area in meters squared).</p> </section> <section id=Exercise-6 > <h2 id=Exercise-6 >Exercise 6<a class=headerlink  href="#Exercise-6" title="Permalink to this headline">¶</a></h2> <p>Now drop any block groups that are already less than 8 km from a Whole Foods.</p> </section> <section id=Exercise-7 > <h2 id=Exercise-7 >Exercise 7<a class=headerlink  href="#Exercise-7" title="Permalink to this headline">¶</a></h2> <p>Now, for each remaining block group, calculate the distance to the nearest NON-Whole Foods. What does the distribution of those distances look like?</p> <p>NOTE: When geopandas finds multiple observations at the same distance, it will keep them all. That can cause problems here – because there may be MULTIPLE competitors in the same block group you can end up with block groups being duplicated. Since we only care about the <em>distance</em> to the nearest competitor (not whether there are multiple at distance 0), drop these duplicates. Your observations should be unique on <code class="docutils literal notranslate"><span class=pre >["STATEFP",</span> <span class=pre >"COUNTYFP",</span> <span class=pre >"TRACTCE",</span> <span class=pre >"BLKGRPCE"]</span></code>.</p> </section> <section id=Exercise-8 > <h2 id=Exercise-8 >Exercise 8<a class=headerlink  href="#Exercise-8" title="Permalink to this headline">¶</a></h2> <p>We’re now close to identifying places that are urban, not too close to an existing Whole Foods, and not too close to an existing competitor! We’re almost there!</p> <p>But before we filter on distance to the nearest competitor, let’s also think about what a Whole Foods customer looks like. If this were a real consulting gig, we could ask Whole Foods for data on their current customers, but for the moment let’s just assert that they tend to be wealthy and highly educated.</p> <p>Our census data already has a variable with median household income (<code class="docutils literal notranslate"><span class=pre >md_hh_inc</span></code>). Now also construct a variable the gives us the share of people over 25 in each Block Group that have at least a Bachelors Degree. This will entail using the variables that start with <code class="docutils literal notranslate"><span class=pre >ALWG</span></code> along with information from the codebook we referenced before.</p> </section> <section id=Exercise-9 > <h2 id=Exercise-9 >Exercise 9<a class=headerlink  href="#Exercise-9" title="Permalink to this headline">¶</a></h2> <p>Great! At this point, we have four variables we’re selecting on: share with college, median household income, distance to nearest competitor, and distance to nearest Whole Foods. These’s no obvious way to balance these considerations, but for the moment let’s look for places where the share of people with college degrees is over 50%, median household income is over $90,000, and the nearest competitor’s grocery store is more than 8km away, and the nearest Whole Foods is over 8km away.</p> <p>Using these filters, can you identify any counties that seem like especially good candidates (e.g. counties with a fair number of people in census block groups that fit our criteria?)</p> </section> <section id=Exercise-10 > <h2 id=Exercise-10 >Exercise 10<a class=headerlink  href="#Exercise-10" title="Permalink to this headline">¶</a></h2> <p>Great work! We’ve found some candidates!</p> <p>However, it’s worth noting that we have been a little crude here in a couple ways. First, obviously, in the real world we’d want more information on what demographic features best predict someone being a Whole Foods customer so we can put some weights on these various filters we’re applying.</p> <p>But looking at distance to the <em>nearest</em> grocery store is also a bit of a crude approach to understanding potential customer’s grocery access. So let’s take a new approach!</p> <p>Rather than measuring the distance to the nearest grocery story, let’s look at the number of grocery stores within 15km of each block group.</p> <p>To do this, we’ll begin by using <code class="docutils literal notranslate"><span class=pre >buffer()</span></code> to expand each block group outward by the buffered distance. Then we can do a spatial join of these <em>expanded</em> polygons with our “other grocer” dataset.</p> <p>To begin, buffer your block groups by 15 kilometers and set the new buffered polygons as your GeoDataFrame’s “offical geometry”</p> </section> <section id=Exercise-11 > <h2 id=Exercise-11 >Exercise 11<a class=headerlink  href="#Exercise-11" title="Permalink to this headline">¶</a></h2> <p>Now merge your buffered polygons with your GeoDataFrame of other grocers.</p> </section> <section id=Exercise-12 > <h2 id=Exercise-12 >Exercise 12<a class=headerlink  href="#Exercise-12" title="Permalink to this headline">¶</a></h2> <p>Now we have a dataset where we have one row for every (block-group) x (grocer within 15km) combination, so the next thing we have to do is collapse our data back down to the block-group level. So let’s groupby our data to get the COUNT of competitors within 15km.</p> <p>Bear in mind that each block group is unique identified by <code class="docutils literal notranslate"><span class=pre >"STATEFP",</span> <span class=pre >"COUNTYFP",</span> <span class=pre >"TRACTCE",</span> <span class=pre >"BLKGRPCE"</span></code>. Also note you won’t be able to groupby with your geometry columns in there, so you’ll need to do a groupby with a subset of columns, then merge your results back in.</p> </section> <section id=Exercise-13 > <h2 id=Exercise-13 >Exercise 13<a class=headerlink  href="#Exercise-13" title="Permalink to this headline">¶</a></h2> <p>Now let’s try using the same filter we used before, but this time subsetting for census block groups with <em>less than three competitors</em> within 15km <em>and</em> no competitors within 5km.</p> <p>So:</p> <ul class=simple > <li><p>college degrees is over 50%,</p> <li><p>median household income is over $90,000,</p> <li><p>nearest competitor’s grocery store is more than 5km away,</p> <li><p>the nearest Whole Foods is over 5km away,</p> <li><p>less than 3 competitors within 15km.</p> </ul> <p>What counties seem like the most plausible new locations now?</p> </section> </section> </article> </div> </div> </main> </div> <footer class=md-footer > <div class=md-footer-nav > <nav class="md-footer-nav__inner md-grid"> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright > <div class=md-footer-copyright__highlight > &#169; Copyright 2021, Nick Eubank. </div> Created using <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.5.0. and <a href="https://github.com/bashtage/sphinx-material/">Material for Sphinx</a> </div> </div> </div> </footer> <script src="../_static/javascripts/application.js"></script> <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>